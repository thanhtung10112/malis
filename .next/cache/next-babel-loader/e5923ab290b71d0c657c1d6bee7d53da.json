{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(login),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(getProfile),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(changePassword),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchSettingInitData),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(fetchSettings),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(getSettings),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(saveSettingsSaga),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(logout),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(authSaga);\n\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { call, all, select } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { setCookie } from 'nookies';\nimport { authStore, commonStore } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport authApi from '@/apis/auth.api';\nexport function login(_ref) {\n  var payload, remember, loginData, data, _data;\n\n  return _regeneratorRuntime.wrap(function login$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          _context.next = 3;\n          return put(authStore.actions.setLoading(true));\n\n        case 3:\n          _context.prev = 3;\n          remember = payload.remember, loginData = _objectWithoutProperties(payload, [\"remember\"]);\n          _context.next = 7;\n          return call(authApi.login, loginData);\n\n        case 7:\n          data = _context.sent;\n          _context.next = 10;\n          return put(authStore.actions.saveTokenLogin({\n            access_token: data.access_token,\n            redirect_to: data.redirect_to,\n            remember: remember\n          }));\n\n        case 10:\n          _context.next = 17;\n          break;\n\n        case 12:\n          _context.prev = 12;\n          _context.t0 = _context[\"catch\"](3);\n          _data = _context.t0.response.data;\n          _context.next = 17;\n          return put(commonStore.actions.setErrorMessage(_data.message));\n\n        case 17:\n          _context.next = 19;\n          return put(authStore.actions.setLoading(false));\n\n        case 19:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[3, 12]]);\n}\nexport function getProfile() {\n  var data;\n  return _regeneratorRuntime.wrap(function getProfile$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return put(authStore.actions.setLoadingAuth(true));\n\n        case 2:\n          _context2.prev = 2;\n          _context2.next = 5;\n          return call(authApi.getProfile);\n\n        case 5:\n          data = _context2.sent;\n          _context2.next = 8;\n          return put(authStore.actions.setProfile(data));\n\n        case 8:\n          _context2.next = 14;\n          break;\n\n        case 10:\n          _context2.prev = 10;\n          _context2.t0 = _context2[\"catch\"](2);\n          _context2.next = 14;\n          return errorSaga.handleError(_context2.t0);\n\n        case 14:\n          _context2.next = 16;\n          return put(authStore.actions.setLoadingAuth(false));\n\n        case 16:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[2, 10]]);\n}\nexport function changePassword(_ref2) {\n  var payload, _yield$call, message;\n\n  return _regeneratorRuntime.wrap(function changePassword$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context3.next = 3;\n          return put(authStore.actions.setPwDialogState({\n            loading: true\n          }));\n\n        case 3:\n          _context3.prev = 3;\n          _context3.next = 6;\n          return call(authApi.changePassword, payload);\n\n        case 6:\n          _yield$call = _context3.sent;\n          message = _yield$call.message;\n          _context3.next = 10;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(authStore.actions.setPwDialogState({\n            open: false\n          }))]);\n\n        case 10:\n          _context3.next = 16;\n          break;\n\n        case 12:\n          _context3.prev = 12;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 16;\n          return errorSaga.handleError(_context3.t0);\n\n        case 16:\n          _context3.next = 18;\n          return put(authStore.actions.setPwDialogState({\n            loading: false\n          }));\n\n        case 18:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[3, 12]]);\n}\nexport function fetchSettingInitData() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchSettingInitData$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(authApi.getInitDataForSetting);\n\n        case 2:\n          data = _context4.sent;\n          _context4.next = 5;\n          return put(authStore.actions.setSettingInitData(data));\n\n        case 5:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\nexport function fetchSettings() {\n  var _yield$call2, message, success, detail;\n\n  return _regeneratorRuntime.wrap(function fetchSettings$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return call(authApi.getSettings);\n\n        case 2:\n          _yield$call2 = _context5.sent;\n          message = _yield$call2.message;\n          success = _yield$call2.success;\n          detail = _objectWithoutProperties(_yield$call2, [\"message\", \"success\"]);\n          _context5.next = 8;\n          return put(authStore.actions.setSettingDetail(detail));\n\n        case 8:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}\nexport function getSettings() {\n  return _regeneratorRuntime.wrap(function getSettings$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchSettingInitData);\n\n        case 5:\n          _context6.next = 7;\n          return call(fetchSettings);\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return errorSaga.handleError(_context6.t0);\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\n\nfunction getPathHomePage(options, homePageId) {\n  var _homePage$properties;\n\n  var homePage = _.find(options, {\n    value: homePageId\n  });\n\n  return (homePage === null || homePage === void 0 ? void 0 : (_homePage$properties = homePage.properties) === null || _homePage$properties === void 0 ? void 0 : _homePage$properties.path) || '';\n}\n\nexport function saveSettingsSaga(_ref3) {\n  var payload, _yield$call3, message, parameters, homePagePath;\n\n  return _regeneratorRuntime.wrap(function saveSettingsSaga$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context7.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return call(authApi.saveSettings, payload);\n\n        case 6:\n          _yield$call3 = _context7.sent;\n          message = _yield$call3.message;\n          return _context7.delegateYield(select(authStore.selectSettingsParameters), \"t0\", 9);\n\n        case 9:\n          parameters = _context7.t0;\n          homePagePath = getPathHomePage(parameters.PAGES, payload.home_page);\n\n          if (homePagePath) {\n            setCookie(null, 'redirect_to', homePagePath, {\n              maxAge: 60 * 60 * 24 * 365 // 1 day\n\n            });\n          }\n\n          _context7.next = 14;\n          return put(authStore.actions.setDefaultLanguage(payload.default_language));\n\n        case 14:\n          _context7.next = 16;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 16:\n          _context7.next = 22;\n          break;\n\n        case 18:\n          _context7.prev = 18;\n          _context7.t1 = _context7[\"catch\"](3);\n          _context7.next = 22;\n          return errorSaga.handleError(_context7.t1);\n\n        case 22:\n          _context7.next = 24;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 24:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 18]]);\n}\nexport function logout(_ref4) {\n  var payload, entity;\n  return _regeneratorRuntime.wrap(function logout$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref4.payload;\n          return _context8.delegateYield(select(commonStore.selectEntity), \"t0\", 2);\n\n        case 2:\n          entity = _context8.t0;\n\n          if (!((payload === null || payload === void 0 ? void 0 : payload.confirm) === 'save')) {\n            _context8.next = 8;\n            break;\n          }\n\n          _context8.next = 6;\n          return put(commonStore.sagaUpdateMultiple({\n            entity: entity,\n            action: authStore.actions.logout\n          }));\n\n        case 6:\n          _context8.next = 10;\n          break;\n\n        case 8:\n          _context8.next = 10;\n          return put(authStore.actions.logout());\n\n        case 10:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8);\n}\n\nfunction authSaga() {\n  return _regeneratorRuntime.wrap(function authSaga$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(authStore.sagaLogin, login);\n\n        case 2:\n          _context9.next = 4;\n          return takeEvery(authStore.sagaGetProfile, getProfile);\n\n        case 4:\n          _context9.next = 6;\n          return takeEvery(authStore.sagaChangePassword, changePassword);\n\n        case 6:\n          _context9.next = 8;\n          return takeEvery(authStore.sagaGetSettings, getSettings);\n\n        case 8:\n          _context9.next = 10;\n          return takeEvery(authStore.sagaSaveSettings, saveSettingsSaga);\n\n        case 10:\n          _context9.next = 12;\n          return takeEvery(authStore.sagaLogout, logout);\n\n        case 12:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nexport default authSaga;","map":null,"metadata":{},"sourceType":"module"}