{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\Fersher\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\Part\\\\Item\\\\TabGeneral.tsx\";\nimport { useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport { Button, Grid } from '@material-ui/core';\nimport { When } from 'react-if';\nimport { FormControllerTextField, TableMultilingualDescription, FormControllerAutocomplete, AppAutocompleteAsync, SectionTimezone, AppAutocomplete, CopyIcon, DropdownIcon, FormControllerNumberField, useConfirm } from '@/components';\nimport DialogCopyItem from './DialogCopyItem';\nimport itemApi from '@/apis/item.api';\nimport partApi from '@/apis/part.api';\nimport { commonStore, partStore } from '@/store/reducers';\nimport _ from 'lodash';\nimport { itemMassFormat } from '@/utils/constant';\nimport { StatusCode } from '@/utils/StatusCode';\n\nconst TabGeneral = () => {\n  var _itemForm$errors$job_, _itemForm$errors$draw;\n\n  const {\n    t\n  } = useTranslation('common');\n  const {\n    confirm\n  } = useConfirm();\n  const {\n    0: openCopyItem,\n    1: setOpenCopyItem\n  } = useState(false);\n  const {\n    0: defaultPartList,\n    1: setDefaultPartList\n  } = useState([]);\n  const itemForm = useFormContext();\n  const itemFormData = itemForm.getValues();\n  const watchDrawingId = itemForm.watch('drawing_id', null);\n  const watchRefTo = itemForm.watch('reference_to', null);\n  const watchId = itemForm.watch('id', null);\n\n  const isCreating = _.isNil(watchId);\n\n  const dispatch = useDispatch();\n  const parameters = useSelector(partStore.selectParameters);\n  const userJob = useSelector(commonStore.selectUserValueJob);\n  const entity = useSelector(commonStore.selectEntity);\n\n  const getAdditionalDataPart = () => {\n    const data = {};\n    data.limit_to_job = userJob.value;\n\n    if (!_.isNil(watchDrawingId)) {\n      data.excluded_drawings = [watchDrawingId.value];\n    }\n\n    return data;\n  };\n\n  const additionalDataPart = getAdditionalDataPart();\n\n  const handleChangeDrawingId = async (event, optionValue) => {\n    setDefaultPartList([]);\n    dispatch(partStore.actions.setPartLoading(true));\n    itemForm.setValue('drawing_id', optionValue);\n\n    try {\n      const {\n        generated_code\n      } = await itemApi.getGenerateCode(optionValue.value);\n      itemForm.setValue('dpn', generated_code);\n    } catch (error) {\n      dispatch(commonStore.actions.setError(error));\n    }\n\n    dispatch(partStore.actions.setPartLoading(false));\n  };\n\n  const handleSetOpenCopyItem = isOpen => () => {\n    if (_.isNull(watchRefTo)) {\n      setOpenCopyItem(isOpen);\n    }\n  };\n\n  const displayConfirmRefDialog = async message => {\n    await confirm({\n      title: 'Warning',\n      description: message,\n      buttons: [{\n        label: 'Ok',\n        action: 'OK'\n      }]\n    });\n  };\n\n  const getPart = async selectedPart => {\n    var _formData$drawing_id;\n\n    const formData = itemForm.getValues();\n    const reqPayload = {\n      selected_part: (selectedPart === null || selectedPart === void 0 ? void 0 : selectedPart.value) || null,\n      selected_drawing: (_formData$drawing_id = formData.drawing_id) === null || _formData$drawing_id === void 0 ? void 0 : _formData$drawing_id.value,\n      current_item: isCreating ? null : formData.id\n    };\n    dispatch(partStore.actions.setPartLoading(true));\n\n    try {\n      const {\n        part,\n        message\n      } = await partApi.getReferencedPart(reqPayload);\n      const reference_to = {\n        description: '',\n        entity_id: part.dpn,\n        value: part.id\n      };\n      itemForm.setValue('descriptions', part.descriptions);\n      itemForm.setValue('manufacturer_equiv', part.manufacturer_equiv_object);\n      itemForm.setValue('manufacturers', part.manufacturers);\n      itemForm.setValue('mass', part.mass);\n      itemForm.setValue('material_equiv', part.material_equiv_object);\n      itemForm.setValue('unit', part.unit);\n      itemForm.setValue('manufacturer_equiv_standards', part.manufacturer_equiv_standards);\n      itemForm.setValue('material_equiv_standards', part.material_equiv_standards);\n      itemForm.setValue('reference_to', reference_to);\n\n      if (selectedPart.value !== part.id) {\n        displayConfirmRefDialog(message);\n      } else {\n        dispatch(commonStore.actions.setSuccessMessage(message));\n      }\n    } catch (error) {\n      const {\n        status,\n        data\n      } = error.response;\n\n      if (status === StatusCode.BAD_REQUEST) {\n        displayConfirmRefDialog(data.message);\n      }\n    }\n\n    dispatch(partStore.actions.setPartLoading(false));\n  };\n\n  const handleSelectPart = (event, optionValue, reason) => {\n    if (reason === 'clear') {\n      itemForm.setValue('reference_to', null);\n    } else {\n      getPart(optionValue);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 2,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 6,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          spacing: 2,\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(AppAutocomplete, {\n              helperText: (_itemForm$errors$job_ = itemForm.errors.job_id) === null || _itemForm$errors$job_ === void 0 ? void 0 : _itemForm$errors$job_.message,\n              error: Boolean(itemForm.errors.job_id),\n              value: userJob,\n              popupIcon: null,\n              disabled: true,\n              label: \"Job\",\n              required: true,\n              primaryKeyOption: \"value\",\n              options: [],\n              renderOption: option => option.description\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 143,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(AppAutocompleteAsync, {\n              popupIcon: entity === 'drawing' ? null : /*#__PURE__*/_jsxDEV(DropdownIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 58\n              }, this),\n              helperText: (_itemForm$errors$draw = itemForm.errors.drawing_id) === null || _itemForm$errors$draw === void 0 ? void 0 : _itemForm$errors$draw.message,\n              error: Boolean(itemForm.errors.drawing_id),\n              disabled: !isCreating || entity === 'drawing',\n              value: watchDrawingId,\n              compName: \"drawing_list\",\n              additionalData: {\n                limit_to_job: userJob.value\n              },\n              required: true,\n              label: \"Drawing #\",\n              onChange: handleChangeDrawingId\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 8,\n            children: /*#__PURE__*/_jsxDEV(FormControllerTextField, {\n              disabled: !isCreating,\n              control: itemForm.control,\n              name: \"dpn\",\n              required: true,\n              label: \"Item #\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 171,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 4,\n            children: /*#__PURE__*/_jsxDEV(Button, {\n              startIcon: /*#__PURE__*/_jsxDEV(CopyIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 181,\n                columnNumber: 28\n              }, this),\n              style: {\n                padding: '0 4px',\n                textTransform: 'capitalize'\n              },\n              onClick: handleSetOpenCopyItem(true),\n              disabled: Boolean(watchRefTo),\n              children: t('button.copy_attribute')\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 180,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(AppAutocompleteAsync, {\n              disabled: !watchDrawingId,\n              disableClearable: false,\n              value: watchRefTo,\n              compName: \"part_list\",\n              additionalData: additionalDataPart,\n              label: \"Reference Part Number\",\n              onChange: handleSelectPart,\n              defaultOptions: defaultPartList,\n              filterOptions: options => {\n                if (_.isNil(options)) {\n                  return [];\n                }\n\n                if (isCreating) {\n                  return options;\n                }\n\n                return _.filter(options, option => option.value !== watchId);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(FormControllerNumberField, {\n              control: itemForm.control,\n              name: \"mass\",\n              required: true,\n              label: \"Mass (kg)\",\n              disabled: Boolean(watchRefTo),\n              decimalScale: itemMassFormat.precision,\n              fixedDecimalScale: itemMassFormat.precision\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 211,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsxDEV(FormControllerAutocomplete, {\n              control: itemForm.control,\n              name: \"unit\",\n              required: true,\n              label: \"Unit\",\n              primaryKeyOption: \"value\",\n              options: parameters.UNIT,\n              renderOption: option => option.description,\n              disabled: Boolean(watchRefTo)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(When, {\n            condition: !isCreating,\n            children: /*#__PURE__*/_jsxDEV(Grid, {\n              item: true,\n              xs: 12,\n              style: {\n                padding: 0\n              },\n              children: /*#__PURE__*/_jsxDEV(SectionTimezone, {\n                value: itemFormData\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 235,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 234,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 6,\n        children: /*#__PURE__*/_jsxDEV(TableMultilingualDescription, {\n          disabled: Boolean(watchRefTo),\n          languageList: parameters.PLLA,\n          editMode: !isCreating,\n          name: \"descriptions\",\n          tableHeight: 290,\n          control: itemForm.control,\n          copyable: true,\n          copyDialogProps: {\n            checkboxesToSelect: [{\n              label: 'Drawing',\n              value: 'drawing_list',\n              entity: 'drawings'\n            }, {\n              label: 'Item/Assembly',\n              value: 'part_list',\n              entity: 'parts',\n              default: true\n            }]\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogCopyItem, {\n      open: openCopyItem,\n      onClose: handleSetOpenCopyItem(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\nexport default TabGeneral;","map":{"version":3,"sources":["D:/Fersher/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/Part/Item/TabGeneral.tsx"],"names":["useState","useFormContext","useSelector","useDispatch","useTranslation","Button","Grid","When","FormControllerTextField","TableMultilingualDescription","FormControllerAutocomplete","AppAutocompleteAsync","SectionTimezone","AppAutocomplete","CopyIcon","DropdownIcon","FormControllerNumberField","useConfirm","DialogCopyItem","itemApi","partApi","commonStore","partStore","_","itemMassFormat","StatusCode","TabGeneral","t","confirm","openCopyItem","setOpenCopyItem","defaultPartList","setDefaultPartList","itemForm","itemFormData","getValues","watchDrawingId","watch","watchRefTo","watchId","isCreating","isNil","dispatch","parameters","selectParameters","userJob","selectUserValueJob","entity","selectEntity","getAdditionalDataPart","data","limit_to_job","value","excluded_drawings","additionalDataPart","handleChangeDrawingId","event","optionValue","actions","setPartLoading","setValue","generated_code","getGenerateCode","error","setError","handleSetOpenCopyItem","isOpen","isNull","displayConfirmRefDialog","message","title","description","buttons","label","action","getPart","selectedPart","formData","reqPayload","selected_part","selected_drawing","drawing_id","current_item","id","part","getReferencedPart","reference_to","entity_id","dpn","descriptions","manufacturer_equiv_object","manufacturers","mass","material_equiv_object","unit","manufacturer_equiv_standards","material_equiv_standards","setSuccessMessage","status","response","BAD_REQUEST","handleSelectPart","reason","errors","job_id","Boolean","option","control","padding","textTransform","options","filter","precision","UNIT","PLLA","checkboxesToSelect","default"],"mappings":"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","sourcesContent":["import { useState } from 'react'\nimport { useFormContext } from 'react-hook-form'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useTranslation } from 'next-i18next'\n\nimport { Button, Grid } from '@material-ui/core'\nimport { When } from 'react-if'\nimport {\n  FormControllerTextField,\n  TableMultilingualDescription,\n  FormControllerAutocomplete,\n  AppAutocompleteAsync,\n  SectionTimezone,\n  AppAutocomplete,\n  CopyIcon,\n  DropdownIcon,\n  FormControllerNumberField,\n  useConfirm\n} from '@/components'\nimport DialogCopyItem from './DialogCopyItem'\n\nimport itemApi from '@/apis/item.api'\nimport partApi from '@/apis/part.api'\nimport { commonStore, partStore } from '@/store/reducers'\nimport _ from 'lodash'\nimport { itemMassFormat } from '@/utils/constant'\nimport { StatusCode } from '@/utils/StatusCode'\n\nimport type { ItemDetail } from '@/types/Item'\nimport type { DataForDropdown } from '@/types/Common'\nimport type { AutocompleteChangeReason } from '@material-ui/lab'\n\nconst TabGeneral: React.FC = () => {\n  const { t } = useTranslation('common')\n  const { confirm } = useConfirm()\n\n  const [openCopyItem, setOpenCopyItem] = useState(false)\n  const [defaultPartList, setDefaultPartList] = useState([])\n\n  const itemForm = useFormContext<ItemDetail>()\n  const itemFormData = itemForm.getValues()\n  const watchDrawingId = itemForm.watch('drawing_id', null)\n  const watchRefTo = itemForm.watch('reference_to', null)\n  const watchId = itemForm.watch('id', null)\n\n  const isCreating = _.isNil(watchId)\n\n  const dispatch = useDispatch()\n  const parameters = useSelector(partStore.selectParameters)\n  const userJob = useSelector(commonStore.selectUserValueJob)\n  const entity = useSelector(commonStore.selectEntity)\n\n  const getAdditionalDataPart = () => {\n    const data = {} as any\n    data.limit_to_job = userJob.value\n    if (!_.isNil(watchDrawingId)) {\n      data.excluded_drawings = [(watchDrawingId as DataForDropdown).value]\n    }\n    return data\n  }\n\n  const additionalDataPart = getAdditionalDataPart()\n\n  const handleChangeDrawingId = async (event, optionValue: DataForDropdown) => {\n    setDefaultPartList([])\n    dispatch(partStore.actions.setPartLoading(true))\n    itemForm.setValue('drawing_id', optionValue)\n    try {\n      const { generated_code } = await itemApi.getGenerateCode(optionValue.value)\n      itemForm.setValue('dpn', generated_code)\n    } catch (error) {\n      dispatch(commonStore.actions.setError(error))\n    }\n    dispatch(partStore.actions.setPartLoading(false))\n  }\n\n  const handleSetOpenCopyItem = (isOpen: boolean) => () => {\n    if (_.isNull(watchRefTo)) {\n      setOpenCopyItem(isOpen)\n    }\n  }\n\n  const displayConfirmRefDialog = async (message: string) => {\n    await confirm({\n      title: 'Warning',\n      description: message,\n      buttons: [{ label: 'Ok', action: 'OK' }]\n    })\n  }\n\n  const getPart = async (selectedPart: DataForDropdown) => {\n    const formData = itemForm.getValues()\n    const reqPayload = {\n      selected_part: selectedPart?.value || null,\n      selected_drawing: (formData.drawing_id as DataForDropdown)?.value,\n      current_item: isCreating ? null : formData.id\n    }\n    dispatch(partStore.actions.setPartLoading(true))\n    try {\n      const { part, message } = await partApi.getReferencedPart(reqPayload)\n      const reference_to = {\n        description: '',\n        entity_id: part.dpn,\n        value: part.id\n      }\n      itemForm.setValue('descriptions', part.descriptions)\n      itemForm.setValue('manufacturer_equiv', part.manufacturer_equiv_object)\n      itemForm.setValue('manufacturers', part.manufacturers)\n      itemForm.setValue('mass', part.mass)\n      itemForm.setValue('material_equiv', part.material_equiv_object)\n      itemForm.setValue('unit', part.unit)\n      itemForm.setValue('manufacturer_equiv_standards', part.manufacturer_equiv_standards)\n      itemForm.setValue('material_equiv_standards', part.material_equiv_standards)\n      itemForm.setValue('reference_to', reference_to)\n      if (selectedPart.value !== part.id) {\n        displayConfirmRefDialog(message)\n      } else {\n        dispatch(commonStore.actions.setSuccessMessage(message))\n      }\n    } catch (error) {\n      const { status, data } = error.response\n      if (status === StatusCode.BAD_REQUEST) {\n        displayConfirmRefDialog(data.message)\n      }\n    }\n    dispatch(partStore.actions.setPartLoading(false))\n  }\n\n  const handleSelectPart = (event, optionValue: DataForDropdown, reason: AutocompleteChangeReason) => {\n    if (reason === 'clear') {\n      itemForm.setValue('reference_to', null)\n    } else {\n      getPart(optionValue)\n    }\n  }\n\n  return (\n    <>\n      <Grid container spacing={2}>\n        <Grid item xs={6}>\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              <AppAutocomplete\n                helperText={itemForm.errors.job_id?.message}\n                error={Boolean(itemForm.errors.job_id)}\n                value={userJob}\n                popupIcon={null}\n                disabled\n                label=\"Job\"\n                required\n                primaryKeyOption=\"value\"\n                options={[]}\n                renderOption={(option) => option.description}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <AppAutocompleteAsync\n                popupIcon={entity === 'drawing' ? null : <DropdownIcon />}\n                helperText={itemForm.errors.drawing_id?.message}\n                error={Boolean(itemForm.errors.drawing_id)}\n                disabled={!isCreating || entity === 'drawing'}\n                value={watchDrawingId}\n                compName=\"drawing_list\"\n                additionalData={{ limit_to_job: userJob.value }}\n                required\n                label=\"Drawing #\"\n                onChange={handleChangeDrawingId}\n              />\n            </Grid>\n            <Grid item xs={8}>\n              <FormControllerTextField\n                disabled={!isCreating}\n                control={itemForm.control}\n                name=\"dpn\"\n                required\n                label=\"Item #\"\n              />\n            </Grid>\n            <Grid item xs={4}>\n              <Button\n                startIcon={<CopyIcon />}\n                style={{ padding: '0 4px', textTransform: 'capitalize' }}\n                onClick={handleSetOpenCopyItem(true)}\n                disabled={Boolean(watchRefTo)}\n              >\n                {t('button.copy_attribute')}\n              </Button>\n            </Grid>\n            <Grid item xs={12}>\n              <AppAutocompleteAsync\n                disabled={!watchDrawingId}\n                disableClearable={false}\n                value={watchRefTo}\n                compName=\"part_list\"\n                additionalData={additionalDataPart}\n                label=\"Reference Part Number\"\n                onChange={handleSelectPart}\n                defaultOptions={defaultPartList}\n                filterOptions={(options) => {\n                  if (_.isNil(options)) {\n                    return []\n                  }\n                  if (isCreating) {\n                    return options\n                  }\n                  return _.filter(options, (option) => option.value !== watchId)\n                }}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <FormControllerNumberField\n                control={itemForm.control}\n                name=\"mass\"\n                required\n                label=\"Mass (kg)\"\n                disabled={Boolean(watchRefTo)}\n                decimalScale={itemMassFormat.precision}\n                fixedDecimalScale={itemMassFormat.precision}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <FormControllerAutocomplete\n                control={itemForm.control}\n                name=\"unit\"\n                required\n                label=\"Unit\"\n                primaryKeyOption=\"value\"\n                options={parameters.UNIT}\n                renderOption={(option) => option.description}\n                disabled={Boolean(watchRefTo)}\n              />\n            </Grid>\n            <When condition={!isCreating}>\n              <Grid item xs={12} style={{ padding: 0 }}>\n                <SectionTimezone value={itemFormData} />\n              </Grid>\n            </When>\n          </Grid>\n        </Grid>\n        <Grid item xs={6}>\n          <TableMultilingualDescription\n            disabled={Boolean(watchRefTo)}\n            languageList={parameters.PLLA}\n            editMode={!isCreating}\n            name=\"descriptions\"\n            tableHeight={290}\n            control={itemForm.control}\n            copyable\n            copyDialogProps={{\n              checkboxesToSelect: [\n                {\n                  label: 'Drawing',\n                  value: 'drawing_list',\n                  entity: 'drawings'\n                },\n                {\n                  label: 'Item/Assembly',\n                  value: 'part_list',\n                  entity: 'parts',\n                  default: true\n                }\n              ]\n            }}\n          />\n        </Grid>\n      </Grid>\n\n      <DialogCopyItem open={openCopyItem} onClose={handleSetOpenCopyItem(false)} />\n    </>\n  )\n}\n\nexport default TabGeneral\n"]},"metadata":{},"sourceType":"module"}