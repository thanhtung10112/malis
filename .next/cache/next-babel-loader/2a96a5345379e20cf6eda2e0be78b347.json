{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { DialogMain, FormControllerTabs, AppTabHistoryLog, TableExtendedProperties, BtnHelp } from '@/components';\nimport TabGeneral from './TabGeneral';\nimport { commonStore, specificationStore } from '@/store/reducers';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport _ from 'lodash';\nimport getValidationSchema from './validationSchema';\n\nconst DialogSpecificationCE = () => {\n  const {\n    t\n  } = useTranslation('specification');\n  const dispatch = useDispatch();\n  const dialogState = useSelector(specificationStore.selectDialogState);\n  const specificationDetail = useSelector(specificationStore.selectDetail);\n  const userDrawing = useSelector(commonStore.selectUserValueDrawing);\n  const {\n    parameters,\n    wiki_page\n  } = useSelector(specificationStore.selectInitDataForCE);\n  const permissions = useSelector(specificationStore.selectPermissions);\n\n  const isCreating = _.isNil(specificationDetail.id);\n\n  const vaidationSchema = useMemo(() => getValidationSchema(t), []);\n  const specificationForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(vaidationSchema)\n  });\n  useEffect(() => {\n    specificationForm.reset(specificationDetail);\n  }, [specificationDetail]);\n  useEffect(() => {\n    if (userDrawing.value === -1) {\n      dispatch(specificationStore.actions.setDetail({\n        drawing_id: null\n      }));\n    } else {\n      dispatch(specificationStore.actions.setDetail({\n        drawing_id: userDrawing\n      }));\n    }\n  }, [userDrawing]);\n  const handleSubmitForm = specificationForm.handleSubmit(formData => {\n    formData.drawing_id = formData.drawing_id.value;\n\n    const data = _.pick(formData, ['job_id', 'drawing_id', 'spec_id', 'descriptions']);\n\n    if (isCreating) {\n      dispatch(specificationStore.sagaCreate(data));\n    } else {\n      const specEdit = _.pick(formData, 'descriptions');\n\n      dispatch(specificationStore.sagaUpdate({\n        id: formData.id,\n        formData: specEdit\n      }));\n    }\n  });\n\n  const handleClose = () => {\n    dispatch(specificationStore.sagaCloseDialog());\n  };\n\n  const handleChangeTab = (event, nextTab) => {\n    dispatch(specificationStore.actions.setDialogStateTab(nextTab));\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(specificationStore.actions.setHistoryLogs(data));\n  };\n\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: /*#__PURE__*/_jsx(TabGeneral, {}),\n    errorKey: ['drawing_id', 'spec_id', 'job_id']\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: /*#__PURE__*/_jsx(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: specificationDetail.id,\n      mode: \"horizonatal\",\n      tableHeight: 315,\n      descriptionRows: 20,\n      entity: \"specification\"\n    }),\n    disabled: isCreating\n  };\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: /*#__PURE__*/_jsx(TableExtendedProperties, {\n      control: specificationForm.control,\n      name: \"additional_attributes\",\n      editMode: !isCreating,\n      propertiesList: parameters.SSAT,\n      tableHeight: 335,\n      parameterName: \"SSAT\"\n    })\n  };\n  const tabs = [generalTab, extendedPropertyTab, historyTab];\n  return /*#__PURE__*/_jsx(DialogMain, {\n    fullWidth: true,\n    maxWidth: \"md\",\n    open: dialogState.open,\n    loading: dialogState.loading,\n    title: /*#__PURE__*/_jsx(BtnHelp, {\n      title: isCreating ? t('form.title.create_specification') : t('form.title.update_specification'),\n      href: wiki_page\n    }),\n    onOk: handleSubmitForm,\n    onClose: handleClose,\n    okText: isCreating ? t('common:button.create') : t('common:button.update'),\n    okButtonProps: {\n      disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating\n    },\n    children: /*#__PURE__*/_jsx(FormControllerTabs, {\n      form: specificationForm,\n      value: dialogState.tab,\n      onChange: handleChangeTab,\n      tabs: tabs\n    })\n  });\n};\n\nexport default DialogSpecificationCE;","map":null,"metadata":{},"sourceType":"module"}