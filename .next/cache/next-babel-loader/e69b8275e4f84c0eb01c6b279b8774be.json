{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\Parameter\\\\TableAttributes.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from 'react';\nimport { Paper } from '@material-ui/core';\nimport { DataTableTextField, DialogCodeEditor, DataTableCellExpand, DataTable } from '@/components/index';\nimport { useController } from 'react-hook-form';\nimport _ from 'lodash';\nimport immer from 'immer';\nimport * as columnProperties from '@/utils/columnProperties';\n\nfunction TableAttributes(props) {\n  const {\n    attributes,\n    parameterId,\n    config\n  } = props,\n        formProps = _objectWithoutProperties(props, [\"attributes\", \"parameterId\", \"config\"]);\n\n  const attributeList = React.useMemo(() => {\n    if (_.isEmpty(attributes)) {\n      return [];\n    }\n\n    return attributes.split(';').map(attr => {\n      return {\n        attr\n      };\n    });\n  }, [attributes]);\n  const [codeEditorState, setCodeEditorState] = React.useState({\n    isOpen: false,\n    value: '',\n    attribute: '',\n    mode: '',\n    guideline: ''\n  });\n  const {\n    field\n  } = useController(_objectSpread({}, formProps));\n\n  const getValueAttribute = attr => {\n    const valueAttr = field.value[attr];\n    return valueAttr || '';\n  };\n\n  const isMarkdownField = attr => {\n    const queryFields = ['columns_definition', 'pre_select_query', 'from_clause'];\n    return parameterId === 'TTIP' || parameterId === 'MKAL' && queryFields.includes(attr);\n  };\n\n  const onChangeAttr = (id, value) => {\n    field.onChange(immer(field.value, draft => {\n      draft[id] = value;\n    }));\n  };\n\n  const handleDbClickToEdit = (params, event) => {\n    const {\n      attr\n    } = params.row;\n\n    if (isMarkdownField(attr)) {\n      handleOpenCodeEditor(attr);\n      event.stopPropagation();\n    }\n  };\n\n  const handleOpenCodeEditor = attr => {\n    setCodeEditorState(prevState => immer(prevState, draft => {\n      var _config$attributes$at, _config$attributes$at2;\n\n      draft.value = getValueAttribute(attr);\n      draft.attribute = attr;\n      draft.mode = (config === null || config === void 0 ? void 0 : (_config$attributes$at = config.attributes[attr]) === null || _config$attributes$at === void 0 ? void 0 : _config$attributes$at.mode) || 'json';\n      draft.guideline = (config === null || config === void 0 ? void 0 : (_config$attributes$at2 = config.attributes[attr]) === null || _config$attributes$at2 === void 0 ? void 0 : _config$attributes$at2.guideline) || '(no guideline)';\n      draft.isOpen = true;\n    }));\n  };\n\n  const onCodeEditorClose = () => {\n    setCodeEditorState(prevState => immer(prevState, draft => {\n      draft.isOpen = false;\n    }));\n  };\n\n  const onCodeEditorConfirm = (value, attribute) => {\n    field.onChange(immer(field.value, draft => {\n      draft[attribute] = value;\n    }));\n    onCodeEditorClose();\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Paper, {\n      elevation: 1,\n      children: /*#__PURE__*/_jsxDEV(DataTable, {\n        tableHeight: 200,\n        rows: attributeList,\n        hideFooter: true,\n        onCellDoubleClick: handleDbClickToEdit,\n        getRowId: params => params.attr,\n        columns: [_objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n          field: 'attr',\n          headerName: 'Attribute',\n          sortable: false,\n          width: 150\n        }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.editCell('Value')), {}, {\n          field: 'raw_value',\n          flex: 0.75,\n\n          valueGetter(params) {\n            const {\n              attr\n            } = params.row;\n            const value = getValueAttribute(attr);\n            return value;\n          },\n\n          renderEditCell(params) {\n            return /*#__PURE__*/_jsxDEV(DataTableTextField, {\n              params: params,\n              onChangeValue: onChangeAttr\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 24\n            }, this);\n          },\n\n          renderCell(params) {\n            const {\n              attr\n            } = params.row;\n\n            if (isMarkdownField(attr)) {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                children: params.value\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 133,\n                columnNumber: 26\n              }, this);\n            }\n\n            return /*#__PURE__*/_jsxDEV(DataTableCellExpand, {\n              value: params.value,\n              width: params.colDef.width\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 24\n            }, this);\n          }\n\n        })]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogCodeEditor, _objectSpread(_objectSpread({}, codeEditorState), {}, {\n      onClose: onCodeEditorClose,\n      onConfirm: onCodeEditorConfirm\n    }), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\nexport default TableAttributes;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/Parameter/TableAttributes.tsx"],"names":["React","Paper","DataTableTextField","DialogCodeEditor","DataTableCellExpand","DataTable","useController","_","immer","columnProperties","TableAttributes","props","attributes","parameterId","config","formProps","attributeList","useMemo","isEmpty","split","map","attr","codeEditorState","setCodeEditorState","useState","isOpen","value","attribute","mode","guideline","field","getValueAttribute","valueAttr","isMarkdownField","queryFields","includes","onChangeAttr","id","onChange","draft","handleDbClickToEdit","params","event","row","handleOpenCodeEditor","stopPropagation","prevState","onCodeEditorClose","onCodeEditorConfirm","defaultProperties","headerName","sortable","width","editCell","flex","valueGetter","renderEditCell","renderCell","colDef"],"mappings":"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","sourcesContent":["import React from 'react'\n\nimport { Paper } from '@material-ui/core'\n\nimport { DataTableTextField, DialogCodeEditor, DataTableCellExpand, DataTable } from '@/components/index'\n\nimport { useController } from 'react-hook-form'\n\nimport _ from 'lodash'\nimport immer from 'immer'\nimport * as columnProperties from '@/utils/columnProperties'\n\nimport type { Control } from 'react-hook-form'\n\ntype TableAttributesProps<T = any> = {\n  attributes: string\n  control: Control<T>\n  name: string\n  parameterId: string\n  config: any\n}\n\nfunction TableAttributes(props: TableAttributesProps) {\n  const { attributes, parameterId, config, ...formProps } = props\n\n  const attributeList = React.useMemo(() => {\n    if (_.isEmpty(attributes)) {\n      return []\n    }\n    return attributes.split(';').map((attr) => {\n      return { attr }\n    })\n  }, [attributes])\n\n  const [codeEditorState, setCodeEditorState] = React.useState({\n    isOpen: false,\n    value: '',\n    attribute: '',\n    mode: '',\n    guideline: ''\n  })\n\n  const { field } = useController({ ...formProps })\n\n  const getValueAttribute = (attr: string) => {\n    const valueAttr = field.value[attr]\n    return valueAttr || ''\n  }\n\n  const isMarkdownField = (attr: string) => {\n    const queryFields = ['columns_definition', 'pre_select_query', 'from_clause']\n    return parameterId === 'TTIP' || (parameterId === 'MKAL' && queryFields.includes(attr))\n  }\n\n  const onChangeAttr = (id, value) => {\n    field.onChange(\n      immer(field.value, (draft) => {\n        draft[id] = value\n      })\n    )\n  }\n\n  const handleDbClickToEdit = (params, event) => {\n    const { attr } = params.row\n    if (isMarkdownField(attr)) {\n      handleOpenCodeEditor(attr)\n      event.stopPropagation()\n    }\n  }\n\n  const handleOpenCodeEditor = (attr) => {\n    setCodeEditorState((prevState) =>\n      immer(prevState, (draft) => {\n        draft.value = getValueAttribute(attr)\n        draft.attribute = attr\n        draft.mode = config?.attributes[attr]?.mode || 'json'\n        draft.guideline = config?.attributes[attr]?.guideline || '(no guideline)'\n        draft.isOpen = true\n      })\n    )\n  }\n\n  const onCodeEditorClose = () => {\n    setCodeEditorState((prevState) =>\n      immer(prevState, (draft) => {\n        draft.isOpen = false\n      })\n    )\n  }\n\n  const onCodeEditorConfirm = (value, attribute) => {\n    field.onChange(\n      immer(field.value, (draft) => {\n        draft[attribute] = value\n      })\n    )\n    onCodeEditorClose()\n  }\n\n  return (\n    <>\n      <Paper elevation={1}>\n        <DataTable\n          tableHeight={200}\n          rows={attributeList}\n          hideFooter\n          onCellDoubleClick={handleDbClickToEdit}\n          getRowId={(params) => params.attr}\n          columns={[\n            {\n              ...columnProperties.defaultProperties,\n              field: 'attr',\n              headerName: 'Attribute',\n              sortable: false,\n              width: 150\n            },\n            {\n              ...columnProperties.defaultProperties,\n              ...columnProperties.editCell('Value'),\n              field: 'raw_value',\n              flex: 0.75,\n              valueGetter(params) {\n                const { attr } = params.row\n                const value = getValueAttribute(attr)\n                return value\n              },\n              renderEditCell(params) {\n                return <DataTableTextField params={params} onChangeValue={onChangeAttr} />\n              },\n              renderCell(params) {\n                const { attr } = params.row\n                if (isMarkdownField(attr)) {\n                  return <div>{params.value}</div>\n                }\n                return <DataTableCellExpand value={params.value} width={params.colDef.width} />\n              }\n            }\n          ]}\n        />\n      </Paper>\n      <DialogCodeEditor {...codeEditorState} onClose={onCodeEditorClose} onConfirm={onCodeEditorConfirm} />\n    </>\n  )\n}\n\nexport default TableAttributes\n"]},"metadata":{},"sourceType":"module"}