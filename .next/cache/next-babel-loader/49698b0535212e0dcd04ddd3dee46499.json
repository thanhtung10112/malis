{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForList),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(fetchDetail),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(fetchList),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForCE),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(getUserList),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(openUserCreateDialog),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(createUser),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(openUserUpdateDialog),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(resetPassword),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(updateUser),\n    _marked11 = /*#__PURE__*/_regeneratorRuntime.mark(closeUserDialog),\n    _marked12 = /*#__PURE__*/_regeneratorRuntime.mark(userSaga);\n\nimport { takeEvery, put, putResolve } from 'redux-saga/effects';\nimport { select, all, call } from 'typed-redux-saga';\nimport { v1 as uuidv1 } from 'uuid';\nimport { advancedFilterActions, commonStore, userStore, authStore } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport userApi from '@/apis/user.api';\nimport { getProfile } from './auth.saga';\nimport { getDefaultValues } from '@/utils/getDefaultValues';\n\nfunction fetchInitDataForList() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchInitDataForList$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return call(userApi.getInitDataForList);\n\n        case 2:\n          data = _context.sent;\n          _context.next = 5;\n          return put(userStore.actions.setInitDataForList(data));\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction fetchDetail(id) {\n  var _yield$call, user;\n\n  return _regeneratorRuntime.wrap(function fetchDetail$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return call(userApi.getDetail, id);\n\n        case 2:\n          _yield$call = _context2.sent;\n          user = _yield$call.user;\n          user.job_access = user.job_access.map(function (item) {\n            return _objectSpread(_objectSpread({}, item), {}, {\n              id: uuidv1()\n            });\n          });\n          _context2.next = 7;\n          return put(userStore.actions.setDetail(user));\n\n        case 7:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction fetchList() {\n  var _yield$all, tableState, searchQuery, filterData, page, per_page, data;\n\n  return _regeneratorRuntime.wrap(function fetchList$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          return _context3.delegateYield(all({\n            tableState: select(commonStore.selectTableState),\n            searchQuery: select(commonStore.selectSearchQuery),\n            filterData: select(advancedFilterActions.selectFilterData)\n          }), \"t0\", 1);\n\n        case 1:\n          _yield$all = _context3.t0;\n          tableState = _yield$all.tableState;\n          searchQuery = _yield$all.searchQuery;\n          filterData = _yield$all.filterData;\n          page = tableState.page, per_page = tableState.per_page;\n          _context3.next = 8;\n          return call(userApi.getList, _objectSpread({\n            per_page: per_page,\n            page: page,\n            s: searchQuery\n          }, filterData));\n\n        case 8:\n          data = _context3.sent;\n          _context3.next = 11;\n          return put(commonStore.actions.setTableState({\n            total_items: data.total_items\n          }));\n\n        case 11:\n          _context3.next = 13;\n          return put(userStore.actions.setDataList(data.user_lists));\n\n        case 13:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction fetchInitDataForCE() {\n  var data, defaultValue;\n  return _regeneratorRuntime.wrap(function fetchInitDataForCE$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(userApi.getInitDataForCE);\n\n        case 2:\n          data = _context4.sent;\n          defaultValue = getDefaultValues(data, {\n            default_language: 'parameters.PLLA',\n            puco: 'parameters.PUCO',\n            time_zone: 'timezones'\n          });\n          _context4.next = 6;\n          return all([put(userStore.actions.setInitDataForCE(data)), put(userStore.actions.setDetail(defaultValue))]);\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nexport function getUserList() {\n  var permissions;\n  return _regeneratorRuntime.wrap(function getUserList$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context5.prev = 2;\n          _context5.next = 5;\n          return call(fetchInitDataForList);\n\n        case 5:\n          return _context5.delegateYield(select(userStore.selectPermissions), \"t0\", 6);\n\n        case 6:\n          permissions = _context5.t0;\n\n          if (!permissions.view) {\n            _context5.next = 10;\n            break;\n          }\n\n          _context5.next = 10;\n          return call(fetchList);\n\n        case 10:\n          _context5.next = 16;\n          break;\n\n        case 12:\n          _context5.prev = 12;\n          _context5.t1 = _context5[\"catch\"](2);\n          _context5.next = 16;\n          return errorSaga.handleError(_context5.t1);\n\n        case 16:\n          _context5.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[2, 12]]);\n}\nexport function openUserCreateDialog() {\n  return _regeneratorRuntime.wrap(function openUserCreateDialog$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchInitDataForCE);\n\n        case 5:\n          _context6.next = 7;\n          return put(userStore.actions.setDialogStateOpen(true));\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return errorSaga.handleError(_context6.t0);\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\nexport function createUser(_ref) {\n  var payload, _yield$call2, message;\n\n  return _regeneratorRuntime.wrap(function createUser$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref.payload;\n          _context7.next = 3;\n          return put(userStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return call(userApi.create, payload);\n\n        case 6:\n          _yield$call2 = _context7.sent;\n          message = _yield$call2.message;\n          _context7.next = 10;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(userStore.actions.resetDetail())]);\n\n        case 10:\n          _context7.next = 16;\n          break;\n\n        case 12:\n          _context7.prev = 12;\n          _context7.t0 = _context7[\"catch\"](3);\n          _context7.next = 16;\n          return errorSaga.handleError(_context7.t0);\n\n        case 16:\n          _context7.next = 18;\n          return put(userStore.actions.setDialogStateLoading(false));\n\n        case 18:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 12]]);\n}\nexport function openUserUpdateDialog(_ref2) {\n  var userId;\n  return _regeneratorRuntime.wrap(function openUserUpdateDialog$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          userId = _ref2.payload;\n          _context8.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context8.prev = 3;\n          _context8.next = 6;\n          return call(fetchInitDataForCE);\n\n        case 6:\n          _context8.next = 8;\n          return call(fetchDetail, userId);\n\n        case 8:\n          _context8.next = 10;\n          return put(userStore.actions.setDialogState({\n            open: true,\n            editMode: true\n          }));\n\n        case 10:\n          _context8.next = 16;\n          break;\n\n        case 12:\n          _context8.prev = 12;\n          _context8.t0 = _context8[\"catch\"](3);\n          _context8.next = 16;\n          return errorSaga.handleError(_context8.t0);\n\n        case 16:\n          _context8.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[3, 12]]);\n}\nexport function resetPassword(_ref3) {\n  var payload, _yield$select, id, _yield$call3, message;\n\n  return _regeneratorRuntime.wrap(function resetPassword$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context9.next = 3;\n          return put(userStore.actions.setResetPwdDialogLoading(true));\n\n        case 3:\n          _context9.prev = 3;\n          return _context9.delegateYield(select(userStore.selectDetail), \"t0\", 5);\n\n        case 5:\n          _yield$select = _context9.t0;\n          id = _yield$select.id;\n          _context9.next = 9;\n          return call(userApi.update, id, payload);\n\n        case 9:\n          _yield$call3 = _context9.sent;\n          message = _yield$call3.message;\n          _context9.next = 13;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(userStore.actions.setResetPwdDialogOpen(false))]);\n\n        case 13:\n          _context9.next = 19;\n          break;\n\n        case 15:\n          _context9.prev = 15;\n          _context9.t1 = _context9[\"catch\"](3);\n          _context9.next = 19;\n          return errorSaga.handleError(_context9.t1);\n\n        case 19:\n          _context9.next = 21;\n          return put(userStore.actions.setResetPwdDialogLoading(false));\n\n        case 21:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9, null, [[3, 15]]);\n}\nexport function updateUser(_ref4) {\n  var payload, id, formData, profile, _yield$call4, message;\n\n  return _regeneratorRuntime.wrap(function updateUser$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          payload = _ref4.payload;\n          _context10.next = 3;\n          return put(userStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context10.prev = 3;\n          id = payload.id, formData = payload.formData;\n          return _context10.delegateYield(select(authStore.selectProfile), \"t0\", 6);\n\n        case 6:\n          profile = _context10.t0;\n          _context10.next = 9;\n          return call(userApi.update, id, formData);\n\n        case 9:\n          _yield$call4 = _context10.sent;\n          message = _yield$call4.message;\n          _context10.next = 13;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 13:\n          _context10.next = 15;\n          return call(closeUserDialog);\n\n        case 15:\n          if (!(formData.user_id === profile.user_name)) {\n            _context10.next = 18;\n            break;\n          }\n\n          _context10.next = 18;\n          return call(getProfile);\n\n        case 18:\n          _context10.next = 24;\n          break;\n\n        case 20:\n          _context10.prev = 20;\n          _context10.t1 = _context10[\"catch\"](3);\n          _context10.next = 24;\n          return errorSaga.handleError(_context10.t1);\n\n        case 24:\n          _context10.next = 26;\n          return put(userStore.actions.setDialogStateLoading(false));\n\n        case 26:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10, null, [[3, 20]]);\n}\nexport function closeUserDialog() {\n  return _regeneratorRuntime.wrap(function closeUserDialog$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          _context11.prev = 0;\n          _context11.next = 3;\n          return putResolve(userStore.actions.setDialogStateOpen(false));\n\n        case 3:\n          _context11.next = 5;\n          return call(getUserList);\n\n        case 5:\n          _context11.next = 7;\n          return put(userStore.actions.resetDetail());\n\n        case 7:\n          _context11.next = 13;\n          break;\n\n        case 9:\n          _context11.prev = 9;\n          _context11.t0 = _context11[\"catch\"](0);\n          _context11.next = 13;\n          return errorSaga.handleError(_context11.t0);\n\n        case 13:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, _marked11, null, [[0, 9]]);\n}\n\nfunction userSaga() {\n  return _regeneratorRuntime.wrap(function userSaga$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return takeEvery(userStore.sagaGetList, getUserList);\n\n        case 2:\n          _context12.next = 4;\n          return takeEvery(userStore.sagaOpenCreateDialog, openUserCreateDialog);\n\n        case 4:\n          _context12.next = 6;\n          return takeEvery(userStore.sagaCreate, createUser);\n\n        case 6:\n          _context12.next = 8;\n          return takeEvery(userStore.sagaOpenUpdateDialog, openUserUpdateDialog);\n\n        case 8:\n          _context12.next = 10;\n          return takeEvery(userStore.sagaUpdate, updateUser);\n\n        case 10:\n          _context12.next = 12;\n          return takeEvery(userStore.sagaResetPassword, resetPassword);\n\n        case 12:\n          _context12.next = 14;\n          return takeEvery(userStore.sagaCloseDialog, closeUserDialog);\n\n        case 14:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, _marked12);\n}\n\nexport default userSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/user.saga.ts"],"names":["fetchInitDataForList","fetchDetail","fetchList","fetchInitDataForCE","getUserList","openUserCreateDialog","createUser","openUserUpdateDialog","resetPassword","updateUser","closeUserDialog","userSaga","takeEvery","put","putResolve","select","all","call","v1","uuidv1","advancedFilterActions","commonStore","userStore","authStore","errorSaga","userApi","getProfile","getDefaultValues","getInitDataForList","data","actions","setInitDataForList","id","getDetail","user","job_access","map","item","setDetail","tableState","selectTableState","searchQuery","selectSearchQuery","filterData","selectFilterData","page","per_page","getList","s","setTableState","total_items","setDataList","user_lists","getInitDataForCE","defaultValue","default_language","puco","time_zone","setInitDataForCE","setLoadingPage","selectPermissions","permissions","view","handleError","setDialogStateOpen","payload","setDialogStateLoading","create","message","setSuccessMessage","resetDetail","userId","setDialogState","open","editMode","setResetPwdDialogLoading","selectDetail","update","setResetPwdDialogOpen","formData","selectProfile","profile","user_id","user_name","sagaGetList","sagaOpenCreateDialog","sagaCreate","sagaOpenUpdateDialog","sagaUpdate","sagaResetPassword","sagaCloseDialog"],"mappings":"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","sourcesContent":["import { takeEvery, put, putResolve } from 'redux-saga/effects'\n\nimport { select, all, call } from 'typed-redux-saga'\n\nimport { v1 as uuidv1 } from 'uuid'\n\nimport { advancedFilterActions, commonStore, userStore, authStore } from '@/store/reducers'\n\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport userApi from '@/apis/user.api'\nimport { getProfile } from './auth.saga'\nimport { getDefaultValues } from '@/utils/getDefaultValues'\n\nfunction* fetchInitDataForList() {\n  const data = yield call(userApi.getInitDataForList)\n  yield put(userStore.actions.setInitDataForList(data))\n}\n\nfunction* fetchDetail(id: number) {\n  const { user } = yield call(userApi.getDetail, id)\n  user.job_access = user.job_access.map((item) => ({\n    ...item,\n    id: uuidv1()\n  }))\n  yield put(userStore.actions.setDetail(user))\n}\n\nfunction* fetchList() {\n  const { tableState, searchQuery, filterData } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData)\n  })\n  const { page, per_page } = tableState\n  const data = yield call(userApi.getList, {\n    per_page,\n    page,\n    s: searchQuery,\n    ...filterData\n  })\n  yield put(commonStore.actions.setTableState({ total_items: data.total_items }))\n  yield put(userStore.actions.setDataList(data.user_lists))\n}\n\nfunction* fetchInitDataForCE() {\n  const data = yield call(userApi.getInitDataForCE)\n  const defaultValue = getDefaultValues(data, {\n    default_language: 'parameters.PLLA',\n    puco: 'parameters.PUCO',\n    time_zone: 'timezones'\n  })\n  yield all([put(userStore.actions.setInitDataForCE(data)), put(userStore.actions.setDetail(defaultValue))])\n}\n\nexport function* getUserList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForList)\n    const permissions = yield* select(userStore.selectPermissions)\n    if (permissions.view) {\n      yield call(fetchList)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* openUserCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchInitDataForCE)\n    yield put(userStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* createUser({ payload }: ReturnType<typeof userStore.sagaCreate>) {\n  yield put(userStore.actions.setDialogStateLoading(true))\n  try {\n    const { message } = yield call(userApi.create, payload)\n    yield all([put(commonStore.actions.setSuccessMessage(message)), put(userStore.actions.resetDetail())])\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(userStore.actions.setDialogStateLoading(false))\n}\n\nexport function* openUserUpdateDialog({ payload: userId }: ReturnType<typeof userStore.sagaOpenUpdateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchInitDataForCE)\n    yield call(fetchDetail, userId)\n    yield put(userStore.actions.setDialogState({ open: true, editMode: true }))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* resetPassword({ payload }: ReturnType<typeof userStore.sagaResetPassword>) {\n  yield put(userStore.actions.setResetPwdDialogLoading(true))\n\n  try {\n    const { id } = yield* select(userStore.selectDetail)\n    const { message } = yield call(userApi.update, id, payload)\n    yield all([\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(userStore.actions.setResetPwdDialogOpen(false))\n    ])\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(userStore.actions.setResetPwdDialogLoading(false))\n}\n\nexport function* updateUser({ payload }: ReturnType<typeof userStore.sagaUpdate>) {\n  yield put(userStore.actions.setDialogStateLoading(true))\n\n  try {\n    const { id, formData } = payload\n    const profile = yield* select(authStore.selectProfile)\n    const { message } = yield call(userApi.update, id, formData)\n    yield put(commonStore.actions.setSuccessMessage(message))\n    yield call(closeUserDialog)\n    // fetch profile after updated myself\n    if (formData.user_id === profile.user_name) {\n      yield call(getProfile)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(userStore.actions.setDialogStateLoading(false))\n}\n\nexport function* closeUserDialog() {\n  try {\n    yield putResolve(userStore.actions.setDialogStateOpen(false))\n    yield call(getUserList)\n    yield put(userStore.actions.resetDetail())\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n}\n\nfunction* userSaga() {\n  yield takeEvery(userStore.sagaGetList, getUserList)\n  yield takeEvery(userStore.sagaOpenCreateDialog, openUserCreateDialog)\n  yield takeEvery(userStore.sagaCreate, createUser)\n  yield takeEvery(userStore.sagaOpenUpdateDialog, openUserUpdateDialog)\n  yield takeEvery(userStore.sagaUpdate, updateUser)\n  yield takeEvery(userStore.sagaResetPassword, resetPassword)\n  yield takeEvery(userStore.sagaCloseDialog, closeUserDialog)\n}\n\nexport default userSaga\n"]},"metadata":{},"sourceType":"module"}