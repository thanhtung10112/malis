{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useMemo, useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useFormContext } from 'react-hook-form';\nimport useStyles from './styles';\nimport useDialogContext from '../Context/useDialogContext';\nimport { Grid, Tooltip } from '@material-ui/core';\nimport { MoreHoriz as MoreHorizIcon } from '@material-ui/icons';\nimport { AppTitle, DialogTransferList, TableMultilingualDescription, FormControllerAutocomplete, AppTextField, SectionTimezone, FormControllerTextField } from '@/components';\nimport { Unless } from 'react-if';\nimport parseHTML from 'html-react-parser';\nimport _ from 'lodash';\nimport AppNumber from '@/helper/AppNumber';\nimport { jobStore } from '@/store/reducers';\n\nfunction TabGeneral() {\n  var _jobForm$errors$peopl, _jobForm$errors$squad, _jobForm$errors$job_u;\n\n  const classes = useStyles();\n  const {\n    isCreating\n  } = useDialogContext();\n  const jobForm = useFormContext();\n  const watchPeopleResponsible = jobForm.watch('people_responsible', []);\n  const watchSquadLeader = jobForm.watch('squad_leader', []);\n  const watchDrawingsResponsible = jobForm.watch('drawings_responsible', []);\n  const watchJobUsers = jobForm.watch('job_users', []);\n  const transformPeopleResponsible = watchPeopleResponsible.map(user => user.user_id).join(';');\n  const transformSquadLeader = watchSquadLeader.map(user => user.user_id).join(';');\n  const transformDrawingsResponsible = watchDrawingsResponsible.map(user => user.user_id).join(';');\n  const transformJobUsers = watchJobUsers.map(user => user.user_id).join(';');\n  const dispatch = useDispatch();\n  const {\n    tooltip,\n    parameters,\n    erection_sites,\n    group_map\n  } = useSelector(jobStore.selectInitDataForCE);\n  const tooltipForJobId = parseHTML(tooltip);\n  const transferListState = useSelector(jobStore.selectTransferListState);\n  const keyMapping = useSelector(jobStore.selectKeyMapping);\n  const jobDetail = useSelector(jobStore.selectDetail);\n  const usersAvailableGroup = transferListState.userAvailableList;\n\n  const usersAvailable = _.differenceWith(usersAvailableGroup, transferListState.userGroup, _.isEqual);\n\n  const getTitleForTransferList = () => {\n    switch (keyMapping) {\n      case 'people_responsible':\n        return 'Job Responsible (*)';\n\n      case 'squad_leader':\n        return 'Squad Leader (*)';\n\n      case 'drawings_responsible':\n        return 'Drawing Responsible';\n\n      case 'job_users':\n        return 'Access Group (*)';\n\n      default:\n        return 'Job Responsible (*)';\n    }\n  };\n\n  const titleForTransferList = useMemo(getTitleForTransferList, [keyMapping]);\n  useEffect(() => {\n    if (keyMapping) {\n      const usersGroupInJobDetail = jobForm.watch(keyMapping, []);\n      dispatch(jobStore.actions.setTransferListUserGroup(usersGroupInJobDetail));\n    }\n  }, [jobDetail, keyMapping]);\n\n  const onSaveTransferList = async () => {\n    const {\n      userGroup\n    } = transferListState;\n\n    if (keyMapping !== 'job_users') {\n      const jobUsersGroup = _.unionWith(watchJobUsers, userGroup, _.isEqual);\n\n      jobForm.setValue('job_users', jobUsersGroup);\n      jobForm.setValue(keyMapping, userGroup);\n    } else {\n      jobForm.setValue('job_users', userGroup);\n    } // clear error before submitting\n\n\n    await jobForm.trigger([keyMapping, 'job_users']);\n    dispatch(jobStore.actions.setOpenTransferList(false));\n  };\n\n  const onChangeLeftSideList = list => {\n    dispatch(jobStore.actions.setTransferUserAvailableList(list));\n  };\n\n  const onChangeRightSideList = list => {\n    dispatch(jobStore.actions.setTransferListUserGroup(list));\n  };\n\n  const onOpenTransferList = (userKeyGroup, keyMapping) => () => {\n    dispatch(jobStore.sagaGetUserGroupMapping(userKeyGroup));\n    dispatch(jobStore.actions.setKeyMapping(keyMapping));\n  };\n\n  const onCloseTransferList = () => {\n    dispatch(jobStore.actions.closeTransferList());\n  };\n\n  const handleTransformJobId = event => {\n    const {\n      value\n    } = event.target;\n\n    if (AppNumber.isNumber(value)) {\n      const formatValue = _.padStart(value, 4, '0');\n\n      jobForm.setValue('job_id', formatValue);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 6,\n        children: [/*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          spacing: 2,\n          children: [/*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 6,\n            children: /*#__PURE__*/_jsx(Tooltip, {\n              title: tooltipForJobId,\n              children: /*#__PURE__*/_jsx(FormControllerTextField, {\n                name: \"job_id\",\n                control: jobForm.control,\n                label: \"Job #\",\n                required: true,\n                disabled: !isCreating,\n                onBlur: handleTransformJobId\n              })\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 6,\n            children: /*#__PURE__*/_jsx(FormControllerAutocomplete, {\n              name: \"language\",\n              control: jobForm.control,\n              options: parameters.PLLA,\n              renderOption: option => `${option.parameter_id} - ${option.description}`,\n              label: \"Language\",\n              required: true\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsx(FormControllerAutocomplete, {\n              name: \"equipment_type\",\n              control: jobForm.control,\n              options: parameters.EQTY,\n              label: \"Equipment Type\",\n              required: true,\n              renderOption: option => `${option.parameter_id} - ${option.description}`\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsx(FormControllerAutocomplete, {\n              name: \"erection_site\",\n              control: jobForm.control,\n              options: erection_sites,\n              renderOption: option => `${option.location_id} - ${option.name}`,\n              label: \"Erection Site\",\n              required: true\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          spacing: 2,\n          className: classes.section,\n          children: [/*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsx(AppTitle, {\n              label: \"Communication\"\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 11,\n            children: /*#__PURE__*/_jsx(AppTextField, {\n              label: \"Job Responsible\",\n              disabled: true,\n              required: true,\n              value: transformPeopleResponsible,\n              error: Boolean(jobForm.errors.people_responsible),\n              helperText: (_jobForm$errors$peopl = jobForm.errors.people_responsible) === null || _jobForm$errors$peopl === void 0 ? void 0 : _jobForm$errors$peopl.message,\n              InputLabelProps: {\n                shrink: Boolean(transformPeopleResponsible)\n              }\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 1,\n            children: /*#__PURE__*/_jsx(MoreHorizIcon, {\n              onClick: onOpenTransferList(group_map.job_responsible, 'people_responsible')\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 11,\n            children: /*#__PURE__*/_jsx(AppTextField, {\n              label: \"Coordinators\",\n              disabled: true,\n              required: true,\n              value: transformSquadLeader,\n              error: Boolean(jobForm.errors.squad_leader),\n              helperText: (_jobForm$errors$squad = jobForm.errors.squad_leader) === null || _jobForm$errors$squad === void 0 ? void 0 : _jobForm$errors$squad.message,\n              InputLabelProps: {\n                shrink: Boolean(transformSquadLeader)\n              }\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 1,\n            children: /*#__PURE__*/_jsx(MoreHorizIcon, {\n              onClick: onOpenTransferList(group_map.job_squad_leader, 'squad_leader')\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 11,\n            children: /*#__PURE__*/_jsx(AppTextField, {\n              label: \"Drawings Responsible\",\n              disabled: true,\n              value: transformDrawingsResponsible,\n              InputLabelProps: {\n                shrink: Boolean(transformDrawingsResponsible)\n              }\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 1,\n            children: /*#__PURE__*/_jsx(MoreHorizIcon, {\n              onClick: onOpenTransferList(group_map.job_drawing, 'drawings_responsible')\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          spacing: 2,\n          className: classes.section,\n          children: [/*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 12,\n            children: /*#__PURE__*/_jsx(AppTitle, {\n              label: \"Rights\"\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 11,\n            children: /*#__PURE__*/_jsx(AppTextField, {\n              label: \"Access Group\",\n              required: true,\n              disabled: true,\n              value: transformJobUsers,\n              error: Boolean(jobForm.errors.job_users),\n              helperText: (_jobForm$errors$job_u = jobForm.errors.job_users) === null || _jobForm$errors$job_u === void 0 ? void 0 : _jobForm$errors$job_u.message,\n              InputLabelProps: {\n                shrink: Boolean(transformJobUsers)\n              }\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            xs: 1,\n            children: /*#__PURE__*/_jsx(MoreHorizIcon, {\n              onClick: onOpenTransferList(group_map.job_all, 'job_users')\n            })\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 6,\n        children: [/*#__PURE__*/_jsx(AppTitle, {\n          label: \"Description\"\n        }), /*#__PURE__*/_jsx(TableMultilingualDescription, {\n          tableHeight: 315,\n          name: \"job_descriptions\",\n          editMode: !isCreating,\n          control: jobForm.control,\n          className: classes.section,\n          languageList: parameters.PLLA\n        })]\n      }), /*#__PURE__*/_jsx(Unless, {\n        condition: isCreating,\n        children: /*#__PURE__*/_jsx(Grid, {\n          item: true,\n          xs: 12,\n          style: {\n            padding: '0 12px'\n          },\n          children: /*#__PURE__*/_jsx(SectionTimezone, {\n            value: jobDetail,\n            style: {\n              padding: 0,\n              marginTop: 0\n            }\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsx(DialogTransferList, {\n      title: titleForTransferList,\n      open: transferListState.open,\n      leftSideList: usersAvailable,\n      rightSideList: transferListState.userGroup,\n      titleLeft: \"Available Users\",\n      titleRight: titleForTransferList,\n      onSave: onSaveTransferList,\n      onClose: onCloseTransferList,\n      onChangeLeftSideList: onChangeLeftSideList,\n      onChangeRightSideList: onChangeRightSideList\n    })]\n  });\n}\n\nexport default TabGeneral;","map":null,"metadata":{},"sourceType":"module"}