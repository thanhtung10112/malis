{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createElement as _createElement } from \"react\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useMemo, useEffect, useCallback } from 'react';\nimport { useRouter } from 'next/router';\nimport useStyles from './styles';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport Head from 'next/head';\nimport { Paper, Grid } from '@material-ui/core';\nimport { DataGrid } from '@material-ui/data-grid';\nimport { When, Unless } from 'react-if';\nimport { AdvancedFilter, MakeAList, AppBreadcrumb, MalisNoViewPermissionOnModule, Footer, DataTablePagination, DataTableLoadingOverlay, DataTableNoRowsOverlay, AppButton, DataTableColumnMenu, AppSearchBar } from '@/components';\nimport clsx from 'clsx';\nimport _ from 'lodash';\nimport { advancedFilterActions, commonStore, equivalenceStore } from '@/store/reducers';\nimport { createAction } from '@reduxjs/toolkit';\nimport { actionTypes } from '@/utils/constant';\nimport { TABLE_HEIGHT_INCLUDE_FOOTER } from '@/styles/vars/size';\nimport AppNumber from '@/helper/AppNumber';\n\nvar Layout = function Layout(props) {\n  var breadcrumbs = props.breadcrumbs,\n      buttons = props.buttons,\n      Dialogs = props.Dialogs,\n      Options = props.Options,\n      tableProps = props.tableProps,\n      exportable = props.exportable,\n      permissions = props.permissions,\n      searchProps = props.searchProps,\n      filterable = props.filterable,\n      leftSection = props.leftSection,\n      tableSection = props.tableSection,\n      bottomSection = props.bottomSection,\n      tableHeight = props.tableHeight,\n      entity = props.entity,\n      wikiPage = props.wikiPage;\n  var classes = useStyles();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var router = useRouter();\n  var dispatch = useDispatch();\n  var equivalenceType = useSelector(equivalenceStore.selectEquivalenceType);\n  var isOpenAF = useSelector(advancedFilterActions.selectOpenAdvanceSearch);\n  var tableState = useSelector(commonStore.selectTableState);\n\n  var _useSelector = useSelector(commonStore.selectLoading),\n      loadingTable = _useSelector.table;\n\n  var selectedRows = useSelector(commonStore.selectSelectedRows);\n  var editRows = useSelector(commonStore.selectEditRows);\n  var entityApp = useMemo(function () {\n    if (entity === 'manufacturing_standard' || entity === 'material_standard') {\n      return 'equivalence';\n    }\n\n    return entity;\n  }, [entity]);\n  var headTitle = useMemo(function () {\n    if (!entityApp) {\n      return t('common:loading');\n    }\n\n    if (entityApp === 'equivalence') {\n      if (equivalenceType) {\n        return t(\"\".concat(entityApp, \":head_title_\").concat(equivalenceType));\n      }\n\n      return t('common:loading');\n    }\n\n    return t(\"\".concat(entityApp, \":head_title\"));\n  }, [entityApp, equivalenceType]);\n  var dataList = useSelector(function (state) {\n    var _state$entityApp;\n\n    if (!entityApp) {\n      return [];\n    }\n\n    return ((_state$entityApp = state[entityApp]) === null || _state$entityApp === void 0 ? void 0 : _state$entityApp.dataList) || [];\n  });\n  var getListAction = useMemo(function () {\n    return createAction(\"\".concat(entityApp, \"/\").concat(actionTypes.GET_LIST));\n  }, [entityApp]);\n  var resetStateAction = useMemo(function () {\n    return createAction(\"\".concat(entityApp, \"/\").concat(actionTypes.RESET_STATE));\n  }, [entityApp]);\n  var openCreateDialogAct = useMemo(function () {\n    return createAction(\"\".concat(entityApp, \"/\").concat(actionTypes.OPEN_CREATE_DIALOG));\n  }, [entityApp]);\n  var openUpdateDialogAct = useMemo(function () {\n    return createAction(\"\".concat(entityApp, \"/\").concat(actionTypes.OPEN_UPDATE_DIALOG));\n  }, [entityApp]);\n  useEffect(function () {\n    if (!entity) {\n      return;\n    }\n\n    dispatch(commonStore.actions.setEntity(entity));\n    dispatch(getListAction());\n    return function () {\n      dispatch(resetStateAction());\n    };\n  }, [entity, resetStateAction, getListAction]);\n  useEffect(function () {\n    if (selectedRows.length > 0) {\n      dispatch(commonStore.actions.setSelectedRows([]));\n    }\n\n    if (editRows.length > 0) {\n      dispatch(commonStore.actions.setEditRows([]));\n    }\n  }, [dataList]);\n  useEffect(function () {\n    var _router$query = router.query,\n        id = _router$query.id,\n        action = _router$query.action;\n\n    if (AppNumber.isNumber(id) && action === 'update') {\n      dispatch(openUpdateDialogAct(router.query.id));\n    } else if (action === 'create') {\n      dispatch(openCreateDialogAct());\n    }\n  }, [entityApp, actionTypes, router.query.id, router.query.action]);\n  var renderButtons = useCallback(function () {\n    if (_.isArray(buttons)) {\n      return buttons.filter(function (button) {\n        return !button.hide;\n      }).map(function (_ref, index) {\n        var label = _ref.label,\n            hide = _ref.hide,\n            className = _ref.className,\n            buttonProps = _objectWithoutProperties(_ref, [\"label\", \"hide\", \"className\"]);\n\n        return /*#__PURE__*/_createElement(AppButton, _objectSpread(_objectSpread({}, buttonProps), {}, {\n          key: index,\n          className: clsx(className, classes.buttonControl)\n        }), label);\n      });\n    }\n\n    return /*#__PURE__*/_jsx(AppButton, _objectSpread(_objectSpread({}, buttons), {}, {\n      className: clsx(buttons === null || buttons === void 0 ? void 0 : buttons.className, classes.buttonControl),\n      children: buttons === null || buttons === void 0 ? void 0 : buttons.label\n    }));\n  }, [buttons]);\n\n  var handleChangePage = function handleChangePage(page) {\n    dispatch(commonStore.actions.setTableState({\n      page: page\n    }));\n    dispatch(getListAction());\n  };\n\n  var handleChangePerpage = function handleChangePerpage(per_page) {\n    dispatch(commonStore.actions.setTableState({\n      per_page: per_page\n    }));\n    handleChangePage(1);\n  };\n\n  var handleSearch = function handleSearch(event, query) {\n    dispatch(commonStore.actions.setSearchQuery(query));\n    handleChangePage(1);\n  };\n\n  var handleSelectRows = function handleSelectRows(_ref2) {\n    var selectionModel = _ref2.selectionModel;\n    dispatch(commonStore.actions.setSelectedRows(selectionModel));\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(Head, {\n      children: /*#__PURE__*/_jsx(\"title\", {\n        children: headTitle\n      })\n    }), /*#__PURE__*/_jsx(AppBreadcrumb, {\n      items: breadcrumbs,\n      wikiPage: wikiPage\n    }), /*#__PURE__*/_jsxs(Paper, {\n      elevation: 1,\n      className: classes.main,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: classes.control,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: classes.wrapControl,\n          children: [/*#__PURE__*/_jsx(AppSearchBar, _objectSpread(_objectSpread({\n            onSearch: handleSearch,\n            width: 500,\n            placeholder: t(\"\".concat(entityApp, \":search_placeholder\")),\n            filterable: filterable\n          }, searchProps), {}, {\n            disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.view)\n          })), Options]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"\",\n          children: renderButtons()\n        })]\n      }), /*#__PURE__*/_jsx(When, {\n        condition: isOpenAF,\n        children: /*#__PURE__*/_jsx(AdvancedFilter, {})\n      }), /*#__PURE__*/_jsxs(When, {\n        condition: permissions === null || permissions === void 0 ? void 0 : permissions.view,\n        children: [/*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          style: {\n            height: tableHeight || TABLE_HEIGHT_INCLUDE_FOOTER,\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsx(Unless, {\n            condition: leftSection === null || leftSection === void 0 ? void 0 : leftSection.hide,\n            children: /*#__PURE__*/_jsx(Grid, _objectSpread(_objectSpread(_objectSpread({\n              item: true\n            }, leftSection.breakPoint), _.omit(leftSection, ['breakPoint', 'hide', 'Component'])), {}, {\n              children: leftSection.Component\n            }))\n          }), /*#__PURE__*/_jsx(Grid, _objectSpread(_objectSpread({\n            item: true\n          }, tableSection === null || tableSection === void 0 ? void 0 : tableSection.breakPoint), {}, {\n            children: /*#__PURE__*/_jsx(DataGrid, _objectSpread({\n              checkboxSelection: true,\n              loading: loadingTable,\n              rows: dataList,\n              headerHeight: 30,\n              rowHeight: 30,\n              hideFooter: true,\n              selectionModel: selectedRows,\n              onSelectionModelChange: handleSelectRows,\n              components: {\n                LoadingOverlay: DataTableLoadingOverlay,\n                NoRowsOverlay: DataTableNoRowsOverlay,\n                ColumnMenu: DataTableColumnMenu\n              },\n              onCellClick: function onCellClick(params, event) {\n                if (params.field === 'id') {\n                  event.stopPropagation();\n                }\n              }\n            }, tableProps))\n          }))]\n        }), bottomSection, /*#__PURE__*/_jsx(DataTablePagination, {\n          countSelectedItems: selectedRows.length,\n          page: tableState.page,\n          perPage: tableState.per_page,\n          totalItems: tableState.total_items,\n          onChangePage: handleChangePage,\n          onChangePerPage: handleChangePerpage\n        }), /*#__PURE__*/_jsx(Footer, {})]\n      }), /*#__PURE__*/_jsx(When, {\n        condition: !_.isNil(permissions) && (permissions === null || permissions === void 0 ? void 0 : permissions.view) === false,\n        children: /*#__PURE__*/_jsx(MalisNoViewPermissionOnModule, {})\n      })]\n    }), Dialogs, /*#__PURE__*/_jsx(When, {\n      condition: exportable,\n      children: /*#__PURE__*/_jsx(MakeAList, {})\n    })]\n  });\n};\n\nLayout.defaultProps = {\n  filterable: true,\n  exportable: true,\n  permissions: null,\n  tableProps: {\n    columns: []\n  },\n  tableSection: {\n    breakPoint: {\n      xs: 12\n    }\n  },\n  leftSection: {}\n};\nexport default Layout;","map":null,"metadata":{},"sourceType":"module"}