{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useEffect, useMemo, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport useStyles from './styles';\nimport { useForm } from 'react-hook-form';\nimport { Grid, Typography } from '@material-ui/core';\nimport SyncAltIcon from '@material-ui/icons/SyncAlt';\nimport { FormControllerAutocomplete, FormControllerTextField, SectionTimezone, DialogMain, AppTabHistoryLog, FormControllerTabs, FormControllerNumberField, BtnHelp } from '@/components';\nimport { Unless } from 'react-if';\nimport _ from 'lodash';\nimport { currencyStore } from '@/store/reducers';\nimport { currencyRateFormat } from '@/utils/constant';\nimport clsx from 'clsx';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport getValidationSchema from './validationSchema';\n\nfunction CurrencyAddEditDialog() {\n  const {\n    t\n  } = useTranslation('currency');\n  const classes = useStyles();\n  const {\n    0: tab,\n    1: setTab\n  } = useState(0);\n  const dispatch = useDispatch();\n  const dialogState = useSelector(currencyStore.selectDialogState);\n  const initDataForCE = useSelector(currencyStore.selectInitDataForCE);\n  const baseCurrency = useSelector(currencyStore.selectUserBaseCurrency);\n  const currencyDetail = useSelector(currencyStore.selectDetail);\n  const permissions = useSelector(currencyStore.selectPermissions);\n  const {\n    wiki_page\n  } = useSelector(currencyStore.selectInitDataForCE);\n\n  const isCreating = _.isNil(currencyDetail.id);\n\n  const titleDialog = isCreating ? t('form.create_currency') : t('form.update_currency');\n  const validationSchema = useMemo(() => getValidationSchema(t), []);\n  const currencyForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  });\n  const watchCurrencyId = currencyForm.watch('currency_id', '');\n  const watchIsBaseRateMode = currencyForm.watch('is_base_rate_mode', false);\n  const disableSwapRating = !isCreating && !currencyDetail.base_currency;\n  useEffect(() => {\n    const resetData = _objectSpread({}, currencyDetail);\n\n    if (_.isNil(currencyDetail.is_base_rate_mode)) {\n      resetData.is_base_rate_mode = false;\n    }\n\n    currencyForm.reset(_objectSpread({}, resetData));\n  }, [currencyDetail]);\n\n  const handleClose = () => {\n    currencyForm.clearErrors();\n    setTab(0);\n    dispatch(currencyStore.sagaCloseDialog());\n  };\n\n  const onSwapRateMode = () => {\n    if (!disableSwapRating) {\n      currencyForm.setValue('is_base_rate_mode', !watchIsBaseRateMode);\n      currencyForm.setValue('multiplier', null);\n      currencyForm.setValue('rate', '');\n      currencyForm.unregister('rate');\n      currencyForm.clearErrors(['rate', 'multiplier']);\n    }\n  };\n\n  const onSubmitData = currencyForm.handleSubmit(formData => {\n    const data = _.pick(formData, ['base_currency', 'currency_id', 'description', 'is_base_rate_mode', 'multiplier', 'rate', 'round_to']);\n\n    if (isCreating) {\n      data.base_currency = baseCurrency.id;\n      dispatch(currencyStore.sagaCreate(data));\n    } else {\n      dispatch(currencyStore.sagaUpdate({\n        id: formData.id,\n        formData: data\n      }));\n    }\n  });\n\n  const handleChangeTab = (_, nextTab) => {\n    setTab(nextTab);\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(currencyStore.actions.setHistoryLogs(data));\n  };\n\n  const TabGeneral = /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      spacing: 2,\n      style: {\n        marginTop: 8\n      },\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsx(FormControllerTextField, {\n          name: \"currency_id\",\n          control: currencyForm.control,\n          label: t('label.code'),\n          required: true,\n          disabled: !isCreating,\n          transformValue: value => _.toUpper(value),\n          limitText: 3\n        })\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsx(FormControllerAutocomplete, {\n          disableClearable: true,\n          control: currencyForm.control,\n          name: \"round_to\",\n          options: initDataForCE.round_to_options,\n          renderOption: option => option.description,\n          label: t('label.round_to'),\n          required: true\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(Grid, {\n      className: classes.gridTop,\n      container: true,\n      spacing: 2,\n      children: [/*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 5,\n        className: classes.wrapContent,\n        children: [/*#__PURE__*/_jsx(FormControllerAutocomplete, {\n          disableClearable: true,\n          control: currencyForm.control,\n          name: \"multiplier\",\n          options: initDataForCE.multiplier_options,\n          disabled: !isCreating && !currencyDetail.base_currency,\n          renderOption: option => option.description,\n          primaryKeyOption: \"value\",\n          style: {\n            width: '100%'\n          },\n          label: \"Multiplier\",\n          required: true\n        }), /*#__PURE__*/_jsx(Typography, {\n          display: \"inline\",\n          variant: \"caption\",\n          className: classes.multiplierLabel,\n          children: watchIsBaseRateMode ? baseCurrency.currency_id : watchCurrencyId\n        })]\n      }), /*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 2,\n        className: classes.wrapSymbol,\n        children: [/*#__PURE__*/_jsx(SyncAltIcon, {\n          className: clsx(classes.syncAltIcon, disableSwapRating && classes.disabled),\n          onClick: onSwapRateMode\n        }), /*#__PURE__*/_jsx(Typography, {\n          display: \"inline\",\n          variant: \"caption\",\n          className: classes.symbolEqual,\n          children: \"=\"\n        })]\n      }), /*#__PURE__*/_jsxs(Grid, {\n        item: true,\n        xs: 5,\n        className: classes.wrapContent,\n        children: [/*#__PURE__*/_jsx(FormControllerNumberField, {\n          control: currencyForm.control,\n          name: \"rate\",\n          label: \"Rate\",\n          required: true,\n          disabled: !isCreating && !currencyDetail.base_currency,\n          decimalScale: currencyRateFormat.precision,\n          fixedDecimalScale: currencyRateFormat.precision\n        }), /*#__PURE__*/_jsx(Typography, {\n          display: \"inline\",\n          variant: \"caption\",\n          className: classes.multiplierLabel,\n          children: watchIsBaseRateMode ? watchCurrencyId : baseCurrency.currency_id\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(Grid, {\n      className: classes.gridTop,\n      container: true,\n      spacing: 1,\n      children: /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsx(FormControllerTextField, {\n          control: currencyForm.control,\n          label: t('label.description'),\n          multiline: true,\n          rows: 12,\n          name: \"description\"\n        })\n      })\n    }), /*#__PURE__*/_jsx(Unless, {\n      condition: isCreating,\n      children: /*#__PURE__*/_jsx(SectionTimezone, {\n        value: currencyDetail\n      })\n    })]\n  });\n\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: TabGeneral,\n    errorKey: ['currency_id', 'multiplier', 'rate', 'round_to', 'description']\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    disabled: isCreating,\n    panel: /*#__PURE__*/_jsx(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: currencyDetail.id,\n      tableHeight: 250,\n      entity: \"currency\"\n    })\n  };\n  const tabs = [generalTab, historyTab];\n  return /*#__PURE__*/_jsx(DialogMain, {\n    open: dialogState.open,\n    title: /*#__PURE__*/_jsx(BtnHelp, {\n      title: titleDialog,\n      href: wiki_page\n    }),\n    onOk: onSubmitData,\n    onClose: handleClose,\n    loading: dialogState.loading,\n    height: 470,\n    okButtonProps: {\n      disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating\n    },\n    okText: isCreating ? t('common:button.create') : t('common:button.update'),\n    children: /*#__PURE__*/_jsx(FormControllerTabs, {\n      value: tab,\n      onChange: handleChangeTab,\n      form: currencyForm,\n      tabs: tabs\n    })\n  });\n}\n\nexport default CurrencyAddEditDialog;","map":null,"metadata":{},"sourceType":"module"}