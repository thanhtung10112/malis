{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForList),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForCE),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(fetchList),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchDetail),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(getList),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(openCreateDialog),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(executeOperation),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(closeDialog),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(create),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(openUpdateDialog),\n    _marked11 = /*#__PURE__*/_regeneratorRuntime.mark(update),\n    _marked12 = /*#__PURE__*/_regeneratorRuntime.mark(parameterSaga);\n\nimport { takeEvery, put, takeLatest, putResolve } from 'redux-saga/effects';\nimport { call, select, all } from 'typed-redux-saga';\nimport immer from 'immer';\nimport Router from 'next/router';\nimport parameterApi from '@/apis/parameter.api';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport { parameterStore, advancedFilterActions, commonStore, summaryReportActions } from '@/store/reducers';\n\nfunction fetchInitDataForList() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchInitDataForList$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return call(parameterApi.getInitDataForList);\n\n        case 2:\n          data = _context.sent;\n          _context.next = 5;\n          return put(parameterStore.actions.setInitDataForList(data));\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction fetchInitDataForCE() {\n  var param_type_id, _yield$call, permissions, response;\n\n  return _regeneratorRuntime.wrap(function fetchInitDataForCE$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          param_type_id = Router.query.param_type_id;\n          _context2.next = 3;\n          return call(parameterApi.getInitDataForCE, {\n            param_type_id: param_type_id\n          });\n\n        case 3:\n          _yield$call = _context2.sent;\n          permissions = _yield$call.permissions;\n          response = _objectWithoutProperties(_yield$call, [\"permissions\"]);\n          _context2.next = 8;\n          return all([put(parameterStore.actions.setPermissions(permissions)), put(parameterStore.actions.setInitDataForCE(response)), put(parameterStore.actions.setDetail({\n            parameter_type_id: param_type_id\n          }))]);\n\n        case 8:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction fetchList() {\n  var param_type_id, _yield$all, tableState, searchQuery, filterData, page, per_page, data;\n\n  return _regeneratorRuntime.wrap(function fetchList$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          param_type_id = Router.query.param_type_id;\n          return _context3.delegateYield(all({\n            tableState: select(commonStore.selectTableState),\n            searchQuery: select(commonStore.selectSearchQuery),\n            filterData: select(advancedFilterActions.selectFilterData)\n          }), \"t0\", 2);\n\n        case 2:\n          _yield$all = _context3.t0;\n          tableState = _yield$all.tableState;\n          searchQuery = _yield$all.searchQuery;\n          filterData = _yield$all.filterData;\n          page = tableState.page, per_page = tableState.per_page;\n          _context3.next = 9;\n          return call(parameterApi.getList, param_type_id, _objectSpread({\n            per_page: per_page,\n            page: page,\n            s: searchQuery\n          }, filterData));\n\n        case 9:\n          data = _context3.sent;\n          _context3.next = 12;\n          return all([put(commonStore.actions.setTableState({\n            total_items: data.total_items\n          })), put(parameterStore.actions.setData(data.parameters)), put(parameterStore.actions.setParameterType(data.parameter_type))]);\n\n        case 12:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction fetchDetail(id) {\n  var _yield$call2, parameter, _yield$select, is_multilingual, formatParameter;\n\n  return _regeneratorRuntime.wrap(function fetchDetail$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(parameterApi.getDetail, id);\n\n        case 2:\n          _yield$call2 = _context4.sent;\n          parameter = _yield$call2.parameter;\n          return _context4.delegateYield(select(parameterStore.selectInitDataForCE), \"t0\", 5);\n\n        case 5:\n          _yield$select = _context4.t0;\n          is_multilingual = _yield$select.is_multilingual;\n          formatParameter = immer(parameter, function (draft) {\n            if (is_multilingual) {\n              draft.descriptions = draft.multilingual_descriptions;\n              delete draft.multilingual_descriptions;\n            }\n          });\n          _context4.next = 10;\n          return put(parameterStore.actions.setDetail(formatParameter));\n\n        case 10:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nfunction getList() {\n  var viewPermission;\n  return _regeneratorRuntime.wrap(function getList$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context5.prev = 2;\n          _context5.next = 5;\n          return call(fetchInitDataForList);\n\n        case 5:\n          return _context5.delegateYield(select(parameterStore.selectViewPermission), \"t0\", 6);\n\n        case 6:\n          viewPermission = _context5.t0;\n\n          if (!viewPermission) {\n            _context5.next = 10;\n            break;\n          }\n\n          _context5.next = 10;\n          return call(fetchList);\n\n        case 10:\n          _context5.next = 16;\n          break;\n\n        case 12:\n          _context5.prev = 12;\n          _context5.t1 = _context5[\"catch\"](2);\n          _context5.next = 16;\n          return errorSaga.handleError(_context5.t1);\n\n        case 16:\n          _context5.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[2, 12]]);\n}\n\nfunction openCreateDialog() {\n  return _regeneratorRuntime.wrap(function openCreateDialog$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchInitDataForCE);\n\n        case 5:\n          _context6.next = 7;\n          return put(parameterStore.actions.setDialogState({\n            open: true,\n            editMode: false\n          }));\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return errorSaga.handleError(_context6.t0);\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\n\nfunction executeOperation(_ref) {\n  var payload, operation, parameters, data;\n  return _regeneratorRuntime.wrap(function executeOperation$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref.payload;\n          _context7.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context7.prev = 3;\n          operation = payload.operation, parameters = payload.parameters;\n          _context7.next = 7;\n          return call(parameterApi.executeOperation, operation, parameters);\n\n        case 7:\n          data = _context7.sent;\n          _context7.next = 10;\n          return call(fetchList);\n\n        case 10:\n          if (!(data.failed_count > 0)) {\n            _context7.next = 17;\n            break;\n          }\n\n          _context7.next = 13;\n          return put(summaryReportActions.setReportData(data));\n\n        case 13:\n          _context7.next = 15;\n          return put(summaryReportActions.setOpen(true));\n\n        case 15:\n          _context7.next = 19;\n          break;\n\n        case 17:\n          _context7.next = 19;\n          return put(commonStore.actions.setSuccessMessage(data.message));\n\n        case 19:\n          _context7.next = 25;\n          break;\n\n        case 21:\n          _context7.prev = 21;\n          _context7.t0 = _context7[\"catch\"](3);\n          _context7.next = 25;\n          return errorSaga.handleError(_context7.t0);\n\n        case 25:\n          _context7.next = 27;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 27:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 21]]);\n}\n\nfunction closeDialog() {\n  return _regeneratorRuntime.wrap(function closeDialog$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _context8.next = 3;\n          return putResolve(parameterStore.actions.setDialogStateOpen(false));\n\n        case 3:\n          _context8.next = 5;\n          return call(getList);\n\n        case 5:\n          _context8.next = 7;\n          return all([put(parameterStore.actions.setDialogStateEditMode(false)), put(parameterStore.actions.resetLocationDetail())]);\n\n        case 7:\n          _context8.next = 13;\n          break;\n\n        case 9:\n          _context8.prev = 9;\n          _context8.t0 = _context8[\"catch\"](0);\n          _context8.next = 13;\n          return errorSaga.handleError(_context8.t0);\n\n        case 13:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[0, 9]]);\n}\n\nfunction create(_ref2) {\n  var payload, _yield$call3, message;\n\n  return _regeneratorRuntime.wrap(function create$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context9.next = 3;\n          return put(parameterStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context9.prev = 3;\n          _context9.next = 6;\n          return call(parameterApi.create, payload);\n\n        case 6:\n          _yield$call3 = _context9.sent;\n          message = _yield$call3.message;\n          _context9.next = 10;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 10:\n          _context9.next = 12;\n          return put(parameterStore.actions.resetLocationDetail());\n\n        case 12:\n          _context9.next = 18;\n          break;\n\n        case 14:\n          _context9.prev = 14;\n          _context9.t0 = _context9[\"catch\"](3);\n          _context9.next = 18;\n          return errorSaga.handleError(_context9.t0);\n\n        case 18:\n          _context9.next = 20;\n          return put(parameterStore.actions.setDialogStateLoading(false));\n\n        case 20:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9, null, [[3, 14]]);\n}\n\nfunction openUpdateDialog(_ref3) {\n  var id;\n  return _regeneratorRuntime.wrap(function openUpdateDialog$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          id = _ref3.payload;\n          _context10.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context10.prev = 3;\n          _context10.next = 6;\n          return call(fetchInitDataForCE);\n\n        case 6:\n          _context10.next = 8;\n          return call(fetchDetail, id);\n\n        case 8:\n          _context10.next = 10;\n          return put(parameterStore.actions.setDialogState({\n            editMode: true,\n            open: true\n          }));\n\n        case 10:\n          _context10.next = 16;\n          break;\n\n        case 12:\n          _context10.prev = 12;\n          _context10.t0 = _context10[\"catch\"](3);\n          _context10.next = 16;\n          return errorSaga.handleError(_context10.t0);\n\n        case 16:\n          _context10.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10, null, [[3, 12]]);\n}\n\nfunction update(_ref4) {\n  var payload, _yield$call4, message;\n\n  return _regeneratorRuntime.wrap(function update$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          payload = _ref4.payload;\n          _context11.next = 3;\n          return put(parameterStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context11.prev = 3;\n          _context11.next = 6;\n          return call(parameterApi.update, payload.id, payload.formData);\n\n        case 6:\n          _yield$call4 = _context11.sent;\n          message = _yield$call4.message;\n          _context11.next = 10;\n          return call(closeDialog);\n\n        case 10:\n          _context11.next = 12;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 12:\n          _context11.next = 18;\n          break;\n\n        case 14:\n          _context11.prev = 14;\n          _context11.t0 = _context11[\"catch\"](3);\n          _context11.next = 18;\n          return errorSaga.handleError(_context11.t0);\n\n        case 18:\n          _context11.next = 20;\n          return put(parameterStore.actions.setDialogStateLoading(false));\n\n        case 20:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, _marked11, null, [[3, 14]]);\n}\n\nfunction parameterSaga() {\n  return _regeneratorRuntime.wrap(function parameterSaga$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return takeEvery(parameterStore.extraActions.getList, getList);\n\n        case 2:\n          _context12.next = 4;\n          return takeLatest(parameterStore.extraActions.executeOperation, executeOperation);\n\n        case 4:\n          _context12.next = 6;\n          return takeEvery(parameterStore.extraActions.openCreateDialog, openCreateDialog);\n\n        case 6:\n          _context12.next = 8;\n          return takeEvery(parameterStore.extraActions.closeDialog, closeDialog);\n\n        case 8:\n          _context12.next = 10;\n          return takeLatest(parameterStore.extraActions.create, create);\n\n        case 10:\n          _context12.next = 12;\n          return takeLatest(parameterStore.extraActions.openUpdateDialog, openUpdateDialog);\n\n        case 12:\n          _context12.next = 14;\n          return takeLatest(parameterStore.extraActions.update, update);\n\n        case 14:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, _marked12);\n}\n\nexport default parameterSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/parameter.saga.ts"],"names":["fetchInitDataForList","fetchInitDataForCE","fetchList","fetchDetail","getList","openCreateDialog","executeOperation","closeDialog","create","openUpdateDialog","update","parameterSaga","takeEvery","put","takeLatest","putResolve","call","select","all","immer","Router","parameterApi","errorSaga","parameterStore","advancedFilterActions","commonStore","summaryReportActions","getInitDataForList","data","actions","setInitDataForList","param_type_id","query","getInitDataForCE","permissions","response","setPermissions","setInitDataForCE","setDetail","parameter_type_id","tableState","selectTableState","searchQuery","selectSearchQuery","filterData","selectFilterData","page","per_page","s","setTableState","total_items","setData","parameters","setParameterType","parameter_type","id","getDetail","parameter","selectInitDataForCE","is_multilingual","formatParameter","draft","descriptions","multilingual_descriptions","setLoadingPage","selectViewPermission","viewPermission","handleError","setDialogState","open","editMode","payload","operation","failed_count","setReportData","setOpen","setSuccessMessage","message","setDialogStateOpen","setDialogStateEditMode","resetLocationDetail","setDialogStateLoading","formData","extraActions"],"mappings":"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","sourcesContent":["import { takeEvery, put, takeLatest, putResolve } from 'redux-saga/effects'\nimport { call, select, all } from 'typed-redux-saga'\nimport immer from 'immer'\nimport Router from 'next/router'\n\nimport parameterApi from '@/apis/parameter.api'\n\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport { parameterStore, advancedFilterActions, commonStore, summaryReportActions } from '@/store/reducers'\n\nfunction* fetchInitDataForList() {\n  const data = yield call(parameterApi.getInitDataForList)\n  yield put(parameterStore.actions.setInitDataForList(data))\n}\n\nfunction* fetchInitDataForCE() {\n  const { param_type_id } = Router.query\n  const { permissions, ...response } = yield call(parameterApi.getInitDataForCE, {\n    param_type_id\n  })\n  yield all([\n    put(parameterStore.actions.setPermissions(permissions)),\n    put(parameterStore.actions.setInitDataForCE(response)),\n    put(parameterStore.actions.setDetail({ parameter_type_id: param_type_id }))\n  ])\n}\n\nfunction* fetchList() {\n  const { param_type_id } = Router.query\n  const { tableState, searchQuery, filterData } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData)\n  })\n  const { page, per_page } = tableState\n  const data = yield call(parameterApi.getList, param_type_id as string, {\n    per_page,\n    page,\n    s: searchQuery,\n    ...filterData\n  })\n  yield all([\n    put(commonStore.actions.setTableState({ total_items: data.total_items })),\n    put(parameterStore.actions.setData(data.parameters)),\n    put(parameterStore.actions.setParameterType(data.parameter_type))\n  ])\n}\n\nfunction* fetchDetail(id: number) {\n  const { parameter } = yield call(parameterApi.getDetail, id)\n  const { is_multilingual } = yield* select(parameterStore.selectInitDataForCE)\n  const formatParameter = immer(parameter, (draft: any) => {\n    if (is_multilingual) {\n      draft.descriptions = draft.multilingual_descriptions\n      delete draft.multilingual_descriptions\n    }\n  })\n  yield put(parameterStore.actions.setDetail(formatParameter))\n}\n\nfunction* getList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForList)\n    const viewPermission = yield* select(parameterStore.selectViewPermission)\n    if (viewPermission) {\n      yield call(fetchList)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* openCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchInitDataForCE)\n    yield put(parameterStore.actions.setDialogState({ open: true, editMode: false }))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* executeOperation({ payload }) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { operation, parameters } = payload\n    const data = yield call(parameterApi.executeOperation, operation, parameters)\n    yield call(fetchList)\n    if (data.failed_count > 0) {\n      yield put(summaryReportActions.setReportData(data))\n      yield put(summaryReportActions.setOpen(true))\n    } else {\n      yield put(commonStore.actions.setSuccessMessage(data.message))\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* closeDialog() {\n  try {\n    yield putResolve(parameterStore.actions.setDialogStateOpen(false))\n    yield call(getList)\n    yield all([\n      put(parameterStore.actions.setDialogStateEditMode(false)),\n      put(parameterStore.actions.resetLocationDetail())\n    ])\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n}\n\nfunction* create({ payload }) {\n  yield put(parameterStore.actions.setDialogStateLoading(true))\n  try {\n    const { message } = yield call(parameterApi.create, payload)\n    yield put(commonStore.actions.setSuccessMessage(message))\n    yield put(parameterStore.actions.resetLocationDetail())\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(parameterStore.actions.setDialogStateLoading(false))\n}\n\nfunction* openUpdateDialog({ payload: id }) {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchInitDataForCE)\n    yield call(fetchDetail, id)\n    yield put(parameterStore.actions.setDialogState({ editMode: true, open: true }))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* update({ payload }) {\n  yield put(parameterStore.actions.setDialogStateLoading(true))\n\n  try {\n    const { message } = yield call(parameterApi.update, payload.id, payload.formData)\n    yield call(closeDialog)\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(parameterStore.actions.setDialogStateLoading(false))\n}\n\nfunction* parameterSaga() {\n  yield takeEvery(parameterStore.extraActions.getList, getList)\n  yield takeLatest(parameterStore.extraActions.executeOperation, executeOperation)\n  yield takeEvery(parameterStore.extraActions.openCreateDialog, openCreateDialog)\n  yield takeEvery(parameterStore.extraActions.closeDialog, closeDialog)\n  yield takeLatest(parameterStore.extraActions.create, create)\n  yield takeLatest(parameterStore.extraActions.openUpdateDialog, openUpdateDialog)\n  yield takeLatest(parameterStore.extraActions.update, update)\n}\n\nexport default parameterSaga\n"]},"metadata":{},"sourceType":"module"}