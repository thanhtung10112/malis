{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchGenerateCode),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(openPartCreateDialog),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(createPart),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchPartDetail),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(openPartUpdateDialog),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(closePartDialog),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(openManuDialog),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(createManu),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(closeManuDialog),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(getManuId),\n    _marked11 = /*#__PURE__*/_regeneratorRuntime.mark(getItemCopy),\n    _marked12 = /*#__PURE__*/_regeneratorRuntime.mark(getDrawingItems),\n    _marked13 = /*#__PURE__*/_regeneratorRuntime.mark(partSaga);\n\nimport { takeLatest, call, put, putResolve, takeEvery } from 'redux-saga/effects';\nimport { select, all } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { partStore, commonStore } from '@/store/reducers';\nimport { getDefaultValues } from '@/utils/getDefaultValues';\nimport { isAssemblyByDpn } from '@/utils/isAssembly';\nimport itemApi from '@/apis/item.api';\nimport assemblyApi from '@/apis/assembly.api';\nimport partRefApi from '@/apis/part.api';\nimport manufacturerApi from '@/apis/manufacturer.api';\nimport drawingApi from '@/apis/drawing.api';\n\nvar getPartApi = function getPartApi(entity) {\n  return entity === 'item' ? itemApi : assemblyApi;\n};\n\nfunction fetchGenerateCode(entity, drawing) {\n  var partApi, _yield$call, generated_code;\n\n  return _regeneratorRuntime.wrap(function fetchGenerateCode$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          partApi = getPartApi(entity);\n          _context.next = 3;\n          return call(partApi.getGenerateCode, drawing.value);\n\n        case 3:\n          _yield$call = _context.sent;\n          generated_code = _yield$call.generated_code;\n          return _context.abrupt(\"return\", generated_code);\n\n        case 6:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction openPartCreateDialog(_ref) {\n  var payload, partApi, _yield$all, userJob, userDrawing, initDetail, _yield$call2, permissions, wiki_page, initData, defaultValues;\n\n  return _regeneratorRuntime.wrap(function openPartCreateDialog$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          payload = _ref.payload;\n          _context2.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context2.prev = 3;\n          partApi = getPartApi(payload);\n          return _context2.delegateYield(all({\n            userJob: select(commonStore.selectUserValueJob),\n            userDrawing: select(commonStore.selectUserValueDrawing)\n          }), \"t0\", 6);\n\n        case 6:\n          _yield$all = _context2.t0;\n          userJob = _yield$all.userJob;\n          userDrawing = _yield$all.userDrawing;\n          initDetail = payload === 'item' ? partStore.itemDetail : partStore.assemblyDetail;\n          _context2.next = 12;\n          return call(partApi.getInitDataForCE, {\n            job_id_pk: userJob.value\n          });\n\n        case 12:\n          _yield$call2 = _context2.sent;\n          permissions = _yield$call2.permissions;\n          wiki_page = _yield$call2.wiki_page;\n          initData = _objectWithoutProperties(_yield$call2, [\"permissions\", \"wiki_page\"]);\n          defaultValues = getDefaultValues(initData.parameters, {\n            unit: 'UNIT'\n          }, initDetail);\n          defaultValues.drawing_id = userDrawing.value < 0 ? null : userDrawing;\n          defaultValues.job_id = userJob.value;\n\n          if (!defaultValues.drawing_id) {\n            _context2.next = 23;\n            break;\n          }\n\n          _context2.next = 22;\n          return call(fetchGenerateCode, payload, defaultValues.drawing_id);\n\n        case 22:\n          defaultValues.dpn = _context2.sent;\n\n        case 23:\n          _context2.next = 25;\n          return putResolve(partStore.actions.setInitData(initData));\n\n        case 25:\n          _context2.next = 27;\n          return put(partStore.actions.addPart({\n            detail: defaultValues,\n            wiki_page: wiki_page,\n            permissions: permissions[payload]\n          }));\n\n        case 27:\n          _context2.next = 33;\n          break;\n\n        case 29:\n          _context2.prev = 29;\n          _context2.t1 = _context2[\"catch\"](3);\n          _context2.next = 33;\n          return put(commonStore.actions.setError(_context2.t1));\n\n        case 33:\n          _context2.next = 35;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 35:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[3, 29]]);\n}\n\nfunction createPart(_ref2) {\n  var payload, entity, formData, partApi, _yield$call3, message, _yield$all2, userJob, userDrawing, generateCode;\n\n  return _regeneratorRuntime.wrap(function createPart$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context3.next = 3;\n          return put(partStore.actions.setPartLoading(true));\n\n        case 3:\n          _context3.prev = 3;\n          entity = payload.entity, formData = payload.formData;\n          partApi = getPartApi(entity);\n          _context3.next = 8;\n          return call(partApi.create, formData);\n\n        case 8:\n          _yield$call3 = _context3.sent;\n          message = _yield$call3.message;\n          return _context3.delegateYield(all({\n            userJob: select(commonStore.selectUserValueJob),\n            userDrawing: select(commonStore.selectUserValueDrawing)\n          }), \"t0\", 11);\n\n        case 11:\n          _yield$all2 = _context3.t0;\n          userJob = _yield$all2.userJob;\n          userDrawing = _yield$all2.userDrawing;\n          generateCode = '';\n\n          if (!(userDrawing.value >= 0)) {\n            _context3.next = 19;\n            break;\n          }\n\n          _context3.next = 18;\n          return call(fetchGenerateCode, entity, userDrawing);\n\n        case 18:\n          generateCode = _context3.sent;\n\n        case 19:\n          _context3.next = 21;\n          return putResolve(partStore.actions.resetCurrentPart({\n            userJob: userJob,\n            userDrawing: userDrawing,\n            generateCode: generateCode\n          }));\n\n        case 21:\n          _context3.next = 23;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(partStore.actions.setPartTab(0))]);\n\n        case 23:\n          _context3.next = 29;\n          break;\n\n        case 25:\n          _context3.prev = 25;\n          _context3.t1 = _context3[\"catch\"](3);\n          _context3.next = 29;\n          return put(commonStore.actions.setError(_context3.t1));\n\n        case 29:\n          _context3.next = 31;\n          return put(partStore.actions.setPartLoading(false));\n\n        case 31:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[3, 25]]);\n}\n\nvar getPartDpn = function getPartDpn(entity, dpn) {\n  // const type = entity === 'item' ? 'H' : 'G'\n  var regexItem = /H\\S+/g;\n  var regexAssembly = /G\\S+/g;\n  var regex = entity === 'item' ? regexItem : regexAssembly;\n  var match = dpn.match(regex);\n\n  if (_.isArray(match)) {\n    return match[0];\n  }\n\n  return '';\n};\n\nfunction fetchPartDetail(entity, id) {\n  var partApi, data, partDetail;\n  return _regeneratorRuntime.wrap(function fetchPartDetail$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          partApi = getPartApi(entity);\n          _context4.next = 3;\n          return call(partApi.getDetail, id);\n\n        case 3:\n          data = _context4.sent;\n          partDetail = data[entity];\n          partDetail.dpn = getPartDpn(entity, partDetail.dpn);\n          partDetail.drawing_id = partDetail.related_drawing;\n          partDetail.items = (partDetail.components || []).map(function (_ref3) {\n            var id = _ref3.id,\n                quantity = _ref3.quantity;\n            return {\n              item_id: id,\n              quantity: quantity\n            };\n          });\n\n          if (entity === 'item') {\n            partDetail.manufacturer_equiv = partDetail.manufacturer_equiv_object;\n            partDetail.material_equiv = partDetail.material_equiv_object;\n          }\n\n          return _context4.abrupt(\"return\", partDetail);\n\n        case 10:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nfunction openPartUpdateDialog(_ref4) {\n  var payload, id, entity, partApi, partDetail, _yield$call4, permissions, wiki_page, initData;\n\n  return _regeneratorRuntime.wrap(function openPartUpdateDialog$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          payload = _ref4.payload;\n          _context5.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context5.prev = 3;\n          id = payload.id, entity = payload.entity;\n          partApi = getPartApi(entity);\n          _context5.next = 8;\n          return call(fetchPartDetail, entity, id);\n\n        case 8:\n          partDetail = _context5.sent;\n          _context5.next = 11;\n          return call(partApi.getInitDataForCE, {\n            job_id_pk: partDetail.job_id\n          });\n\n        case 11:\n          _yield$call4 = _context5.sent;\n          permissions = _yield$call4.permissions;\n          wiki_page = _yield$call4.wiki_page;\n          initData = _objectWithoutProperties(_yield$call4, [\"permissions\", \"wiki_page\"]);\n          _context5.next = 17;\n          return putResolve(partStore.actions.setInitData(initData));\n\n        case 17:\n          _context5.next = 19;\n          return put(partStore.actions.addPart({\n            detail: partDetail,\n            wiki_page: wiki_page,\n            permissions: permissions[entity]\n          }));\n\n        case 19:\n          _context5.next = 25;\n          break;\n\n        case 21:\n          _context5.prev = 21;\n          _context5.t0 = _context5[\"catch\"](3);\n          _context5.next = 25;\n          return put(commonStore.actions.setError(_context5.t0));\n\n        case 25:\n          _context5.next = 27;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 27:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[3, 21]]);\n}\n\nfunction closePartDialog() {\n  var partList, _$last, detail, partEntity, partDetail;\n\n  return _regeneratorRuntime.wrap(function closePartDialog$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n          _context6.next = 3;\n          return putResolve(partStore.actions.removePart());\n\n        case 3:\n          return _context6.delegateYield(select(partStore.selectPartList), \"t0\", 4);\n\n        case 4:\n          partList = _context6.t0;\n          _$last = _.last(partList), detail = _$last.detail;\n          partEntity = detail.is_assembly ? 'assembly' : 'item';\n          _context6.next = 9;\n          return call(fetchPartDetail, partEntity, detail.id);\n\n        case 9:\n          partDetail = _context6.sent;\n          _context6.next = 12;\n          return put(partStore.actions.updateCurrentPart(partDetail));\n\n        case 12:\n          if (!isAssemblyByDpn(detail.dpn)) {\n            _context6.next = 15;\n            break;\n          }\n\n          _context6.next = 15;\n          return call(getDrawingItems, {\n            type: '',\n            payload: partDetail.related_drawing.value\n          });\n\n        case 15:\n          return _context6.abrupt(\"return\");\n\n        case 18:\n          _context6.prev = 18;\n          _context6.t1 = _context6[\"catch\"](0);\n          _context6.next = 22;\n          return put(commonStore.actions.setError(_context6.t1));\n\n        case 22:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[0, 18]]);\n}\n\nfunction openManuDialog(_ref5) {\n  var payload, _yield$call5, next_code, initData;\n\n  return _regeneratorRuntime.wrap(function openManuDialog$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref5.payload;\n          _context7.next = 3;\n          return put(partStore.actions.setPartLoading(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return put(partStore.actions.updateCurrentPart(payload));\n\n        case 6:\n          _context7.next = 8;\n          return call(manufacturerApi.getInitDataForCE);\n\n        case 8:\n          _yield$call5 = _context7.sent;\n          next_code = _yield$call5.next_code;\n          initData = _objectWithoutProperties(_yield$call5, [\"next_code\"]);\n          _context7.next = 13;\n          return all([putResolve(partStore.actions.setManuDetail({\n            manufacturer_id: next_code\n          })), putResolve(partStore.actions.setManuInitData(initData))]);\n\n        case 13:\n          _context7.next = 15;\n          return put(partStore.actions.setManuDialogOpen(true));\n\n        case 15:\n          _context7.next = 21;\n          break;\n\n        case 17:\n          _context7.prev = 17;\n          _context7.t0 = _context7[\"catch\"](3);\n          _context7.next = 21;\n          return put(commonStore.actions.setError(_context7.t0));\n\n        case 21:\n          _context7.next = 23;\n          return put(partStore.actions.setPartLoading(false));\n\n        case 23:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 17]]);\n}\n\nfunction createManu(_ref6) {\n  var payload, _yield$call6, message, id, _yield$call7, next_code, name;\n\n  return _regeneratorRuntime.wrap(function createManu$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref6.payload;\n          _context8.next = 3;\n          return put(partStore.actions.setManuDialogLoading(true));\n\n        case 3:\n          _context8.prev = 3;\n          _context8.next = 6;\n          return call(manufacturerApi.create, payload);\n\n        case 6:\n          _yield$call6 = _context8.sent;\n          message = _yield$call6.message;\n          id = _yield$call6.id;\n          _context8.next = 11;\n          return call(manufacturerApi.getInitDataForCE);\n\n        case 11:\n          _yield$call7 = _context8.sent;\n          next_code = _yield$call7.next_code;\n          name = payload.name;\n          _context8.next = 16;\n          return putResolve(partStore.actions.setManuDetail(_objectSpread(_objectSpread({}, partStore.initialState.manufacturer.detail), {}, {\n            manufacturer_id: next_code\n          })));\n\n        case 16:\n          _context8.next = 18;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(partStore.actions.addManufacturer({\n            manufacturer_id: id,\n            reference: '',\n            description: name\n          }))]);\n\n        case 18:\n          _context8.next = 24;\n          break;\n\n        case 20:\n          _context8.prev = 20;\n          _context8.t0 = _context8[\"catch\"](3);\n          _context8.next = 24;\n          return put(commonStore.actions.setError(_context8.t0));\n\n        case 24:\n          _context8.next = 26;\n          return put(partStore.actions.setManuDialogLoading(false));\n\n        case 26:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[3, 20]]);\n}\n\nfunction closeManuDialog() {\n  return _regeneratorRuntime.wrap(function closeManuDialog$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return putResolve(partStore.actions.setManuDialogOpen(false));\n\n        case 2:\n          _context9.next = 4;\n          return put(partStore.actions.setManuDetail({\n            manufacturer_id: null,\n            name: ''\n          }));\n\n        case 4:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nfunction getManuId(_ref7) {\n  var payload, _yield$call8, generated_code;\n\n  return _regeneratorRuntime.wrap(function getManuId$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          payload = _ref7.payload;\n          _context10.next = 3;\n          return put(partStore.actions.setManuDialogLoading(true));\n\n        case 3:\n          _context10.prev = 3;\n          _context10.next = 6;\n          return call(manufacturerApi.getNextCode, payload.manufacturer_id);\n\n        case 6:\n          _yield$call8 = _context10.sent;\n          generated_code = _yield$call8.generated_code;\n          _context10.next = 10;\n          return put(partStore.actions.setManuDetail(_objectSpread(_objectSpread({}, payload), {}, {\n            manufacturer_id: generated_code\n          })));\n\n        case 10:\n          _context10.next = 16;\n          break;\n\n        case 12:\n          _context10.prev = 12;\n          _context10.t0 = _context10[\"catch\"](3);\n          _context10.next = 16;\n          return put(commonStore.actions.setError(_context10.t0));\n\n        case 16:\n          _context10.next = 18;\n          return put(partStore.actions.setManuDialogLoading(false));\n\n        case 18:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10, null, [[3, 12]]);\n}\n\nfunction getItemCopy(_ref8) {\n  var payload, data, part;\n  return _regeneratorRuntime.wrap(function getItemCopy$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          payload = _ref8.payload;\n          _context11.next = 3;\n          return put(partStore.actions.setPartLoading(true));\n\n        case 3:\n          _context11.prev = 3;\n          _context11.next = 6;\n          return call(partRefApi.getDetail, payload.value);\n\n        case 6:\n          data = _context11.sent;\n          // get the allowed attributes\n          part = _.pick(data.part, ['descriptions', 'manufacturer_equiv', 'manufacturers', 'mass', 'material_equiv', 'unit', 'manufacturer_equiv_standards', 'material_equiv_standards']);\n          part.manufacturer_equiv = data.part.manufacturer_equiv_object;\n          part.material_equiv = data.part.material_equiv_object;\n          _context11.next = 12;\n          return put(partStore.actions.updateCurrentPart(part));\n\n        case 12:\n          _context11.next = 14;\n          return put(commonStore.actions.setSuccessMessage(data.message));\n\n        case 14:\n          _context11.next = 20;\n          break;\n\n        case 16:\n          _context11.prev = 16;\n          _context11.t0 = _context11[\"catch\"](3);\n          _context11.next = 20;\n          return put(commonStore.actions.setError(_context11.t0));\n\n        case 20:\n          _context11.next = 22;\n          return put(partStore.actions.setPartLoading(false));\n\n        case 22:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, _marked11, null, [[3, 16]]);\n}\n\nfunction getDrawingItems(_ref9) {\n  var payload, _yield$call9, items;\n\n  return _regeneratorRuntime.wrap(function getDrawingItems$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          payload = _ref9.payload;\n          _context12.next = 3;\n          return put(partStore.actions.setPartLoading(true));\n\n        case 3:\n          _context12.prev = 3;\n          _context12.next = 6;\n          return call(drawingApi.getItemList, payload);\n\n        case 6:\n          _yield$call9 = _context12.sent;\n          items = _yield$call9.items;\n          _context12.next = 10;\n          return put(partStore.actions.setDrawingItems(items));\n\n        case 10:\n          _context12.next = 16;\n          break;\n\n        case 12:\n          _context12.prev = 12;\n          _context12.t0 = _context12[\"catch\"](3);\n          _context12.next = 16;\n          return put(commonStore.actions.setError(_context12.t0));\n\n        case 16:\n          _context12.next = 18;\n          return put(partStore.actions.setPartLoading(false));\n\n        case 18:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, _marked12, null, [[3, 12]]);\n}\n\nfunction partSaga() {\n  return _regeneratorRuntime.wrap(function partSaga$(_context13) {\n    while (1) {\n      switch (_context13.prev = _context13.next) {\n        case 0:\n          _context13.next = 2;\n          return takeLatest(partStore.sagaOpenCreateDialog, openPartCreateDialog);\n\n        case 2:\n          _context13.next = 4;\n          return takeLatest(partStore.sagaCreate, createPart);\n\n        case 4:\n          _context13.next = 6;\n          return takeLatest(partStore.sagaOpenUpdateDialog, openPartUpdateDialog);\n\n        case 6:\n          _context13.next = 8;\n          return takeEvery(partStore.sagaCloseDialog, closePartDialog);\n\n        case 8:\n          _context13.next = 10;\n          return takeLatest(partStore.sagaOpenManuDialog, openManuDialog);\n\n        case 10:\n          _context13.next = 12;\n          return takeEvery(partStore.sagaCreateManu, createManu);\n\n        case 12:\n          _context13.next = 14;\n          return takeEvery(partStore.sagaCloseManuDialog, closeManuDialog);\n\n        case 14:\n          _context13.next = 16;\n          return takeLatest(partStore.sagaGetManuId, getManuId);\n\n        case 16:\n          _context13.next = 18;\n          return takeLatest(partStore.sagaGetItemCopy, getItemCopy);\n\n        case 18:\n          _context13.next = 20;\n          return takeLatest(partStore.sagaGetDrawingItems, getDrawingItems);\n\n        case 20:\n        case \"end\":\n          return _context13.stop();\n      }\n    }\n  }, _marked13);\n}\n\nexport default partSaga;","map":{"version":3,"sources":["D:/Fersher/TTS_Reactjs/malis-3-frontend/src/store/saga/part.saga.ts"],"names":["fetchGenerateCode","openPartCreateDialog","createPart","fetchPartDetail","openPartUpdateDialog","closePartDialog","openManuDialog","createManu","closeManuDialog","getManuId","getItemCopy","getDrawingItems","partSaga","takeLatest","call","put","putResolve","takeEvery","select","all","_","partStore","commonStore","getDefaultValues","isAssemblyByDpn","itemApi","assemblyApi","partRefApi","manufacturerApi","drawingApi","getPartApi","entity","drawing","partApi","getGenerateCode","value","generated_code","payload","actions","setLoadingPage","userJob","selectUserValueJob","userDrawing","selectUserValueDrawing","initDetail","itemDetail","assemblyDetail","getInitDataForCE","job_id_pk","permissions","wiki_page","initData","defaultValues","parameters","unit","drawing_id","job_id","dpn","setInitData","addPart","detail","setError","setPartLoading","formData","create","message","generateCode","resetCurrentPart","setSuccessMessage","setPartTab","getPartDpn","regexItem","regexAssembly","regex","match","isArray","id","getDetail","data","partDetail","related_drawing","items","components","map","quantity","item_id","manufacturer_equiv","manufacturer_equiv_object","material_equiv","material_equiv_object","removePart","selectPartList","partList","last","partEntity","is_assembly","updateCurrentPart","type","next_code","setManuDetail","manufacturer_id","setManuInitData","setManuDialogOpen","setManuDialogLoading","name","initialState","manufacturer","addManufacturer","reference","description","getNextCode","part","pick","getItemList","setDrawingItems","sagaOpenCreateDialog","sagaCreate","sagaOpenUpdateDialog","sagaCloseDialog","sagaOpenManuDialog","sagaCreateManu","sagaCloseManuDialog","sagaGetManuId","sagaGetItemCopy","sagaGetDrawingItems"],"mappings":"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","sourcesContent":["import { takeLatest, call, put, putResolve, takeEvery } from 'redux-saga/effects'\nimport { select, all } from 'typed-redux-saga'\nimport _ from 'lodash'\n\nimport { partStore, commonStore } from '@/store/reducers'\nimport { getDefaultValues } from '@/utils/getDefaultValues'\nimport { isAssemblyByDpn } from '@/utils/isAssembly'\n\nimport itemApi from '@/apis/item.api'\nimport assemblyApi from '@/apis/assembly.api'\nimport partRefApi from '@/apis/part.api'\nimport manufacturerApi from '@/apis/manufacturer.api'\nimport drawingApi from '@/apis/drawing.api'\n\nimport type { DataForDropdown } from '@/types/Common'\nimport type { PartEntity } from '@/types/Part'\n\nconst getPartApi = (entity: PartEntity) => (entity === 'item' ? itemApi : assemblyApi)\n\nfunction* fetchGenerateCode(entity: PartEntity, drawing: DataForDropdown) {\n  const partApi = getPartApi(entity)\n  const { generated_code } = yield call(partApi.getGenerateCode, drawing.value)\n  return generated_code\n}\n\nfunction* openPartCreateDialog({ payload }: ReturnType<typeof partStore.sagaOpenCreateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const partApi = getPartApi(payload)\n    const { userJob, userDrawing } = yield* all({\n      userJob: select(commonStore.selectUserValueJob),\n      userDrawing: select(commonStore.selectUserValueDrawing)\n    })\n    const initDetail = payload === 'item' ? partStore.itemDetail : partStore.assemblyDetail\n    const { permissions, wiki_page, ...initData } = yield call(partApi.getInitDataForCE, {\n      job_id_pk: userJob.value\n    })\n    const defaultValues = getDefaultValues(initData.parameters, { unit: 'UNIT' }, initDetail)\n    defaultValues.drawing_id = userDrawing.value < 0 ? null : userDrawing\n    defaultValues.job_id = userJob.value\n    if (defaultValues.drawing_id) {\n      defaultValues.dpn = yield call(fetchGenerateCode, payload, defaultValues.drawing_id)\n    }\n    yield putResolve(partStore.actions.setInitData(initData))\n    yield put(partStore.actions.addPart({ detail: defaultValues, wiki_page, permissions: permissions[payload] }))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* createPart({ payload }: ReturnType<typeof partStore.sagaCreate>) {\n  yield put(partStore.actions.setPartLoading(true))\n  try {\n    const { entity, formData } = payload\n    const partApi = getPartApi(entity)\n    const { message } = yield call(partApi.create, formData)\n    const { userJob, userDrawing } = yield* all({\n      userJob: select(commonStore.selectUserValueJob),\n      userDrawing: select(commonStore.selectUserValueDrawing)\n    })\n    let generateCode = ''\n    if (userDrawing.value >= 0) {\n      generateCode = yield call(fetchGenerateCode, entity, userDrawing)\n    }\n    yield putResolve(partStore.actions.resetCurrentPart({ userJob, userDrawing, generateCode }))\n    yield all([put(commonStore.actions.setSuccessMessage(message)), put(partStore.actions.setPartTab(0))])\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(partStore.actions.setPartLoading(false))\n}\n\nconst getPartDpn = (entity: PartEntity, dpn: string) => {\n  // const type = entity === 'item' ? 'H' : 'G'\n  const regexItem = /H\\S+/g\n  const regexAssembly = /G\\S+/g\n  const regex = entity === 'item' ? regexItem : regexAssembly\n  const match = dpn.match(regex)\n  if (_.isArray(match)) {\n    return match[0]\n  }\n  return ''\n}\n\nfunction* fetchPartDetail(entity: PartEntity, id: number) {\n  const partApi = getPartApi(entity)\n  const data = yield call(partApi.getDetail, id)\n  const partDetail = data[entity]\n  partDetail.dpn = getPartDpn(entity, partDetail.dpn)\n  partDetail.drawing_id = partDetail.related_drawing\n  partDetail.items = (partDetail.components || []).map(({ id, quantity }) => ({\n    item_id: id,\n    quantity\n  }))\n\n  if (entity === 'item') {\n    partDetail.manufacturer_equiv = partDetail.manufacturer_equiv_object\n    partDetail.material_equiv = partDetail.material_equiv_object\n  }\n  return partDetail\n}\n\nfunction* openPartUpdateDialog({ payload }: ReturnType<typeof partStore.sagaOpenUpdateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { id, entity } = payload\n    const partApi = getPartApi(entity)\n    const partDetail = yield call(fetchPartDetail, entity, id)\n    const { permissions, wiki_page, ...initData } = yield call(partApi.getInitDataForCE, {\n      job_id_pk: partDetail.job_id\n    })\n    yield putResolve(partStore.actions.setInitData(initData))\n    yield put(partStore.actions.addPart({ detail: partDetail, wiki_page, permissions: permissions[entity] }))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* closePartDialog() {\n  try {\n    yield putResolve(partStore.actions.removePart())\n    const partList = yield* select(partStore.selectPartList)\n    const { detail } = _.last(partList)\n    const partEntity = (detail as any).is_assembly ? 'assembly' : 'item'\n    const partDetail = yield call(fetchPartDetail, partEntity, detail.id)\n    yield put(partStore.actions.updateCurrentPart(partDetail))\n    if (isAssemblyByDpn(detail.dpn)) {\n      yield call(getDrawingItems, { type: '', payload: partDetail.related_drawing.value })\n    }\n    return\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n}\n\nfunction* openManuDialog({ payload }: ReturnType<typeof partStore.sagaOpenManuDialog>) {\n  yield put(partStore.actions.setPartLoading(true))\n  try {\n    yield put(partStore.actions.updateCurrentPart(payload))\n    const { next_code, ...initData } = yield call(manufacturerApi.getInitDataForCE)\n    yield all([\n      putResolve(partStore.actions.setManuDetail({ manufacturer_id: next_code })),\n      putResolve(partStore.actions.setManuInitData(initData))\n    ])\n    yield put(partStore.actions.setManuDialogOpen(true))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(partStore.actions.setPartLoading(false))\n}\n\nfunction* createManu({ payload }: ReturnType<typeof partStore.sagaCreateManu>) {\n  yield put(partStore.actions.setManuDialogLoading(true))\n  try {\n    const { message, id } = yield call(manufacturerApi.create, payload)\n    const { next_code } = yield call(manufacturerApi.getInitDataForCE)\n    const { name } = payload\n    yield putResolve(\n      partStore.actions.setManuDetail({ ...partStore.initialState.manufacturer.detail, manufacturer_id: next_code })\n    )\n    yield all([\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(partStore.actions.addManufacturer({ manufacturer_id: id, reference: '', description: name }))\n    ])\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(partStore.actions.setManuDialogLoading(false))\n}\n\nfunction* closeManuDialog() {\n  yield putResolve(partStore.actions.setManuDialogOpen(false))\n  yield put(partStore.actions.setManuDetail({ manufacturer_id: null, name: '' }))\n}\n\nfunction* getManuId({ payload }: ReturnType<typeof partStore.sagaGetManuId>) {\n  yield put(partStore.actions.setManuDialogLoading(true))\n  try {\n    const { generated_code } = yield call(manufacturerApi.getNextCode, payload.manufacturer_id)\n    yield put(partStore.actions.setManuDetail({ ...payload, manufacturer_id: generated_code }))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(partStore.actions.setManuDialogLoading(false))\n}\n\nfunction* getItemCopy({ payload }: ReturnType<typeof partStore.sagaGetItemCopy>) {\n  yield put(partStore.actions.setPartLoading(true))\n  try {\n    const data = yield call(partRefApi.getDetail, payload.value)\n    // get the allowed attributes\n    const part = _.pick(data.part, [\n      'descriptions',\n      'manufacturer_equiv',\n      'manufacturers',\n      'mass',\n      'material_equiv',\n      'unit',\n      'manufacturer_equiv_standards',\n      'material_equiv_standards'\n    ])\n    part.manufacturer_equiv = data.part.manufacturer_equiv_object\n    part.material_equiv = data.part.material_equiv_object\n    yield put(partStore.actions.updateCurrentPart(part))\n    yield put(commonStore.actions.setSuccessMessage(data.message))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n\n  yield put(partStore.actions.setPartLoading(false))\n}\n\nfunction* getDrawingItems({ payload }: ReturnType<typeof partStore.sagaGetDrawingItems>) {\n  yield put(partStore.actions.setPartLoading(true))\n  try {\n    const { items } = yield call(drawingApi.getItemList, payload)\n    yield put(partStore.actions.setDrawingItems(items))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(partStore.actions.setPartLoading(false))\n}\n\nfunction* partSaga() {\n  yield takeLatest(partStore.sagaOpenCreateDialog, openPartCreateDialog)\n  yield takeLatest(partStore.sagaCreate, createPart)\n  yield takeLatest(partStore.sagaOpenUpdateDialog, openPartUpdateDialog)\n  yield takeEvery(partStore.sagaCloseDialog, closePartDialog)\n  yield takeLatest(partStore.sagaOpenManuDialog, openManuDialog)\n  yield takeEvery(partStore.sagaCreateManu, createManu)\n  yield takeEvery(partStore.sagaCloseManuDialog, closeManuDialog)\n  yield takeLatest(partStore.sagaGetManuId, getManuId)\n  yield takeLatest(partStore.sagaGetItemCopy, getItemCopy)\n  yield takeLatest(partStore.sagaGetDrawingItems, getDrawingItems)\n}\n\nexport default partSaga\n"]},"metadata":{},"sourceType":"module"}