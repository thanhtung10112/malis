{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\Fersher\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\Tag\\\\TabGeneral.tsx\";\nimport { useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useSelector, useDispatch } from 'react-redux';\nimport useStyles from './styles';\nimport useDialogContext from './Context/useDialogContext';\nimport { Grid } from '@material-ui/core';\nimport { TableMultilingualDescription, AppAutocompleteAsync, FormControllerTextField, SectionTimezone, AppAutocomplete, FormControllerNumberField, useConfirm } from '@/components';\nimport { Unless } from 'react-if';\nimport _ from 'lodash';\nimport partApi from '@/apis/part.api';\nimport tagApi from '@/apis/tag.api';\nimport { commonStore } from '@/store/reducers';\nimport { StatusCode } from '@/utils/StatusCode';\n\nconst TabGeneral = () => {\n  var _tagForm$errors$job_i, _tagForm$errors$schem;\n\n  const classes = useStyles();\n  const {\n    confirm\n  } = useConfirm();\n  const {\n    0: defaultPartList,\n    1: setDefaultPartList\n  } = useState([]);\n  const tagForm = useFormContext();\n  const watchSchematic = tagForm.watch('schematic_id', null);\n  const watchPartId = tagForm.watch('part_id', null);\n  const watchId = tagForm.watch('id', null);\n  const {\n    detail,\n    initData,\n    onChangeLoading\n  } = useDialogContext();\n  const {\n    parameters\n  } = initData;\n  const dispatch = useDispatch();\n  const userJob = useSelector(commonStore.selectUserValueJob);\n\n  const isCreating = _.isNil(detail.id);\n\n  const handleChangeSchematicId = async (event, optionValue) => {\n    setDefaultPartList([]);\n    onChangeLoading(true);\n\n    try {\n      tagForm.clearErrors('schematic_id');\n      tagForm.setValue('schematic_id', optionValue);\n      const {\n        generated_code\n      } = await tagApi.getGenerateCode(optionValue.value);\n      tagForm.setValue('element_id', generated_code);\n    } catch (error) {\n      dispatch(commonStore.actions.setError(error));\n    }\n\n    onChangeLoading(false);\n  };\n\n  const handleFormatElementId = event => {\n    const {\n      value\n    } = event.target;\n\n    if (_.size(value) > 0) {\n      const formatValue = value.padStart(4, '0');\n      tagForm.setValue('element_id', formatValue);\n    }\n  };\n\n  const getAdditionalDataPart = () => {\n    const data = {};\n    data.limit_to_job = userJob.value;\n\n    if (!_.isNil(watchSchematic)) {\n      data.excluded_drawings = [watchSchematic.value];\n    }\n\n    return data;\n  };\n\n  const additionalDataPart = getAdditionalDataPart();\n\n  const displayConfirmRefDialog = async message => {\n    await confirm({\n      title: 'Warning',\n      description: message,\n      buttons: [{\n        label: 'Ok',\n        action: 'OK'\n      }]\n    });\n  };\n\n  const getPart = async selectedPart => {\n    onChangeLoading(true);\n\n    try {\n      var _formData$schematic_i;\n\n      const formData = tagForm.getValues();\n      const reqPayload = {\n        selected_part: selectedPart.value,\n        selected_drawing: (_formData$schematic_i = formData.schematic_id) === null || _formData$schematic_i === void 0 ? void 0 : _formData$schematic_i.value,\n        current_item: formData.id || null\n      };\n      const {\n        part,\n        message\n      } = await partApi.getReferencedPart(reqPayload);\n      const partFormat = {\n        description: '',\n        entity_id: part.dpn,\n        value: part.id\n      };\n      tagForm.setValue('part_id', partFormat);\n      tagForm.setValue('descriptions', part.descriptions);\n\n      if (selectedPart.value !== part.id) {\n        displayConfirmRefDialog(message);\n      } else {\n        dispatch(commonStore.actions.setSuccessMessage(message));\n      }\n    } catch (error) {\n      const {\n        status,\n        message\n      } = error;\n\n      if (status === StatusCode.BAD_REQUEST) {\n        displayConfirmRefDialog(message);\n      } else {\n        dispatch(commonStore.actions.setError(error));\n      }\n    }\n\n    onChangeLoading(false);\n  };\n\n  const handleSelectPart = (event, optionValue, reason) => {\n    if (reason === 'clear') {\n      tagForm.setValue('part_id', null);\n    } else {\n      getPart(optionValue);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(Grid, {\n    container: true,\n    spacing: 2,\n    children: [/*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 6,\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 2,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          style: {\n            marginTop: 8\n          },\n          children: /*#__PURE__*/_jsxDEV(AppAutocomplete, {\n            helperText: (_tagForm$errors$job_i = tagForm.errors.job_id) === null || _tagForm$errors$job_i === void 0 ? void 0 : _tagForm$errors$job_i.message,\n            error: Boolean(tagForm.errors.job_id),\n            value: userJob,\n            popupIcon: null,\n            disabled: true,\n            label: \"Job\",\n            required: true,\n            primaryKeyOption: \"value\",\n            options: [],\n            renderOption: option => option.description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(AppAutocompleteAsync, {\n            disabled: !isCreating,\n            helperText: (_tagForm$errors$schem = tagForm.errors.schematic_id) === null || _tagForm$errors$schem === void 0 ? void 0 : _tagForm$errors$schem.message,\n            error: Boolean(tagForm.errors.schematic_id),\n            value: watchSchematic,\n            compName: \"drawing_list\",\n            additionalData: {\n              limit_to_job: userJob.value\n            },\n            required: true,\n            label: \"Schematic #\",\n            onChange: handleChangeSchematicId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(FormControllerNumberField, {\n            allowLeadingZeros: true,\n            disabled: !isCreating,\n            fixedDecimalScale: false,\n            decimalScale: null,\n            thousandSeparator: \"\",\n            isNumericString: true,\n            control: tagForm.control,\n            label: \"Element #\",\n            required: true,\n            name: \"element_id\",\n            onBlur: handleFormatElementId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(FormControllerTextField, {\n            control: tagForm.control,\n            label: \"Tag #\",\n            name: \"tag\",\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(AppAutocompleteAsync, {\n            disabled: !watchSchematic,\n            disableClearable: false,\n            value: watchPartId,\n            compName: \"part_list\",\n            additionalData: additionalDataPart,\n            label: \"Part #\",\n            onChange: handleSelectPart,\n            defaultOptions: defaultPartList,\n            filterOptions: options => {\n              if (_.isNil(options)) {\n                return [];\n              }\n\n              if (isCreating) {\n                return options;\n              }\n\n              return _.filter(options, option => option.value !== watchId);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 6,\n      children: /*#__PURE__*/_jsxDEV(TableMultilingualDescription, {\n        languageList: parameters.PLLA,\n        editMode: !isCreating,\n        name: \"descriptions\",\n        tableHeight: 160,\n        control: tagForm.control,\n        copyable: true,\n        copyDialogProps: {\n          checkboxesToSelect: [{\n            label: 'Drawing',\n            value: 'drawing_list',\n            entity: 'drawings'\n          }, {\n            label: 'Item/Assembly',\n            value: 'part_list',\n            entity: 'parts'\n          }, {\n            label: 'Tag',\n            value: 'element_list',\n            entity: 'elements',\n            default: true\n          }]\n        },\n        disabled: Boolean(watchPartId)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 12,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: classes.tabGeneral__divider\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 6,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 2,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(FormControllerTextField, {\n            control: tagForm.control,\n            label: \"Fluid\",\n            name: \"fluid\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 12,\n          children: /*#__PURE__*/_jsxDEV(FormControllerTextField, {\n            control: tagForm.control,\n            label: \"Tech. data\",\n            name: \"tech_data\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Unless, {\n        condition: isCreating,\n        children: /*#__PURE__*/_jsxDEV(SectionTimezone, {\n          value: detail\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      item: true,\n      xs: 6,\n      children: /*#__PURE__*/_jsxDEV(TableMultilingualDescription, {\n        languageList: parameters.PLLA,\n        editMode: !isCreating,\n        name: \"functions\",\n        descriptionName: \"function\",\n        tableHeight: 160,\n        control: tagForm.control,\n        copyable: true,\n        copyDialogProps: {\n          compName: 'element_list',\n          entity: 'elements'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n};\n\nexport default TabGeneral;","map":{"version":3,"sources":["D:/Fersher/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/Tag/TabGeneral.tsx"],"names":["useState","useFormContext","useSelector","useDispatch","useStyles","useDialogContext","Grid","TableMultilingualDescription","AppAutocompleteAsync","FormControllerTextField","SectionTimezone","AppAutocomplete","FormControllerNumberField","useConfirm","Unless","_","partApi","tagApi","commonStore","StatusCode","TabGeneral","classes","confirm","defaultPartList","setDefaultPartList","tagForm","watchSchematic","watch","watchPartId","watchId","detail","initData","onChangeLoading","parameters","dispatch","userJob","selectUserValueJob","isCreating","isNil","id","handleChangeSchematicId","event","optionValue","clearErrors","setValue","generated_code","getGenerateCode","value","error","actions","setError","handleFormatElementId","target","size","formatValue","padStart","getAdditionalDataPart","data","limit_to_job","excluded_drawings","additionalDataPart","displayConfirmRefDialog","message","title","description","buttons","label","action","getPart","selectedPart","formData","getValues","reqPayload","selected_part","selected_drawing","schematic_id","current_item","part","getReferencedPart","partFormat","entity_id","dpn","descriptions","setSuccessMessage","status","BAD_REQUEST","handleSelectPart","reason","marginTop","errors","job_id","Boolean","option","control","options","filter","PLLA","checkboxesToSelect","entity","default","tabGeneral__divider","compName"],"mappings":"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","sourcesContent":["import { useState } from 'react'\nimport { useFormContext } from 'react-hook-form'\nimport { useSelector, useDispatch } from 'react-redux'\nimport useStyles from './styles'\nimport useDialogContext from './Context/useDialogContext'\n\nimport { Grid } from '@material-ui/core'\nimport {\n  TableMultilingualDescription,\n  AppAutocompleteAsync,\n  FormControllerTextField,\n  SectionTimezone,\n  AppAutocomplete,\n  FormControllerNumberField,\n  useConfirm\n} from '@/components'\nimport { Unless } from 'react-if'\n\nimport _ from 'lodash'\nimport partApi from '@/apis/part.api'\nimport tagApi from '@/apis/tag.api'\nimport { commonStore } from '@/store/reducers'\nimport { StatusCode } from '@/utils/StatusCode'\n\nimport type { AutocompleteChangeReason } from '@material-ui/lab'\nimport type { TagDetail } from '@/types/Tag'\nimport type { DataForDropdown } from '@/types/Common'\n\nconst TabGeneral = () => {\n  const classes = useStyles()\n  const { confirm } = useConfirm()\n\n  const [defaultPartList, setDefaultPartList] = useState([])\n\n  const tagForm = useFormContext<TagDetail>()\n  const watchSchematic = tagForm.watch('schematic_id', null) as DataForDropdown\n  const watchPartId = tagForm.watch('part_id', null) as DataForDropdown\n  const watchId = tagForm.watch('id', null)\n\n  const { detail, initData, onChangeLoading } = useDialogContext()\n  const { parameters } = initData\n\n  const dispatch = useDispatch()\n  const userJob = useSelector(commonStore.selectUserValueJob)\n\n  const isCreating = _.isNil(detail.id)\n\n  const handleChangeSchematicId = async (event, optionValue: DataForDropdown) => {\n    setDefaultPartList([])\n    onChangeLoading(true)\n    try {\n      tagForm.clearErrors('schematic_id')\n      tagForm.setValue('schematic_id', optionValue)\n      const { generated_code } = await tagApi.getGenerateCode(optionValue.value)\n      tagForm.setValue('element_id', generated_code)\n    } catch (error) {\n      dispatch(commonStore.actions.setError(error))\n    }\n    onChangeLoading(false)\n  }\n\n  const handleFormatElementId = (event) => {\n    const { value } = event.target\n    if (_.size(value) > 0) {\n      const formatValue = value.padStart(4, '0')\n      tagForm.setValue('element_id', formatValue)\n    }\n  }\n\n  const getAdditionalDataPart = () => {\n    const data = {} as any\n    data.limit_to_job = userJob.value\n    if (!_.isNil(watchSchematic)) {\n      data.excluded_drawings = [(watchSchematic as DataForDropdown).value]\n    }\n    return data\n  }\n\n  const additionalDataPart = getAdditionalDataPart()\n\n  const displayConfirmRefDialog = async (message: string) => {\n    await confirm({\n      title: 'Warning',\n      description: message,\n      buttons: [{ label: 'Ok', action: 'OK' }]\n    })\n  }\n\n  const getPart = async (selectedPart: DataForDropdown) => {\n    onChangeLoading(true)\n    try {\n      const formData = tagForm.getValues()\n      const reqPayload = {\n        selected_part: selectedPart.value,\n        selected_drawing: (formData.schematic_id as DataForDropdown)?.value,\n        current_item: formData.id || null\n      }\n      const { part, message } = await partApi.getReferencedPart(reqPayload)\n      const partFormat: DataForDropdown = {\n        description: '',\n        entity_id: part.dpn,\n        value: part.id\n      }\n      tagForm.setValue('part_id', partFormat)\n      tagForm.setValue('descriptions', part.descriptions)\n      if (selectedPart.value !== part.id) {\n        displayConfirmRefDialog(message)\n      } else {\n        dispatch(commonStore.actions.setSuccessMessage(message))\n      }\n    } catch (error) {\n      const { status, message } = error\n      if (status === StatusCode.BAD_REQUEST) {\n        displayConfirmRefDialog(message)\n      } else {\n        dispatch(commonStore.actions.setError(error))\n      }\n    }\n    onChangeLoading(false)\n  }\n\n  const handleSelectPart = (event, optionValue: DataForDropdown, reason: AutocompleteChangeReason) => {\n    if (reason === 'clear') {\n      tagForm.setValue('part_id', null)\n    } else {\n      getPart(optionValue)\n    }\n  }\n\n  return (\n    <Grid container spacing={2}>\n      <Grid item xs={6}>\n        <Grid container spacing={2}>\n          <Grid item xs={12} style={{ marginTop: 8 }}>\n            <AppAutocomplete\n              helperText={tagForm.errors.job_id?.message}\n              error={Boolean(tagForm.errors.job_id)}\n              value={userJob}\n              popupIcon={null}\n              disabled\n              label=\"Job\"\n              required\n              primaryKeyOption=\"value\"\n              options={[]}\n              renderOption={(option) => option.description}\n            />\n          </Grid>\n          <Grid item xs={12}>\n            <AppAutocompleteAsync\n              disabled={!isCreating}\n              helperText={tagForm.errors.schematic_id?.message}\n              error={Boolean(tagForm.errors.schematic_id)}\n              value={watchSchematic}\n              compName=\"drawing_list\"\n              additionalData={{ limit_to_job: userJob.value }}\n              required\n              label=\"Schematic #\"\n              onChange={handleChangeSchematicId}\n            />\n          </Grid>\n\n          <Grid item xs={12}>\n            <FormControllerNumberField\n              allowLeadingZeros\n              disabled={!isCreating}\n              fixedDecimalScale={false}\n              decimalScale={null}\n              thousandSeparator=\"\"\n              isNumericString\n              control={tagForm.control}\n              label=\"Element #\"\n              required\n              name=\"element_id\"\n              onBlur={handleFormatElementId}\n            />\n          </Grid>\n\n          <Grid item xs={12}>\n            <FormControllerTextField control={tagForm.control} label=\"Tag #\" name=\"tag\" required />\n          </Grid>\n\n          <Grid item xs={12}>\n            <AppAutocompleteAsync\n              disabled={!watchSchematic}\n              disableClearable={false}\n              value={watchPartId}\n              compName=\"part_list\"\n              additionalData={additionalDataPart}\n              label=\"Part #\"\n              onChange={handleSelectPart}\n              defaultOptions={defaultPartList}\n              filterOptions={(options) => {\n                if (_.isNil(options)) {\n                  return []\n                }\n                if (isCreating) {\n                  return options\n                }\n                return _.filter(options, (option) => option.value !== watchId)\n              }}\n            />\n          </Grid>\n        </Grid>\n      </Grid>\n\n      <Grid item xs={6}>\n        <TableMultilingualDescription\n          languageList={parameters.PLLA}\n          editMode={!isCreating}\n          name=\"descriptions\"\n          tableHeight={160}\n          control={tagForm.control}\n          copyable\n          copyDialogProps={{\n            checkboxesToSelect: [\n              {\n                label: 'Drawing',\n                value: 'drawing_list',\n                entity: 'drawings'\n              },\n              {\n                label: 'Item/Assembly',\n                value: 'part_list',\n                entity: 'parts'\n              },\n              {\n                label: 'Tag',\n                value: 'element_list',\n                entity: 'elements',\n                default: true\n              }\n            ]\n          }}\n          disabled={Boolean(watchPartId)}\n        />\n      </Grid>\n\n      <Grid item xs={12}>\n        <div className={classes.tabGeneral__divider} />\n      </Grid>\n\n      <Grid item xs={6}>\n        <Grid container spacing={2}>\n          <Grid item xs={12}>\n            <FormControllerTextField control={tagForm.control} label=\"Fluid\" name=\"fluid\" />\n          </Grid>\n          <Grid item xs={12}>\n            <FormControllerTextField control={tagForm.control} label=\"Tech. data\" name=\"tech_data\" />\n          </Grid>\n        </Grid>\n\n        <Unless condition={isCreating}>\n          <SectionTimezone value={detail} />\n        </Unless>\n      </Grid>\n\n      <Grid item xs={6}>\n        <TableMultilingualDescription\n          languageList={parameters.PLLA}\n          editMode={!isCreating}\n          name=\"functions\"\n          descriptionName=\"function\"\n          tableHeight={160}\n          control={tagForm.control}\n          copyable\n          copyDialogProps={{\n            compName: 'element_list',\n            entity: 'elements'\n          }}\n        />\n      </Grid>\n    </Grid>\n  )\n}\n\nexport default TabGeneral\n"]},"metadata":{},"sourceType":"module"}