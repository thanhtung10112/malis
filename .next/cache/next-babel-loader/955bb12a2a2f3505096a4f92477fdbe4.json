{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchTagDataForList),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(fetchTagList),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(getTagList),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(removeTag),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(changeUserJob),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(changeUserDrawing),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(tagSaga);\n\nimport { takeEvery, put, call, putResolve } from 'redux-saga/effects';\nimport { select, all } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { tagStore, commonStore, advancedFilterActions, summaryReportActions } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport tagApi from '@/apis/tag.api';\n\nfunction fetchTagDataForList() {\n  var userJob, data;\n  return _regeneratorRuntime.wrap(function fetchTagDataForList$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          return _context.delegateYield(select(commonStore.selectUserValueJob), \"t0\", 1);\n\n        case 1:\n          userJob = _context.t0;\n          _context.next = 4;\n          return call(tagApi.getInitDataForList, {\n            job_id_pk: userJob.value\n          });\n\n        case 4:\n          data = _context.sent;\n\n          if (_.isNull(data.selected_job)) {\n            data.selected_job = {};\n          }\n\n          _context.next = 8;\n          return put(commonStore.actions.setUserValueJob(data.selected_job));\n\n        case 8:\n          _context.next = 10;\n          return put(tagStore.actions.setInitDataForList(data));\n\n        case 10:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction fetchTagList() {\n  var _yield$all, tableState, searchQuery, filterData, userJob, userDrawing, page, per_page, data;\n\n  return _regeneratorRuntime.wrap(function fetchTagList$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          return _context2.delegateYield(all({\n            tableState: select(commonStore.selectTableState),\n            searchQuery: select(commonStore.selectSearchQuery),\n            filterData: select(advancedFilterActions.selectFilterData),\n            userJob: select(commonStore.selectUserValueJob),\n            userDrawing: select(commonStore.selectUserValueDrawing)\n          }), \"t0\", 1);\n\n        case 1:\n          _yield$all = _context2.t0;\n          tableState = _yield$all.tableState;\n          searchQuery = _yield$all.searchQuery;\n          filterData = _yield$all.filterData;\n          userJob = _yield$all.userJob;\n          userDrawing = _yield$all.userDrawing;\n\n          if (userJob.value) {\n            _context2.next = 9;\n            break;\n          }\n\n          return _context2.abrupt(\"return\");\n\n        case 9:\n          page = tableState.page, per_page = tableState.per_page;\n          _context2.next = 12;\n          return call(tagApi.getList, _objectSpread(_objectSpread({\n            per_page: per_page,\n            page: page,\n            s: searchQuery,\n            job_id: userJob.value\n          }, filterData), {}, {\n            drawing_id: userDrawing.value\n          }));\n\n        case 12:\n          data = _context2.sent;\n          _context2.next = 15;\n          return put(commonStore.actions.setTableState({\n            total_items: data.total_items\n          }));\n\n        case 15:\n          _context2.next = 17;\n          return put(tagStore.actions.setDataList(data.elements));\n\n        case 17:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction getTagList() {\n  var permissions;\n  return _regeneratorRuntime.wrap(function getTagList$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context3.prev = 2;\n          _context3.next = 5;\n          return call(fetchTagDataForList);\n\n        case 5:\n          return _context3.delegateYield(select(tagStore.selectPermissions), \"t0\", 6);\n\n        case 6:\n          permissions = _context3.t0;\n\n          if (!(permissions === null || permissions === void 0 ? void 0 : permissions.view)) {\n            _context3.next = 10;\n            break;\n          }\n\n          _context3.next = 10;\n          return call(fetchTagList);\n\n        case 10:\n          _context3.next = 16;\n          break;\n\n        case 12:\n          _context3.prev = 12;\n          _context3.t1 = _context3[\"catch\"](2);\n          _context3.next = 16;\n          return errorSaga.handleError(_context3.t1);\n\n        case 16:\n          _context3.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[2, 12]]);\n}\n\nfunction removeTag(_ref) {\n  var payload, data;\n  return _regeneratorRuntime.wrap(function removeTag$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          payload = _ref.payload;\n          _context4.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context4.prev = 3;\n          _context4.next = 6;\n          return call(tagApi.executeOperation, 'delete', payload);\n\n        case 6:\n          data = _context4.sent;\n\n          if (!(data.failed_count > 0)) {\n            _context4.next = 14;\n            break;\n          }\n\n          _context4.next = 10;\n          return put(summaryReportActions.setReportData(data));\n\n        case 10:\n          _context4.next = 12;\n          return put(summaryReportActions.setOpen(true));\n\n        case 12:\n          _context4.next = 16;\n          break;\n\n        case 14:\n          _context4.next = 16;\n          return put(commonStore.actions.setSuccessMessage(data.message));\n\n        case 16:\n          _context4.next = 18;\n          return call(fetchTagList);\n\n        case 18:\n          _context4.next = 24;\n          break;\n\n        case 20:\n          _context4.prev = 20;\n          _context4.t0 = _context4[\"catch\"](3);\n          _context4.next = 24;\n          return errorSaga.handleError(_context4.t0);\n\n        case 24:\n          _context4.next = 26;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 26:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4, null, [[3, 20]]);\n}\n\nfunction changeUserJob(_ref2) {\n  var payload;\n  return _regeneratorRuntime.wrap(function changeUserJob$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context5.next = 3;\n          return put(commonStore.actions.setUserValueJob(payload));\n\n        case 3:\n          _context5.next = 5;\n          return call(getTagList);\n\n        case 5:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}\n\nfunction changeUserDrawing(_ref3) {\n  var payload;\n  return _regeneratorRuntime.wrap(function changeUserDrawing$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context6.next = 3;\n          return putResolve(commonStore.actions.setUserValueDrawing(payload));\n\n        case 3:\n          _context6.next = 5;\n          return call(getTagList);\n\n        case 5:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6);\n}\n\nfunction tagSaga() {\n  return _regeneratorRuntime.wrap(function tagSaga$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return takeEvery(tagStore.sagaGetList, getTagList);\n\n        case 2:\n          _context7.next = 4;\n          return takeEvery(tagStore.sagaRemove, removeTag);\n\n        case 4:\n          _context7.next = 6;\n          return takeEvery(tagStore.sagaChangeUserJob, changeUserJob);\n\n        case 6:\n          _context7.next = 8;\n          return takeEvery(tagStore.sagaChangeUserDrawing, changeUserDrawing);\n\n        case 8:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7);\n}\n\nexport default tagSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/tag.saga.ts"],"names":["fetchTagDataForList","fetchTagList","getTagList","removeTag","changeUserJob","changeUserDrawing","tagSaga","takeEvery","put","call","putResolve","select","all","_","tagStore","commonStore","advancedFilterActions","summaryReportActions","errorSaga","tagApi","selectUserValueJob","userJob","getInitDataForList","job_id_pk","value","data","isNull","selected_job","actions","setUserValueJob","setInitDataForList","tableState","selectTableState","searchQuery","selectSearchQuery","filterData","selectFilterData","userDrawing","selectUserValueDrawing","page","per_page","getList","s","job_id","drawing_id","setTableState","total_items","setDataList","elements","setLoadingPage","selectPermissions","permissions","view","handleError","payload","executeOperation","failed_count","setReportData","setOpen","setSuccessMessage","message","setUserValueDrawing","sagaGetList","sagaRemove","sagaChangeUserJob","sagaChangeUserDrawing"],"mappings":"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","sourcesContent":["import { takeEvery, put, call, putResolve } from 'redux-saga/effects'\nimport { select, all } from 'typed-redux-saga'\nimport _ from 'lodash'\n\nimport { tagStore, commonStore, advancedFilterActions, summaryReportActions } from '@/store/reducers'\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport tagApi from '@/apis/tag.api'\n\nfunction* fetchTagDataForList() {\n  const userJob = yield* select(commonStore.selectUserValueJob)\n  const data = yield call(tagApi.getInitDataForList, {\n    job_id_pk: userJob.value\n  })\n  if (_.isNull(data.selected_job)) {\n    data.selected_job = {}\n  }\n  yield put(commonStore.actions.setUserValueJob(data.selected_job))\n  yield put(tagStore.actions.setInitDataForList(data))\n}\n\nfunction* fetchTagList() {\n  const { tableState, searchQuery, filterData, userJob, userDrawing } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData),\n    userJob: select(commonStore.selectUserValueJob),\n    userDrawing: select(commonStore.selectUserValueDrawing)\n  })\n  if (!userJob.value) {\n    return\n  }\n  const { page, per_page } = tableState\n  const data = yield call(tagApi.getList, {\n    per_page,\n    page,\n    s: searchQuery,\n    job_id: userJob.value,\n    ...filterData,\n    drawing_id: userDrawing.value\n  })\n  yield put(commonStore.actions.setTableState({ total_items: data.total_items }))\n  yield put(tagStore.actions.setDataList(data.elements))\n}\n\nfunction* getTagList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchTagDataForList)\n    const permissions = yield* select(tagStore.selectPermissions)\n    if (permissions?.view) {\n      yield call(fetchTagList)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* removeTag({ payload }) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const data = yield call(tagApi.executeOperation, 'delete', payload)\n    if (data.failed_count > 0) {\n      yield put(summaryReportActions.setReportData(data))\n      yield put(summaryReportActions.setOpen(true))\n    } else {\n      yield put(commonStore.actions.setSuccessMessage(data.message))\n    }\n    yield call(fetchTagList)\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* changeUserJob({ payload }: ReturnType<typeof tagStore.sagaChangeUserJob>) {\n  yield put(commonStore.actions.setUserValueJob(payload))\n  yield call(getTagList)\n}\n\nfunction* changeUserDrawing({ payload }: ReturnType<typeof tagStore.sagaChangeUserDrawing>) {\n  yield putResolve(commonStore.actions.setUserValueDrawing(payload))\n  yield call(getTagList)\n}\n\nfunction* tagSaga() {\n  yield takeEvery(tagStore.sagaGetList, getTagList)\n  yield takeEvery(tagStore.sagaRemove, removeTag)\n  yield takeEvery(tagStore.sagaChangeUserJob, changeUserJob)\n  yield takeEvery(tagStore.sagaChangeUserDrawing, changeUserDrawing)\n}\n\nexport default tagSaga\n"]},"metadata":{},"sourceType":"module"}