{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\Specification\\\\CreateEdit.tsx\";\nimport { useEffect, useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'react-i18next';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { DialogMain, FormControllerTabs, AppTabHistoryLog, TableExtendedProperties, BtnHelp } from '@/components';\nimport TabGeneral from './TabGeneral';\nimport { commonStore, specificationStore } from '@/store/reducers';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport _ from 'lodash';\nimport getValidationSchema from './validationSchema';\n\nconst DialogSpecificationCE = () => {\n  const {\n    t\n  } = useTranslation('specification');\n  const dispatch = useDispatch();\n  const dialogState = useSelector(specificationStore.selectDialogState);\n  const specificationDetail = useSelector(specificationStore.selectDetail);\n  const userDrawing = useSelector(commonStore.selectUserValueDrawing);\n  const {\n    parameters,\n    wiki_page\n  } = useSelector(specificationStore.selectInitDataForCE);\n  const permissions = useSelector(specificationStore.selectPermissions);\n\n  const isCreating = _.isNil(specificationDetail.id);\n\n  const vaidationSchema = useMemo(() => getValidationSchema(t), []);\n  const specificationForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(vaidationSchema)\n  });\n  useEffect(() => {\n    specificationForm.reset(specificationDetail);\n  }, [specificationDetail]);\n  useEffect(() => {\n    if (userDrawing.value === -1) {\n      dispatch(specificationStore.actions.setDetail({\n        drawing_id: null\n      }));\n    } else {\n      dispatch(specificationStore.actions.setDetail({\n        drawing_id: userDrawing\n      }));\n    }\n  }, [userDrawing]);\n  const handleSubmitForm = specificationForm.handleSubmit(formData => {\n    formData.drawing_id = formData.drawing_id.value;\n\n    const data = _.pick(formData, ['job_id', 'drawing_id', 'spec_id', 'descriptions']);\n\n    if (isCreating) {\n      dispatch(specificationStore.sagaCreate(data));\n    } else {\n      const specEdit = _.pick(formData, 'descriptions');\n\n      dispatch(specificationStore.sagaUpdate({\n        id: formData.id,\n        formData: specEdit\n      }));\n    }\n  });\n\n  const handleClose = () => {\n    dispatch(specificationStore.sagaCloseDialog());\n  };\n\n  const handleChangeTab = (event, nextTab) => {\n    dispatch(specificationStore.actions.setDialogStateTab(nextTab));\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(specificationStore.actions.setHistoryLogs(data));\n  };\n\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: /*#__PURE__*/_jsxDEV(TabGeneral, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 12\n    }, this),\n    errorKey: ['drawing_id', 'spec_id', 'job_id']\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: /*#__PURE__*/_jsxDEV(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: specificationDetail.id,\n      mode: \"horizonatal\",\n      tableHeight: 315,\n      descriptionRows: 20,\n      entity: \"specification\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this),\n    disabled: isCreating\n  };\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: /*#__PURE__*/_jsxDEV(TableExtendedProperties, {\n      control: specificationForm.control,\n      name: \"additional_attributes\",\n      editMode: !isCreating,\n      propertiesList: parameters.SSAT,\n      tableHeight: 335,\n      parameterName: \"SSAT\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this)\n  };\n  const tabs = [generalTab, extendedPropertyTab, historyTab];\n  return /*#__PURE__*/_jsxDEV(DialogMain, {\n    fullWidth: true,\n    maxWidth: \"md\",\n    open: dialogState.open,\n    loading: dialogState.loading,\n    title: /*#__PURE__*/_jsxDEV(BtnHelp, {\n      title: isCreating ? t('form.title.create_specification') : t('form.title.update_specification'),\n      href: wiki_page\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }, this),\n    onOk: handleSubmitForm,\n    onClose: handleClose,\n    okText: isCreating ? t('common:button.create') : t('common:button.update'),\n    okButtonProps: {\n      disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating\n    },\n    children: /*#__PURE__*/_jsxDEV(FormControllerTabs, {\n      form: specificationForm,\n      value: dialogState.tab,\n      onChange: handleChangeTab,\n      tabs: tabs\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 116,\n    columnNumber: 5\n  }, this);\n};\n\nexport default DialogSpecificationCE;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/Specification/CreateEdit.tsx"],"names":["useEffect","useMemo","useForm","useTranslation","useDispatch","useSelector","DialogMain","FormControllerTabs","AppTabHistoryLog","TableExtendedProperties","BtnHelp","TabGeneral","commonStore","specificationStore","yupResolver","_","getValidationSchema","DialogSpecificationCE","t","dispatch","dialogState","selectDialogState","specificationDetail","selectDetail","userDrawing","selectUserValueDrawing","parameters","wiki_page","selectInitDataForCE","permissions","selectPermissions","isCreating","isNil","id","vaidationSchema","specificationForm","shouldUnregister","resolver","reset","value","actions","setDetail","drawing_id","handleSubmitForm","handleSubmit","formData","data","pick","sagaCreate","specEdit","sagaUpdate","handleClose","sagaCloseDialog","handleChangeTab","event","nextTab","setDialogStateTab","handleChangeHistoryLogs","setHistoryLogs","generalTab","label","panel","errorKey","historyTab","open","historyLogs","disabled","extendedPropertyTab","control","SSAT","tabs","loading","edit","tab"],"mappings":"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","sourcesContent":["import { useEffect, useMemo } from 'react'\nimport { useForm } from 'react-hook-form'\nimport { useTranslation } from 'react-i18next'\nimport { useDispatch, useSelector } from 'react-redux'\n\nimport { DialogMain, FormControllerTabs, AppTabHistoryLog, TableExtendedProperties, BtnHelp } from '@/components'\nimport TabGeneral from './TabGeneral'\n\nimport { commonStore, specificationStore } from '@/store/reducers'\nimport { yupResolver } from '@hookform/resolvers/yup'\nimport _ from 'lodash'\nimport getValidationSchema from './validationSchema'\n\nimport type { SpecificationDetail } from '@/types/Specification'\nimport type { DataForDropdown, HistoryLog } from '@/types/Common'\n\nconst DialogSpecificationCE = () => {\n  const { t } = useTranslation('specification')\n\n  const dispatch = useDispatch()\n\n  const dialogState = useSelector(specificationStore.selectDialogState)\n  const specificationDetail = useSelector(specificationStore.selectDetail)\n  const userDrawing = useSelector(commonStore.selectUserValueDrawing)\n  const { parameters, wiki_page } = useSelector(specificationStore.selectInitDataForCE)\n  const permissions = useSelector(specificationStore.selectPermissions)\n\n  const isCreating = _.isNil(specificationDetail.id)\n\n  const vaidationSchema = useMemo(() => getValidationSchema(t), [])\n  const specificationForm = useForm<SpecificationDetail>({\n    shouldUnregister: false,\n    resolver: yupResolver(vaidationSchema)\n  })\n\n  useEffect(() => {\n    specificationForm.reset(specificationDetail)\n  }, [specificationDetail])\n\n  useEffect(() => {\n    if (userDrawing.value === -1) {\n      dispatch(specificationStore.actions.setDetail({ drawing_id: null }))\n    } else {\n      dispatch(specificationStore.actions.setDetail({ drawing_id: userDrawing }))\n    }\n  }, [userDrawing])\n\n  const handleSubmitForm = specificationForm.handleSubmit((formData) => {\n    formData.drawing_id = (formData.drawing_id as DataForDropdown).value\n    const data = _.pick(formData, ['job_id', 'drawing_id', 'spec_id', 'descriptions'])\n    if (isCreating) {\n      dispatch(specificationStore.sagaCreate(data))\n    } else {\n      const specEdit = _.pick(formData, 'descriptions')\n      dispatch(\n        specificationStore.sagaUpdate({\n          id: formData.id,\n          formData: specEdit as SpecificationDetail\n        })\n      )\n    }\n  })\n\n  const handleClose = () => {\n    dispatch(specificationStore.sagaCloseDialog())\n  }\n\n  const handleChangeTab = (event, nextTab: number) => {\n    dispatch(specificationStore.actions.setDialogStateTab(nextTab))\n  }\n\n  const handleChangeHistoryLogs = (data: HistoryLog[]) => {\n    dispatch(specificationStore.actions.setHistoryLogs(data))\n  }\n\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: <TabGeneral />,\n    errorKey: ['drawing_id', 'spec_id', 'job_id']\n  }\n\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: (\n      <AppTabHistoryLog\n        isOpenDialog={dialogState.open}\n        data={dialogState.historyLogs}\n        onChange={handleChangeHistoryLogs}\n        entityId={specificationDetail.id}\n        mode=\"horizonatal\"\n        tableHeight={315}\n        descriptionRows={20}\n        entity=\"specification\"\n      />\n    ),\n    disabled: isCreating\n  }\n\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: (\n      <TableExtendedProperties\n        control={specificationForm.control}\n        name=\"additional_attributes\"\n        editMode={!isCreating}\n        propertiesList={parameters.SSAT}\n        tableHeight={335}\n        parameterName=\"SSAT\"\n      />\n    )\n  }\n\n  const tabs = [generalTab, extendedPropertyTab, historyTab]\n\n  return (\n    <DialogMain\n      fullWidth\n      maxWidth=\"md\"\n      open={dialogState.open}\n      loading={dialogState.loading}\n      title={\n        <BtnHelp\n          title={isCreating ? t('form.title.create_specification') : t('form.title.update_specification')}\n          href={wiki_page}\n        />\n      }\n      onOk={handleSubmitForm}\n      onClose={handleClose}\n      okText={isCreating ? t('common:button.create') : t('common:button.update')}\n      okButtonProps={{\n        disabled: dialogState.loading || (!permissions?.edit && !isCreating)\n      }}\n    >\n      <FormControllerTabs form={specificationForm} value={dialogState.tab} onChange={handleChangeTab} tabs={tabs} />\n    </DialogMain>\n  )\n}\n\nexport default DialogSpecificationCE\n"]},"metadata":{},"sourceType":"module"}