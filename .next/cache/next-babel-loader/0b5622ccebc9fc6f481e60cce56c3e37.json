{"ast":null,"code":"import React from 'react';\nimport _ from 'lodash';\n\nfunction useSSE(operationId) {\n  const domain = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:5000/';\n  const sseConnection = React.useRef(null);\n  const [dataSSE, setDataSSE] = React.useState({\n    message: 'Initializing...',\n    status: null,\n    operation_result: null\n  });\n\n  const backgroundJobListener = event => {\n    const response = JSON.parse(event.data);\n    setDataSSE(response);\n\n    if (response.status === 'SUCCESS' || response.status === 'ERROR') {\n      sseConnection.current.removeEventListener(operationId, backgroundJobListener);\n      sseConnection.current.close();\n      sseConnection.current = null;\n    }\n  };\n\n  React.useEffect(() => {\n    if (_.isEmpty(operationId)) {\n      return null;\n    }\n\n    if (!sseConnection.current) {\n      sseConnection.current = new EventSource(`${domain}background_stream`);\n    }\n\n    sseConnection.current.addEventListener(operationId, backgroundJobListener);\n  }, [operationId]);\n  return {\n    dataSSE,\n    setDataSSE\n  };\n}\n\nexport default useSSE;","map":null,"metadata":{},"sourceType":"module"}