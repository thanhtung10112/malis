{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForList),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForCE),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(fetchList),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchDetail),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(getLocationList),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(openLocationCreateDialog),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(createLocation),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(updateLocation),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(openLocationUpdateDialog),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(getLocationNextCode),\n    _marked11 = /*#__PURE__*/_regeneratorRuntime.mark(closeLocationDialog),\n    _marked12 = /*#__PURE__*/_regeneratorRuntime.mark(locationSaga);\n\nimport { takeEvery, put, putResolve } from 'redux-saga/effects';\nimport { call, select, all, takeLatest } from 'typed-redux-saga';\nimport immer from 'immer';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport { advancedFilterActions, commonStore, locationStore } from '@/store/reducers';\nimport locationApi from '@/apis/location.api';\nexport function fetchInitDataForList() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchInitDataForList$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return call(locationApi.getInitDataForList);\n\n        case 2:\n          data = _context.sent;\n          _context.next = 5;\n          return put(locationStore.actions.setInitDataForList(data));\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\nexport function fetchInitDataForCE() {\n  var _yield$call, permissions, data;\n\n  return _regeneratorRuntime.wrap(function fetchInitDataForCE$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return call(locationApi.getInitDataForCE);\n\n        case 2:\n          _yield$call = _context2.sent;\n          permissions = _yield$call.permissions;\n          data = _objectWithoutProperties(_yield$call, [\"permissions\"]);\n          _context2.next = 7;\n          return put(locationStore.actions.setInitDataForCE(data));\n\n        case 7:\n          _context2.next = 9;\n          return put(locationStore.actions.setDetail({\n            location_id: data.next_code\n          }));\n\n        case 9:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\nexport function fetchList() {\n  var _yield$all, tableState, searchQuery, filterData, page, per_page, data;\n\n  return _regeneratorRuntime.wrap(function fetchList$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          return _context3.delegateYield(all({\n            tableState: select(commonStore.selectTableState),\n            searchQuery: select(commonStore.selectSearchQuery),\n            filterData: select(advancedFilterActions.selectFilterData)\n          }), \"t0\", 1);\n\n        case 1:\n          _yield$all = _context3.t0;\n          tableState = _yield$all.tableState;\n          searchQuery = _yield$all.searchQuery;\n          filterData = _yield$all.filterData;\n          page = tableState.page, per_page = tableState.per_page;\n          _context3.next = 8;\n          return call(locationApi.getList, _objectSpread({\n            per_page: per_page,\n            page: page,\n            s: searchQuery\n          }, filterData));\n\n        case 8:\n          data = _context3.sent;\n          _context3.next = 11;\n          return put(commonStore.actions.setTableState({\n            total_items: data.total_items\n          }));\n\n        case 11:\n          _context3.next = 13;\n          return put(locationStore.actions.setDataList(data.locations));\n\n        case 13:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\nexport function fetchDetail(id) {\n  var _yield$call2, location;\n\n  return _regeneratorRuntime.wrap(function fetchDetail$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(locationApi.getDetail, id);\n\n        case 2:\n          _yield$call2 = _context4.sent;\n          location = _yield$call2.location;\n          _context4.next = 6;\n          return put(locationStore.actions.setDetail(location));\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\nexport function getLocationList() {\n  var permissions;\n  return _regeneratorRuntime.wrap(function getLocationList$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context5.prev = 2;\n          _context5.next = 5;\n          return call(fetchInitDataForList);\n\n        case 5:\n          return _context5.delegateYield(select(locationStore.selectPermissions), \"t0\", 6);\n\n        case 6:\n          permissions = _context5.t0;\n\n          if (!(permissions === null || permissions === void 0 ? void 0 : permissions.view)) {\n            _context5.next = 10;\n            break;\n          }\n\n          _context5.next = 10;\n          return call(fetchList);\n\n        case 10:\n          _context5.next = 16;\n          break;\n\n        case 12:\n          _context5.prev = 12;\n          _context5.t1 = _context5[\"catch\"](2);\n          _context5.next = 16;\n          return errorSaga.handleError(_context5.t1);\n\n        case 16:\n          _context5.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[2, 12]]);\n}\nexport function openLocationCreateDialog() {\n  return _regeneratorRuntime.wrap(function openLocationCreateDialog$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchInitDataForCE);\n\n        case 5:\n          _context6.next = 7;\n          return put(locationStore.actions.setDialogStateOpen(true));\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return errorSaga.handleError(_context6.t0);\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\nexport function createLocation(_ref) {\n  var payload, _yield$call3, message, _yield$call4, generated_code;\n\n  return _regeneratorRuntime.wrap(function createLocation$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref.payload;\n          _context7.next = 3;\n          return put(locationStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return call(locationApi.create, payload);\n\n        case 6:\n          _yield$call3 = _context7.sent;\n          message = _yield$call3.message;\n          _context7.next = 10;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 10:\n          _context7.next = 12;\n          return call(locationApi.getNextCode, null);\n\n        case 12:\n          _yield$call4 = _context7.sent;\n          generated_code = _yield$call4.generated_code;\n          _context7.next = 16;\n          return put(locationStore.actions.setDetail(_objectSpread(_objectSpread({}, locationStore.initialState.detail), {}, {\n            location_id: generated_code\n          })));\n\n        case 16:\n          _context7.next = 18;\n          return put(locationStore.actions.setNextCode(generated_code));\n\n        case 18:\n          _context7.next = 24;\n          break;\n\n        case 20:\n          _context7.prev = 20;\n          _context7.t0 = _context7[\"catch\"](3);\n          _context7.next = 24;\n          return errorSaga.handleError(_context7.t0);\n\n        case 24:\n          _context7.next = 26;\n          return put(locationStore.actions.setDialogStateLoading(false));\n\n        case 26:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 20]]);\n}\nexport function updateLocation(_ref2) {\n  var payload, permissions, id, location, _yield$call5, message;\n\n  return _regeneratorRuntime.wrap(function updateLocation$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context8.next = 3;\n          return put(locationStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context8.prev = 3;\n          return _context8.delegateYield(select(locationStore.selectPermissions), \"t0\", 5);\n\n        case 5:\n          permissions = _context8.t0;\n          id = payload.id; // delete location_type if user not have change_type permission\n\n          location = immer(payload.location, function (draft) {\n            if (!permissions.change_type) {\n              delete draft.location_type;\n            }\n          });\n          _context8.next = 10;\n          return call(locationApi.update, id, location);\n\n        case 10:\n          _yield$call5 = _context8.sent;\n          message = _yield$call5.message;\n          _context8.next = 14;\n          return call(closeLocationDialog);\n\n        case 14:\n          _context8.next = 16;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 16:\n          _context8.next = 22;\n          break;\n\n        case 18:\n          _context8.prev = 18;\n          _context8.t1 = _context8[\"catch\"](3);\n          _context8.next = 22;\n          return errorSaga.handleError(_context8.t1);\n\n        case 22:\n          _context8.next = 24;\n          return put(locationStore.actions.setDialogStateLoading(false));\n\n        case 24:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[3, 18]]);\n}\nexport function openLocationUpdateDialog(_ref3) {\n  var payload;\n  return _regeneratorRuntime.wrap(function openLocationUpdateDialog$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context9.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context9.prev = 3;\n          _context9.next = 6;\n          return put(locationStore.actions.setDialogStateEditMode(true));\n\n        case 6:\n          _context9.next = 8;\n          return call(fetchInitDataForCE);\n\n        case 8:\n          _context9.next = 10;\n          return call(fetchDetail, payload);\n\n        case 10:\n          _context9.next = 12;\n          return put(locationStore.actions.setDialogStateOpen(true));\n\n        case 12:\n          _context9.next = 18;\n          break;\n\n        case 14:\n          _context9.prev = 14;\n          _context9.t0 = _context9[\"catch\"](3);\n          _context9.next = 18;\n          return errorSaga.handleError(_context9.t0);\n\n        case 18:\n          _context9.next = 20;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 20:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9, null, [[3, 14]]);\n}\nexport function getLocationNextCode(_ref4) {\n  var payload, _yield$call6, generated_code, newDetail;\n\n  return _regeneratorRuntime.wrap(function getLocationNextCode$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          payload = _ref4.payload;\n          _context10.next = 3;\n          return put(locationStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context10.prev = 3;\n          _context10.next = 6;\n          return call(locationApi.getNextCode, payload.location_id);\n\n        case 6:\n          _yield$call6 = _context10.sent;\n          generated_code = _yield$call6.generated_code;\n          newDetail = immer(payload, function (draft) {\n            draft.location_id = generated_code;\n          });\n          _context10.next = 11;\n          return put(locationStore.actions.setDetail(newDetail));\n\n        case 11:\n          _context10.next = 17;\n          break;\n\n        case 13:\n          _context10.prev = 13;\n          _context10.t0 = _context10[\"catch\"](3);\n          _context10.next = 17;\n          return errorSaga.handleError(_context10.t0);\n\n        case 17:\n          _context10.next = 19;\n          return put(locationStore.actions.setDialogStateLoading(false));\n\n        case 19:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10, null, [[3, 13]]);\n}\nexport function closeLocationDialog() {\n  return _regeneratorRuntime.wrap(function closeLocationDialog$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          _context11.prev = 0;\n          _context11.next = 3;\n          return putResolve(locationStore.actions.setDialogStateOpen(false));\n\n        case 3:\n          _context11.next = 5;\n          return call(getLocationList);\n\n        case 5:\n          _context11.next = 7;\n          return all([put(locationStore.actions.setDialogStateEditMode(false)), put(locationStore.actions.resetDetail())]);\n\n        case 7:\n          _context11.next = 13;\n          break;\n\n        case 9:\n          _context11.prev = 9;\n          _context11.t0 = _context11[\"catch\"](0);\n          _context11.next = 13;\n          return errorSaga.handleError(_context11.t0);\n\n        case 13:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, _marked11, null, [[0, 9]]);\n}\n\nfunction locationSaga() {\n  return _regeneratorRuntime.wrap(function locationSaga$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return takeEvery(locationStore.sagaGetList, getLocationList);\n\n        case 2:\n          _context12.next = 4;\n          return takeEvery(locationStore.sagaOpenCreateDialog, openLocationCreateDialog);\n\n        case 4:\n          _context12.next = 6;\n          return takeEvery(locationStore.sagaCreate, createLocation);\n\n        case 6:\n          _context12.next = 8;\n          return takeEvery(locationStore.sagaOpenUpdateDialog, openLocationUpdateDialog);\n\n        case 8:\n          _context12.next = 10;\n          return takeEvery(locationStore.sagaUpdate, updateLocation);\n\n        case 10:\n          _context12.next = 12;\n          return takeEvery(locationStore.sagaCloseDialog, closeLocationDialog);\n\n        case 12:\n          _context12.next = 14;\n          return takeLatest(locationStore.sagaGetNextCode, getLocationNextCode);\n\n        case 14:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, _marked12);\n}\n\nexport default locationSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/location.saga.ts"],"names":["fetchInitDataForList","fetchInitDataForCE","fetchList","fetchDetail","getLocationList","openLocationCreateDialog","createLocation","updateLocation","openLocationUpdateDialog","getLocationNextCode","closeLocationDialog","locationSaga","takeEvery","put","putResolve","call","select","all","takeLatest","immer","errorSaga","advancedFilterActions","commonStore","locationStore","locationApi","getInitDataForList","data","actions","setInitDataForList","getInitDataForCE","permissions","setInitDataForCE","setDetail","location_id","next_code","tableState","selectTableState","searchQuery","selectSearchQuery","filterData","selectFilterData","page","per_page","getList","s","setTableState","total_items","setDataList","locations","id","getDetail","location","setLoadingPage","selectPermissions","view","handleError","setDialogStateOpen","payload","setDialogStateLoading","create","message","setSuccessMessage","getNextCode","generated_code","initialState","detail","setNextCode","draft","change_type","location_type","update","setDialogStateEditMode","newDetail","resetDetail","sagaGetList","sagaOpenCreateDialog","sagaCreate","sagaOpenUpdateDialog","sagaUpdate","sagaCloseDialog","sagaGetNextCode"],"mappings":"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","sourcesContent":["import { takeEvery, put, putResolve } from 'redux-saga/effects'\n\nimport { call, select, all, takeLatest } from 'typed-redux-saga'\nimport immer from 'immer'\n\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport { advancedFilterActions, commonStore, locationStore } from '@/store/reducers'\n\nimport locationApi from '@/apis/location.api'\n\nexport function* fetchInitDataForList() {\n  const data = yield call(locationApi.getInitDataForList)\n  yield put(locationStore.actions.setInitDataForList(data))\n}\n\nexport function* fetchInitDataForCE() {\n  const { permissions, ...data } = yield call(locationApi.getInitDataForCE)\n  yield put(locationStore.actions.setInitDataForCE(data))\n  yield put(locationStore.actions.setDetail({ location_id: data.next_code }))\n}\n\nexport function* fetchList() {\n  const { tableState, searchQuery, filterData } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData)\n  })\n  const { page, per_page } = tableState\n  const data = yield call(locationApi.getList, {\n    per_page,\n    page,\n    s: searchQuery,\n    ...filterData\n  })\n  yield put(commonStore.actions.setTableState({ total_items: data.total_items }))\n  yield put(locationStore.actions.setDataList(data.locations))\n}\n\nexport function* fetchDetail(id: number) {\n  const { location } = yield call(locationApi.getDetail, id)\n  yield put(locationStore.actions.setDetail(location))\n}\n\nexport function* getLocationList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForList)\n    const permissions = yield* select(locationStore.selectPermissions)\n    if (permissions?.view) {\n      yield call(fetchList)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* openLocationCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForCE)\n    yield put(locationStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* createLocation({ payload }: ReturnType<typeof locationStore.sagaCreate>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const { message } = yield call(locationApi.create, payload)\n    yield put(commonStore.actions.setSuccessMessage(message))\n    const { generated_code } = yield call(locationApi.getNextCode, null)\n    yield put(\n      locationStore.actions.setDetail({\n        ...locationStore.initialState.detail,\n        location_id: generated_code\n      })\n    )\n    yield put(locationStore.actions.setNextCode(generated_code))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* updateLocation({ payload }: ReturnType<typeof locationStore.sagaUpdate>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const permissions = yield* select(locationStore.selectPermissions)\n    const { id } = payload\n    // delete location_type if user not have change_type permission\n    const location = immer(payload.location, (draft) => {\n      if (!permissions.change_type) {\n        delete draft.location_type\n      }\n    })\n    const { message } = yield call(locationApi.update, id, location)\n    yield call(closeLocationDialog)\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* openLocationUpdateDialog({ payload }: ReturnType<typeof locationStore.sagaOpenUpdateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield put(locationStore.actions.setDialogStateEditMode(true))\n    yield call(fetchInitDataForCE)\n    yield call(fetchDetail, payload)\n    yield put(locationStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* getLocationNextCode({ payload }: ReturnType<typeof locationStore.sagaGetNextCode>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const { generated_code } = yield call(locationApi.getNextCode, payload.location_id)\n    const newDetail = immer(payload, (draft) => {\n      draft.location_id = generated_code\n    })\n    yield put(locationStore.actions.setDetail(newDetail))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* closeLocationDialog() {\n  try {\n    yield putResolve(locationStore.actions.setDialogStateOpen(false))\n    yield call(getLocationList)\n    yield all([put(locationStore.actions.setDialogStateEditMode(false)), put(locationStore.actions.resetDetail())])\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n}\n\nfunction* locationSaga() {\n  yield takeEvery(locationStore.sagaGetList, getLocationList)\n  yield takeEvery(locationStore.sagaOpenCreateDialog, openLocationCreateDialog)\n  yield takeEvery(locationStore.sagaCreate, createLocation)\n  yield takeEvery(locationStore.sagaOpenUpdateDialog, openLocationUpdateDialog)\n  yield takeEvery(locationStore.sagaUpdate, updateLocation)\n  yield takeEvery(locationStore.sagaCloseDialog, closeLocationDialog)\n  yield takeLatest(locationStore.sagaGetNextCode, getLocationNextCode)\n}\n\nexport default locationSaga\n"]},"metadata":{},"sourceType":"module"}