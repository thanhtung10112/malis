{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { takeEvery, putResolve } from 'redux-saga/effects';\nimport { call, put, all, select } from 'typed-redux-saga';\nimport { jobStore, commonStore, advancedFilterActions } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport jobApi from '@/apis/job.api';\nimport _ from 'lodash';\nimport { getDefaultValue } from '@/utils/getDefaultValues';\n\nfunction* fetchInitDataForList() {\n  const data = yield call(jobApi.getInitDataForList);\n  const selectedJobCategory = yield* select(jobStore.selectSelectedJobCategory);\n\n  if (_.isNull(selectedJobCategory.id)) {\n    const defaultJobCategory = getDefaultValue(data.job_categories, false);\n    yield put(jobStore.actions.setSelectedCategory(defaultJobCategory));\n  }\n\n  yield put(jobStore.actions.setInitDataForList(data));\n}\n\nfunction* fetchInitDataForCE() {\n  const data = yield call(jobApi.getInitDataForCE);\n  data.job_template = _.pick(data.job_template, ['language', 'equipment_type', 'erection_site', 'people_responsible', 'squad_leader', 'drawings_responsible', 'job_users']);\n  const jobStandard = data.parameters.PLNO.map(item => _.pick(item, ['description', 'id', 'parameter_id']));\n  yield put(jobStore.actions.setDetail(_objectSpread(_objectSpread({}, data.job_template), {}, {\n    job_standard: jobStandard\n  })));\n  yield put(jobStore.actions.setInitDataForCE(data));\n}\n\nfunction* fetchList() {\n  const {\n    tableState,\n    searchQuery,\n    filterData,\n    selectedCategory\n  } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData),\n    selectedCategory: select(jobStore.selectSelectedJobCategory)\n  });\n  const {\n    page,\n    per_page\n  } = tableState;\n  const data = yield call(jobApi.getList, _objectSpread({\n    per_page,\n    page,\n    s: searchQuery,\n    job_category_id: selectedCategory === null || selectedCategory === void 0 ? void 0 : selectedCategory.id\n  }, filterData));\n  yield put(commonStore.actions.setTableState({\n    total_items: data.total_items\n  }));\n  yield put(jobStore.actions.setDataList(data.jobs));\n}\n\nfunction* getJobList() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchInitDataForList);\n    const permissions = yield* select(jobStore.selectPermissions);\n\n    if (permissions === null || permissions === void 0 ? void 0 : permissions.view) {\n      yield call(fetchList);\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* openJobCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchInitDataForCE);\n    yield put(jobStore.actions.setDialogStateOpen(true));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* getUserGroupMapping({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const data = yield call(jobApi.getUserGroupMapping, payload);\n    yield put(jobStore.actions.setTransferUserAvailableList(data.available_users));\n    yield put(jobStore.actions.setOpenTransferList(true));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* createJob({\n  payload\n}) {\n  yield put(jobStore.actions.setDialogStateLoading(true));\n\n  try {\n    const {\n      message\n    } = yield call(jobApi.create, payload);\n    const {\n      job_template\n    } = yield* select(jobStore.selectInitDataForCE);\n    yield put(jobStore.actions.setDetail(job_template));\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(jobStore.actions.setDialogStateLoading(false));\n}\n\nfunction* closeJobDialog() {\n  try {\n    yield putResolve(jobStore.actions.setDialogStateOpen(false));\n    yield call(getJobList);\n    yield put(jobStore.actions.resetDetail());\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n}\n\nfunction* openJobUpdateDialog({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchInitDataForCE);\n    const {\n      job\n    } = yield call(jobApi.getDetail, payload);\n    job.job_currencies = job.job_currencies.map(currency => _objectSpread({\n      id: currency.currency_id\n    }, currency));\n    yield putResolve(jobStore.actions.setDetail(job));\n    yield put(jobStore.actions.setDialogState({\n      open: true,\n      editMode: true\n    }));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* updateJob({\n  payload\n}) {\n  yield put(jobStore.actions.setDialogStateLoading(true));\n\n  try {\n    const {\n      id,\n      formData\n    } = payload;\n    const {\n      message\n    } = yield call(jobApi.update, id, formData);\n    yield put(commonStore.actions.setSuccessMessage(message));\n    yield call(closeJobDialog);\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(jobStore.actions.setDialogStateLoading(false));\n}\n\nfunction* jobSaga() {\n  yield takeEvery(jobStore.sagaGetList, getJobList);\n  yield takeEvery(jobStore.sagaOpenCreateDialog, openJobCreateDialog);\n  yield takeEvery(jobStore.sagaGetUserGroupMapping, getUserGroupMapping);\n  yield takeEvery(jobStore.sagaCreate, createJob);\n  yield takeEvery(jobStore.sagaCloseDialog, closeJobDialog);\n  yield takeEvery(jobStore.sagaOpenUpdateDialog, openJobUpdateDialog);\n  yield takeEvery(jobStore.sagaUpdate, updateJob);\n}\n\nexport default jobSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/job.saga.ts"],"names":["takeEvery","putResolve","call","put","all","select","jobStore","commonStore","advancedFilterActions","errorSaga","jobApi","_","getDefaultValue","fetchInitDataForList","data","getInitDataForList","selectedJobCategory","selectSelectedJobCategory","isNull","id","defaultJobCategory","job_categories","actions","setSelectedCategory","setInitDataForList","fetchInitDataForCE","getInitDataForCE","job_template","pick","jobStandard","parameters","PLNO","map","item","setDetail","job_standard","setInitDataForCE","fetchList","tableState","searchQuery","filterData","selectedCategory","selectTableState","selectSearchQuery","selectFilterData","page","per_page","getList","s","job_category_id","setTableState","total_items","setDataList","jobs","getJobList","setLoadingPage","permissions","selectPermissions","view","error","handleError","openJobCreateDialog","setDialogStateOpen","getUserGroupMapping","payload","setTransferUserAvailableList","available_users","setOpenTransferList","createJob","setDialogStateLoading","message","create","selectInitDataForCE","setSuccessMessage","closeJobDialog","resetDetail","openJobUpdateDialog","job","getDetail","job_currencies","currency","currency_id","setDialogState","open","editMode","updateJob","formData","update","jobSaga","sagaGetList","sagaOpenCreateDialog","sagaGetUserGroupMapping","sagaCreate","sagaCloseDialog","sagaOpenUpdateDialog","sagaUpdate"],"mappings":"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","sourcesContent":["import { takeEvery, putResolve } from 'redux-saga/effects'\n\nimport { call, put, all, select } from 'typed-redux-saga'\n\nimport { jobStore, commonStore, advancedFilterActions } from '@/store/reducers'\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport jobApi from '@/apis/job.api'\nimport _ from 'lodash'\nimport { getDefaultValue } from '@/utils/getDefaultValues'\n\nfunction* fetchInitDataForList() {\n  const data = yield call(jobApi.getInitDataForList)\n  const selectedJobCategory = yield* select(jobStore.selectSelectedJobCategory)\n  if (_.isNull(selectedJobCategory.id)) {\n    const defaultJobCategory = getDefaultValue(data.job_categories, false)\n    yield put(jobStore.actions.setSelectedCategory(defaultJobCategory))\n  }\n  yield put(jobStore.actions.setInitDataForList(data))\n}\n\nfunction* fetchInitDataForCE() {\n  const data = yield call(jobApi.getInitDataForCE)\n  data.job_template = _.pick(data.job_template, [\n    'language',\n    'equipment_type',\n    'erection_site',\n    'people_responsible',\n    'squad_leader',\n    'drawings_responsible',\n    'job_users'\n  ])\n  const jobStandard = data.parameters.PLNO.map((item) => _.pick(item, ['description', 'id', 'parameter_id']))\n\n  yield put(\n    jobStore.actions.setDetail({\n      ...data.job_template,\n      job_standard: jobStandard\n    })\n  )\n  yield put(jobStore.actions.setInitDataForCE(data))\n}\n\nfunction* fetchList() {\n  const { tableState, searchQuery, filterData, selectedCategory } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData),\n    selectedCategory: select(jobStore.selectSelectedJobCategory)\n  })\n  const { page, per_page } = tableState\n  const data = yield call(jobApi.getList, {\n    per_page,\n    page,\n    s: searchQuery,\n    job_category_id: selectedCategory?.id,\n    ...filterData\n  })\n  yield put(commonStore.actions.setTableState({ total_items: data.total_items }))\n  yield put(jobStore.actions.setDataList(data.jobs))\n}\n\nfunction* getJobList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForList)\n    const permissions = yield* select(jobStore.selectPermissions)\n    if (permissions?.view) {\n      yield call(fetchList)\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* openJobCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchInitDataForCE)\n    yield put(jobStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* getUserGroupMapping({ payload }: ReturnType<typeof jobStore.sagaGetUserGroupMapping>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    const data = yield call(jobApi.getUserGroupMapping, payload)\n    yield put(jobStore.actions.setTransferUserAvailableList(data.available_users))\n    yield put(jobStore.actions.setOpenTransferList(true))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* createJob({ payload }: ReturnType<typeof jobStore.sagaCreate>) {\n  yield put(jobStore.actions.setDialogStateLoading(true))\n  try {\n    const { message } = yield call(jobApi.create, payload)\n    const { job_template } = yield* select(jobStore.selectInitDataForCE)\n    yield put(jobStore.actions.setDetail(job_template))\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(jobStore.actions.setDialogStateLoading(false))\n}\n\nfunction* closeJobDialog() {\n  try {\n    yield putResolve(jobStore.actions.setDialogStateOpen(false))\n    yield call(getJobList)\n    yield put(jobStore.actions.resetDetail())\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n}\n\nfunction* openJobUpdateDialog({ payload }: ReturnType<typeof jobStore.sagaOpenUpdateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForCE)\n    const { job } = yield call(jobApi.getDetail, payload)\n    job.job_currencies = job.job_currencies.map((currency) => ({\n      id: currency.currency_id,\n      ...currency\n    }))\n    yield putResolve(jobStore.actions.setDetail(job))\n    yield put(jobStore.actions.setDialogState({ open: true, editMode: true }))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* updateJob({ payload }: ReturnType<typeof jobStore.sagaUpdate>) {\n  yield put(jobStore.actions.setDialogStateLoading(true))\n\n  try {\n    const { id, formData } = payload\n    const { message } = yield call(jobApi.update, id, formData)\n    yield put(commonStore.actions.setSuccessMessage(message))\n    yield call(closeJobDialog)\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(jobStore.actions.setDialogStateLoading(false))\n}\n\nfunction* jobSaga() {\n  yield takeEvery(jobStore.sagaGetList, getJobList)\n  yield takeEvery(jobStore.sagaOpenCreateDialog, openJobCreateDialog)\n  yield takeEvery(jobStore.sagaGetUserGroupMapping, getUserGroupMapping)\n  yield takeEvery(jobStore.sagaCreate, createJob)\n  yield takeEvery(jobStore.sagaCloseDialog, closeJobDialog)\n  yield takeEvery(jobStore.sagaOpenUpdateDialog, openJobUpdateDialog)\n  yield takeEvery(jobStore.sagaUpdate, updateJob)\n}\n\nexport default jobSaga\n"]},"metadata":{},"sourceType":"module"}