{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\Fersher\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\User\\\\CreateEdit.tsx\";\nimport { useState, useEffect, useMemo } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport { useForm } from 'react-hook-form';\nimport { userStore } from '@/store/reducers';\nimport { AppTabHistoryLog, DialogMain, FormControllerTabs, BtnHelp } from '@/components';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport _ from 'lodash';\nimport getValidationSchema from './validationSchema';\nimport TabGeneral from './TabGeneral';\nimport TabJobs from './TabJobs';\nimport TabGroups from './TabGroups';\n\nconst UserCreateEditDialog = () => {\n  const {\n    t\n  } = useTranslation('user');\n  const {\n    0: tab,\n    1: setTab\n  } = useState(0);\n  const dispatch = useDispatch();\n  const dialogState = useSelector(userStore.selectDialogState);\n  const userDetail = useSelector(userStore.selectDetail);\n  const permissions = useSelector(userStore.selectPermissions);\n  const {\n    wiki_page\n  } = useSelector(userStore.selectInitDataForCE);\n\n  const isCreating = _.isNil(userDetail.id);\n\n  const title = isCreating ? t('form.title.create_user') : t('form.title.update_user');\n  const validationSchema = useMemo(() => getValidationSchema(t, !isCreating), [isCreating]);\n  const userForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  });\n  useEffect(() => {\n    userForm.reset(userDetail);\n    setTab(0);\n  }, [userDetail]);\n\n  const onChangeTab = (_, newValue) => {\n    setTab(newValue);\n  };\n\n  const onHandleSubmit = userForm.handleSubmit(formData => {\n    formData.groups = formData.groups.map(item => +item);\n    formData.job_access = formData.job_access.map(({\n      job_id,\n      note\n    }) => ({\n      job_id,\n      note: note || '' // server returns null but they do not allow send null to body req\n\n    }));\n\n    if (!formData.valid_from) {\n      formData.valid_from = null;\n    }\n\n    if (!formData.valid_until) {\n      formData.valid_until = null;\n    }\n\n    const payload = _.pick(formData, ['default_language', 'email', 'first_name', 'groups', 'job_access', 'last_name', 'puco', 'time_zone', 'user_abb', 'user_id', 'password', 'confirm_password', 'login_page', 'valid_from', 'valid_until']);\n\n    if (isCreating) {\n      dispatch(userStore.sagaCreate(payload));\n    } else {\n      dispatch(userStore.sagaUpdate({\n        id: formData.id,\n        formData: _.omit(payload, ['password', 'confirm_password', 'login_page'])\n      }));\n    }\n  });\n\n  const onCloseDialog = () => {\n    dispatch(userStore.sagaCloseDialog());\n    userForm.clearErrors();\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(userStore.actions.setHistoryLogs(data));\n  };\n\n  const generalTab = {\n    label: 'General',\n    panel: /*#__PURE__*/_jsxDEV(TabGeneral, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 12\n    }, this),\n    errorKey: ['user_id', 'user_abb', 'first_name', 'last_name', 'password', 'confirm_password', 'email', 'time_zone', 'puco', 'default_language']\n  };\n  const groupsTab = {\n    label: t('form.tab.groups'),\n    panel: /*#__PURE__*/_jsxDEV(TabGroups, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 12\n    }, this)\n  };\n  const jobsTab = {\n    label: t('form.tab.jobs'),\n    panel: /*#__PURE__*/_jsxDEV(TabJobs, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 12\n    }, this)\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: /*#__PURE__*/_jsxDEV(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: userDetail.id,\n      tableHeight: 255,\n      entity: \"user\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }, this),\n    disabled: isCreating\n  };\n  const tabs = [generalTab, groupsTab, jobsTab, historyTab];\n  return /*#__PURE__*/_jsxDEV(DialogMain, {\n    open: dialogState.open,\n    title: /*#__PURE__*/_jsxDEV(BtnHelp, {\n      title: title,\n      href: wiki_page\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 14\n    }, this),\n    height: 560,\n    onOk: onHandleSubmit,\n    onClose: onCloseDialog,\n    okText: isCreating ? t('common:button.create') : t('common:button.update'),\n    okButtonProps: {\n      disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating\n    },\n    loading: dialogState.loading,\n    children: /*#__PURE__*/_jsxDEV(FormControllerTabs, {\n      value: tab,\n      onChange: onChangeTab,\n      form: userForm,\n      tabs: tabs\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 5\n  }, this);\n};\n\nexport default UserCreateEditDialog;","map":{"version":3,"sources":["D:/Fersher/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/User/CreateEdit.tsx"],"names":["useState","useEffect","useMemo","useSelector","useDispatch","useTranslation","useForm","userStore","AppTabHistoryLog","DialogMain","FormControllerTabs","BtnHelp","yupResolver","_","getValidationSchema","TabGeneral","TabJobs","TabGroups","UserCreateEditDialog","t","tab","setTab","dispatch","dialogState","selectDialogState","userDetail","selectDetail","permissions","selectPermissions","wiki_page","selectInitDataForCE","isCreating","isNil","id","title","validationSchema","userForm","shouldUnregister","resolver","reset","onChangeTab","newValue","onHandleSubmit","handleSubmit","formData","groups","map","item","job_access","job_id","note","valid_from","valid_until","payload","pick","sagaCreate","sagaUpdate","omit","onCloseDialog","sagaCloseDialog","clearErrors","handleChangeHistoryLogs","data","actions","setHistoryLogs","generalTab","label","panel","errorKey","groupsTab","jobsTab","historyTab","open","historyLogs","disabled","tabs","loading","edit"],"mappings":"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","sourcesContent":["import { useState, useEffect, useMemo } from 'react'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { useTranslation } from 'next-i18next'\nimport { useForm } from 'react-hook-form'\nimport { userStore } from '@/store/reducers'\n\nimport { AppTabHistoryLog, DialogMain, FormControllerTabs, BtnHelp } from '@/components'\n\nimport { yupResolver } from '@hookform/resolvers/yup'\nimport _ from 'lodash'\n\nimport getValidationSchema from './validationSchema'\n\nimport TabGeneral from './TabGeneral'\nimport TabJobs from './TabJobs'\nimport TabGroups from './TabGroups'\n\nimport type { UserDetail } from '@/types/User'\nimport type { HistoryLog } from '@/types/Common'\n\nconst UserCreateEditDialog: React.FC = () => {\n  const { t } = useTranslation('user')\n\n  const [tab, setTab] = useState(0)\n\n  const dispatch = useDispatch()\n  const dialogState = useSelector(userStore.selectDialogState)\n  const userDetail = useSelector(userStore.selectDetail)\n  const permissions = useSelector(userStore.selectPermissions)\n  const { wiki_page } = useSelector(userStore.selectInitDataForCE)\n\n  const isCreating = _.isNil(userDetail.id)\n\n  const title = isCreating ? t('form.title.create_user') : t('form.title.update_user')\n\n  const validationSchema = useMemo(() => getValidationSchema(t, !isCreating), [isCreating])\n  const userForm = useForm<UserDetail>({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  })\n\n  useEffect(() => {\n    userForm.reset(userDetail)\n    setTab(0)\n  }, [userDetail])\n\n  const onChangeTab = (_, newValue) => {\n    setTab(newValue)\n  }\n\n  const onHandleSubmit = userForm.handleSubmit((formData) => {\n    formData.groups = formData.groups.map((item) => +item)\n    formData.job_access = formData.job_access.map(({ job_id, note }) => ({\n      job_id,\n      note: note || '' // server returns null but they do not allow send null to body req\n    }))\n    if (!formData.valid_from) {\n      formData.valid_from = null\n    }\n    if (!formData.valid_until) {\n      formData.valid_until = null\n    }\n    const payload = _.pick(formData, [\n      'default_language',\n      'email',\n      'first_name',\n      'groups',\n      'job_access',\n      'last_name',\n      'puco',\n      'time_zone',\n      'user_abb',\n      'user_id',\n      'password',\n      'confirm_password',\n      'login_page',\n      'valid_from',\n      'valid_until'\n    ])\n    if (isCreating) {\n      dispatch(userStore.sagaCreate(payload as UserDetail))\n    } else {\n      dispatch(\n        userStore.sagaUpdate({\n          id: formData.id,\n          formData: _.omit(payload, ['password', 'confirm_password', 'login_page']) as UserDetail\n        })\n      )\n    }\n  })\n\n  const onCloseDialog = () => {\n    dispatch(userStore.sagaCloseDialog())\n    userForm.clearErrors()\n  }\n\n  const handleChangeHistoryLogs = (data: HistoryLog[]) => {\n    dispatch(userStore.actions.setHistoryLogs(data))\n  }\n\n  const generalTab = {\n    label: 'General',\n    panel: <TabGeneral />,\n    errorKey: [\n      'user_id',\n      'user_abb',\n      'first_name',\n      'last_name',\n      'password',\n      'confirm_password',\n      'email',\n      'time_zone',\n      'puco',\n      'default_language'\n    ]\n  }\n\n  const groupsTab = {\n    label: t('form.tab.groups'),\n    panel: <TabGroups />\n  }\n\n  const jobsTab = {\n    label: t('form.tab.jobs'),\n    panel: <TabJobs />\n  }\n\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: (\n      <AppTabHistoryLog\n        isOpenDialog={dialogState.open}\n        data={dialogState.historyLogs}\n        onChange={handleChangeHistoryLogs}\n        entityId={userDetail.id}\n        tableHeight={255}\n        entity=\"user\"\n      />\n    ),\n    disabled: isCreating\n  }\n\n  const tabs = [generalTab, groupsTab, jobsTab, historyTab]\n\n  return (\n    <DialogMain\n      open={dialogState.open}\n      title={<BtnHelp title={title} href={wiki_page} />}\n      height={560}\n      onOk={onHandleSubmit}\n      onClose={onCloseDialog}\n      okText={isCreating ? t('common:button.create') : t('common:button.update')}\n      okButtonProps={{\n        disabled: dialogState.loading || (!permissions?.edit && !isCreating)\n      }}\n      loading={dialogState.loading}\n    >\n      <FormControllerTabs value={tab} onChange={onChangeTab} form={userForm} tabs={tabs} />\n    </DialogMain>\n  )\n}\n\nexport default UserCreateEditDialog\n"]},"metadata":{},"sourceType":"module"}