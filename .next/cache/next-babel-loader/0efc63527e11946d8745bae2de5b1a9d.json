{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { call, all, select } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { setCookie } from 'nookies';\nimport { authStore, commonStore } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport authApi from '@/apis/auth.api';\nexport function* login({\n  payload\n}) {\n  yield put(authStore.actions.setLoading(true));\n\n  try {\n    const {\n      remember\n    } = payload,\n          loginData = _objectWithoutProperties(payload, [\"remember\"]);\n\n    const data = yield call(authApi.login, loginData);\n    yield put(authStore.actions.saveTokenLogin({\n      access_token: data.access_token,\n      redirect_to: data.redirect_to,\n      remember\n    }));\n  } catch (error) {\n    const {\n      response: {\n        data\n      }\n    } = error;\n    yield put(commonStore.actions.setErrorMessage(data.message));\n  }\n\n  yield put(authStore.actions.setLoading(false));\n}\nexport function* getProfile() {\n  yield put(authStore.actions.setLoadingAuth(true));\n\n  try {\n    const data = yield call(authApi.getProfile);\n    yield put(authStore.actions.setProfile(data));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(authStore.actions.setLoadingAuth(false));\n}\nexport function* changePassword({\n  payload\n}) {\n  yield put(authStore.actions.setPwDialogState({\n    loading: true\n  }));\n\n  try {\n    const {\n      message\n    } = yield call(authApi.changePassword, payload);\n    yield all([put(commonStore.actions.setSuccessMessage(message)), put(authStore.actions.setPwDialogState({\n      open: false\n    }))]);\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(authStore.actions.setPwDialogState({\n    loading: false\n  }));\n}\nexport function* fetchSettingInitData() {\n  const data = yield call(authApi.getInitDataForSetting);\n  yield put(authStore.actions.setSettingInitData(data));\n}\nexport function* fetchSettings() {\n  const _yield$call = yield call(authApi.getSettings),\n        {\n    message,\n    success\n  } = _yield$call,\n        detail = _objectWithoutProperties(_yield$call, [\"message\", \"success\"]);\n\n  yield put(authStore.actions.setSettingDetail(detail));\n}\nexport function* getSettings() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchSettingInitData);\n    yield call(fetchSettings);\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction getPathHomePage(options, homePageId) {\n  var _homePage$properties;\n\n  const homePage = _.find(options, {\n    value: homePageId\n  });\n\n  return (homePage === null || homePage === void 0 ? void 0 : (_homePage$properties = homePage.properties) === null || _homePage$properties === void 0 ? void 0 : _homePage$properties.path) || '';\n}\n\nexport function* saveSettingsSaga({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const {\n      message\n    } = yield call(authApi.saveSettings, payload);\n    const parameters = yield* select(authStore.selectSettingsParameters);\n    const homePagePath = getPathHomePage(parameters.PAGES, payload.home_page);\n\n    if (homePagePath) {\n      setCookie(null, 'redirect_to', homePagePath, {\n        maxAge: 60 * 60 * 24 * 365 // 1 day\n\n      });\n    }\n\n    yield put(authStore.actions.setDefaultLanguage(payload.default_language));\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\nexport function* logout({\n  payload\n}) {\n  const entity = yield* select(commonStore.selectEntity);\n\n  if ((payload === null || payload === void 0 ? void 0 : payload.confirm) === 'save') {\n    yield put(commonStore.sagaUpdateMultiple({\n      entity: entity,\n      action: authStore.actions.logout\n    }));\n  } else {\n    yield put(authStore.actions.logout());\n  }\n}\n\nfunction* authSaga() {\n  yield takeEvery(authStore.sagaLogin, login);\n  yield takeEvery(authStore.sagaGetProfile, getProfile);\n  yield takeEvery(authStore.sagaChangePassword, changePassword);\n  yield takeEvery(authStore.sagaGetSettings, getSettings);\n  yield takeEvery(authStore.sagaSaveSettings, saveSettingsSaga);\n  yield takeEvery(authStore.sagaLogout, logout);\n}\n\nexport default authSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/auth.saga.ts"],"names":["put","takeEvery","call","all","select","_","setCookie","authStore","commonStore","errorSaga","authApi","login","payload","actions","setLoading","remember","loginData","data","saveTokenLogin","access_token","redirect_to","error","response","setErrorMessage","message","getProfile","setLoadingAuth","setProfile","handleError","changePassword","setPwDialogState","loading","setSuccessMessage","open","fetchSettingInitData","getInitDataForSetting","setSettingInitData","fetchSettings","getSettings","success","detail","setSettingDetail","setLoadingPage","getPathHomePage","options","homePageId","homePage","find","value","properties","path","saveSettingsSaga","saveSettings","parameters","selectSettingsParameters","homePagePath","PAGES","home_page","maxAge","setDefaultLanguage","default_language","logout","entity","selectEntity","confirm","sagaUpdateMultiple","action","authSaga","sagaLogin","sagaGetProfile","sagaChangePassword","sagaGetSettings","sagaSaveSettings","sagaLogout"],"mappings":";;;;AAAA,SAASA,GAAT,EAAcC,SAAd,QAA+B,oBAA/B;AACA,SAASC,IAAT,EAAeC,GAAf,EAAoBC,MAApB,QAAkC,kBAAlC;AAEA,OAAOC,CAAP,MAAc,QAAd;AACA,SAASC,SAAT,QAA0B,SAA1B;AACA,SAASC,SAAT,EAAoBC,WAApB,QAAuC,kBAAvC;AAEA,OAAO,KAAKC,SAAZ,MAA2B,wBAA3B;AAEA,OAAOC,OAAP,MAAoB,iBAApB;AAIA,OAAO,UAAUC,KAAV,CAAgB;AAAEC,EAAAA;AAAF,CAAhB,EAAqE;AAC1E,QAAMZ,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBC,UAAlB,CAA6B,IAA7B,CAAD,CAAT;;AACA,MAAI;AACF,UAAM;AAAEC,MAAAA;AAAF,QAA6BH,OAAnC;AAAA,UAAqBI,SAArB,4BAAmCJ,OAAnC;;AACA,UAAMK,IAAI,GAAG,MAAMf,IAAI,CAACQ,OAAO,CAACC,KAAT,EAAgBK,SAAhB,CAAvB;AACA,UAAMhB,GAAG,CACPO,SAAS,CAACM,OAAV,CAAkBK,cAAlB,CAAiC;AAC/BC,MAAAA,YAAY,EAAEF,IAAI,CAACE,YADY;AAE/BC,MAAAA,WAAW,EAAEH,IAAI,CAACG,WAFa;AAG/BL,MAAAA;AAH+B,KAAjC,CADO,CAAT;AAOD,GAVD,CAUE,OAAOM,KAAP,EAAc;AACd,UAAM;AACJC,MAAAA,QAAQ,EAAE;AAAEL,QAAAA;AAAF;AADN,QAEFI,KAFJ;AAGA,UAAMrB,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoBU,eAApB,CAAoCN,IAAI,CAACO,OAAzC,CAAD,CAAT;AACD;;AACD,QAAMxB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBC,UAAlB,CAA6B,KAA7B,CAAD,CAAT;AACD;AAED,OAAO,UAAUW,UAAV,GAAuB;AAC5B,QAAMzB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBa,cAAlB,CAAiC,IAAjC,CAAD,CAAT;;AACA,MAAI;AACF,UAAMT,IAAI,GAAG,MAAMf,IAAI,CAACQ,OAAO,CAACe,UAAT,CAAvB;AACA,UAAMzB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBc,UAAlB,CAA6BV,IAA7B,CAAD,CAAT;AACD,GAHD,CAGE,OAAOI,KAAP,EAAc;AACd,UAAMZ,SAAS,CAACmB,WAAV,CAAsBP,KAAtB,CAAN;AACD;;AACD,QAAMrB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBa,cAAlB,CAAiC,KAAjC,CAAD,CAAT;AACD;AAED,OAAO,UAAUG,cAAV,CAAyB;AAAEjB,EAAAA;AAAF,CAAzB,EAAuF;AAC5F,QAAMZ,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBiB,gBAAlB,CAAmC;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAnC,CAAD,CAAT;;AAEA,MAAI;AACF,UAAM;AAAEP,MAAAA;AAAF,QAAc,MAAMtB,IAAI,CAACQ,OAAO,CAACmB,cAAT,EAAyBjB,OAAzB,CAA9B;AACA,UAAMT,GAAG,CAAC,CACRH,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoBmB,iBAApB,CAAsCR,OAAtC,CAAD,CADK,EAERxB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBiB,gBAAlB,CAAmC;AAAEG,MAAAA,IAAI,EAAE;AAAR,KAAnC,CAAD,CAFK,CAAD,CAAT;AAID,GAND,CAME,OAAOZ,KAAP,EAAc;AACd,UAAMZ,SAAS,CAACmB,WAAV,CAAsBP,KAAtB,CAAN;AACD;;AAED,QAAMrB,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBiB,gBAAlB,CAAmC;AAAEC,IAAAA,OAAO,EAAE;AAAX,GAAnC,CAAD,CAAT;AACD;AAED,OAAO,UAAUG,oBAAV,GAAiC;AACtC,QAAMjB,IAAI,GAAG,MAAMf,IAAI,CAACQ,OAAO,CAACyB,qBAAT,CAAvB;AACA,QAAMnC,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBuB,kBAAlB,CAAqCnB,IAArC,CAAD,CAAT;AACD;AAED,OAAO,UAAUoB,aAAV,GAA0B;AAC/B,sBAAwC,MAAMnC,IAAI,CAACQ,OAAO,CAAC4B,WAAT,CAAlD;AAAA,QAAM;AAAEd,IAAAA,OAAF;AAAWe,IAAAA;AAAX,GAAN;AAAA,QAA6BC,MAA7B;;AACA,QAAMxC,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkB4B,gBAAlB,CAAmCD,MAAnC,CAAD,CAAT;AACD;AAED,OAAO,UAAUF,WAAV,GAAwB;AAC7B,QAAMtC,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoB6B,cAApB,CAAmC,IAAnC,CAAD,CAAT;;AACA,MAAI;AACF,UAAMxC,IAAI,CAACgC,oBAAD,CAAV;AACA,UAAMhC,IAAI,CAACmC,aAAD,CAAV;AACD,GAHD,CAGE,OAAOhB,KAAP,EAAc;AACd,UAAMZ,SAAS,CAACmB,WAAV,CAAsBP,KAAtB,CAAN;AACD;;AACD,QAAMrB,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoB6B,cAApB,CAAmC,KAAnC,CAAD,CAAT;AACD;;AAED,SAASC,eAAT,CAAyBC,OAAzB,EAAqDC,UAArD,EAAyE;AAAA;;AACvE,QAAMC,QAAQ,GAAGzC,CAAC,CAAC0C,IAAF,CAAOH,OAAP,EAAgB;AAAEI,IAAAA,KAAK,EAAEH;AAAT,GAAhB,CAAjB;;AACA,SAAO,CAAAC,QAAQ,SAAR,IAAAA,QAAQ,WAAR,oCAAAA,QAAQ,CAAEG,UAAV,8EAAsBC,IAAtB,KAA8B,EAArC;AACD;;AAED,OAAO,UAAUC,gBAAV,CAA2B;AAAEvC,EAAAA;AAAF,CAA3B,EAAuF;AAC5F,QAAMZ,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoB6B,cAApB,CAAmC,IAAnC,CAAD,CAAT;;AACA,MAAI;AACF,UAAM;AAAElB,MAAAA;AAAF,QAAc,MAAMtB,IAAI,CAACQ,OAAO,CAAC0C,YAAT,EAAuBxC,OAAvB,CAA9B;AACA,UAAMyC,UAAU,GAAG,OAAOjD,MAAM,CAACG,SAAS,CAAC+C,wBAAX,CAAhC;AACA,UAAMC,YAAY,GAAGZ,eAAe,CAACU,UAAU,CAACG,KAAZ,EAAmB5C,OAAO,CAAC6C,SAA3B,CAApC;;AACA,QAAIF,YAAJ,EAAkB;AAChBjD,MAAAA,SAAS,CAAC,IAAD,EAAO,aAAP,EAAsBiD,YAAtB,EAAoC;AAC3CG,QAAAA,MAAM,EAAE,KAAK,EAAL,GAAU,EAAV,GAAe,GADoB,CAChB;;AADgB,OAApC,CAAT;AAGD;;AACD,UAAM1D,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkB8C,kBAAlB,CAAqC/C,OAAO,CAACgD,gBAA7C,CAAD,CAAT;AACA,UAAM5D,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoBmB,iBAApB,CAAsCR,OAAtC,CAAD,CAAT;AACD,GAXD,CAWE,OAAOH,KAAP,EAAc;AACd,UAAMZ,SAAS,CAACmB,WAAV,CAAsBP,KAAtB,CAAN;AACD;;AAED,QAAMrB,GAAG,CAACQ,WAAW,CAACK,OAAZ,CAAoB6B,cAApB,CAAmC,KAAnC,CAAD,CAAT;AACD;AAED,OAAO,UAAUmB,MAAV,CAAiB;AAAEjD,EAAAA;AAAF,CAAjB,EAAuE;AAC5E,QAAMkD,MAAM,GAAG,OAAO1D,MAAM,CAACI,WAAW,CAACuD,YAAb,CAA5B;;AACA,MAAI,CAAAnD,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEoD,OAAT,MAAqB,MAAzB,EAAiC;AAC/B,UAAMhE,GAAG,CACPQ,WAAW,CAACyD,kBAAZ,CAA+B;AAC7BH,MAAAA,MAAM,EAAEA,MADqB;AAE7BI,MAAAA,MAAM,EAAE3D,SAAS,CAACM,OAAV,CAAkBgD;AAFG,KAA/B,CADO,CAAT;AAMD,GAPD,MAOO;AACL,UAAM7D,GAAG,CAACO,SAAS,CAACM,OAAV,CAAkBgD,MAAlB,EAAD,CAAT;AACD;AACF;;AAED,UAAUM,QAAV,GAAqB;AACnB,QAAMlE,SAAS,CAACM,SAAS,CAAC6D,SAAX,EAAsBzD,KAAtB,CAAf;AACA,QAAMV,SAAS,CAACM,SAAS,CAAC8D,cAAX,EAA2B5C,UAA3B,CAAf;AACA,QAAMxB,SAAS,CAACM,SAAS,CAAC+D,kBAAX,EAA+BzC,cAA/B,CAAf;AACA,QAAM5B,SAAS,CAACM,SAAS,CAACgE,eAAX,EAA4BjC,WAA5B,CAAf;AACA,QAAMrC,SAAS,CAACM,SAAS,CAACiE,gBAAX,EAA6BrB,gBAA7B,CAAf;AACA,QAAMlD,SAAS,CAACM,SAAS,CAACkE,UAAX,EAAuBZ,MAAvB,CAAf;AACD;;AAED,eAAeM,QAAf","sourcesContent":["import { put, takeEvery } from 'redux-saga/effects'\nimport { call, all, select } from 'typed-redux-saga'\n\nimport _ from 'lodash'\nimport { setCookie } from 'nookies'\nimport { authStore, commonStore } from '@/store/reducers'\n\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport authApi from '@/apis/auth.api'\n\nimport type { ParameterOption } from '@/types/Common'\n\nexport function* login({ payload }: ReturnType<typeof authStore.sagaLogin>) {\n  yield put(authStore.actions.setLoading(true))\n  try {\n    const { remember, ...loginData } = payload\n    const data = yield call(authApi.login, loginData)\n    yield put(\n      authStore.actions.saveTokenLogin({\n        access_token: data.access_token,\n        redirect_to: data.redirect_to,\n        remember\n      })\n    )\n  } catch (error) {\n    const {\n      response: { data }\n    } = error\n    yield put(commonStore.actions.setErrorMessage(data.message))\n  }\n  yield put(authStore.actions.setLoading(false))\n}\n\nexport function* getProfile() {\n  yield put(authStore.actions.setLoadingAuth(true))\n  try {\n    const data = yield call(authApi.getProfile)\n    yield put(authStore.actions.setProfile(data))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(authStore.actions.setLoadingAuth(false))\n}\n\nexport function* changePassword({ payload }: ReturnType<typeof authStore.sagaChangePassword>) {\n  yield put(authStore.actions.setPwDialogState({ loading: true }))\n\n  try {\n    const { message } = yield call(authApi.changePassword, payload)\n    yield all([\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(authStore.actions.setPwDialogState({ open: false }))\n    ])\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(authStore.actions.setPwDialogState({ loading: false }))\n}\n\nexport function* fetchSettingInitData() {\n  const data = yield call(authApi.getInitDataForSetting)\n  yield put(authStore.actions.setSettingInitData(data))\n}\n\nexport function* fetchSettings() {\n  const { message, success, ...detail } = yield call(authApi.getSettings)\n  yield put(authStore.actions.setSettingDetail(detail))\n}\n\nexport function* getSettings() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchSettingInitData)\n    yield call(fetchSettings)\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction getPathHomePage(options: ParameterOption[], homePageId: number) {\n  const homePage = _.find(options, { value: homePageId })\n  return homePage?.properties?.path || ''\n}\n\nexport function* saveSettingsSaga({ payload }: ReturnType<typeof authStore.sagaSaveSettings>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { message } = yield call(authApi.saveSettings, payload)\n    const parameters = yield* select(authStore.selectSettingsParameters)\n    const homePagePath = getPathHomePage(parameters.PAGES, payload.home_page)\n    if (homePagePath) {\n      setCookie(null, 'redirect_to', homePagePath, {\n        maxAge: 60 * 60 * 24 * 365 // 1 day\n      })\n    }\n    yield put(authStore.actions.setDefaultLanguage(payload.default_language))\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* logout({ payload }: ReturnType<typeof authStore.sagaLogout>) {\n  const entity = yield* select(commonStore.selectEntity)\n  if (payload?.confirm === 'save') {\n    yield put(\n      commonStore.sagaUpdateMultiple({\n        entity: entity,\n        action: authStore.actions.logout\n      })\n    )\n  } else {\n    yield put(authStore.actions.logout())\n  }\n}\n\nfunction* authSaga() {\n  yield takeEvery(authStore.sagaLogin, login)\n  yield takeEvery(authStore.sagaGetProfile, getProfile)\n  yield takeEvery(authStore.sagaChangePassword, changePassword)\n  yield takeEvery(authStore.sagaGetSettings, getSettings)\n  yield takeEvery(authStore.sagaSaveSettings, saveSettingsSaga)\n  yield takeEvery(authStore.sagaLogout, logout)\n}\n\nexport default authSaga\n"]},"metadata":{},"sourceType":"module"}