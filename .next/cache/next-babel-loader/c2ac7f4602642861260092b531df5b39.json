{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"D:\\\\TTS_Reactjs\\\\malis-3-frontend\\\\src\\\\components\\\\Dialog\\\\Module\\\\Drawing\\\\CreateEdit.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useMemo, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'next-i18next';\nimport { DialogMain, TableExtendedProperties, AppTabHistoryLog, FormControllerTabs, BtnHelp } from '@/components';\nimport TabGeneral from './TabGeneral';\nimport TabDetail from './TabDetail';\nimport TabParts from './TabParts';\nimport TabTags from './TabTags';\nimport TabSynchronization from './TabSynchronization';\nimport TabJobNotice from './TabJobNotice';\nimport TabParent from './TabParent';\nimport DialogRevision from './DialogRevision';\nimport _ from 'lodash';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { drawingStore, commonStore } from '@/store/reducers';\nimport getValidationSchema from './validationSchema';\nimport { defaultProperties } from '@/utils/columnProperties';\n\nfunction DialogDrawingCreateEdit() {\n  const {\n    t\n  } = useTranslation('drawing');\n  const validationSchema = useMemo(() => getValidationSchema(t), []);\n  const dispatch = useDispatch();\n  const dialogState = useSelector(drawingStore.selectDialogState);\n  const drawingDetail = useSelector(drawingStore.selectDetail);\n  const userJob = useSelector(commonStore.selectUserValueJob);\n  const {\n    parameters,\n    wiki_page\n  } = useSelector(drawingStore.selectInitDataForCE);\n  const permissions = useSelector(drawingStore.selectPermissions);\n\n  const isCreating = _.isNil(drawingDetail.id);\n\n  const drawingForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  });\n  useEffect(() => {\n    drawingForm.reset(drawingDetail);\n  }, [drawingDetail]);\n\n  const onChangeTab = (event, nextTab) => {\n    dispatch(drawingStore.actions.setDialogStateTab(nextTab));\n  };\n\n  const onSubmitData = drawingForm.handleSubmit(data => {\n    data.job_id = userJob.value;\n    data.associated_documents = data.associated_documents.map(({\n      value\n    }) => parseInt(value));\n\n    const drawing = _.pick(data, ['additional_attributes', 'associated_documents', 'customer_id', 'descriptions', 'drawing_format', 'drawing_purpose', 'exclude_from_customer', 'exclude_from_other', 'exclude_from_supplier', 'file_prefix', 'file_type', 'job_id', 'revision', 'drawing_id', 'is_detail_drawing', 'is_drawing', 'is_other_document', 'is_schematic', 'is_specification']);\n\n    if (isCreating) {\n      dispatch(drawingStore.sagaCreate(drawing));\n    } else {\n      const payloadUpdate = _.omit(drawing, ['drawing_id', 'revison']);\n\n      dispatch(drawingStore.sagaUpdate({\n        id: data.id,\n        drawing: payloadUpdate\n      }));\n    }\n  });\n\n  const handleClose = () => {\n    dispatch(drawingStore.sagaCloseDialog());\n  };\n\n  const handleOpenRevisionDialog = () => {\n    dispatch(drawingStore.sagaOpenRevDialog(drawingDetail.revision));\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(drawingStore.actions.setHistoryLogs(data));\n  };\n\n  const extraButtons = [{\n    label: t('button.save_as_revision'),\n    hide: isCreating,\n    disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating,\n    onClick: handleOpenRevisionDialog\n  }, {\n    label: isCreating ? t('common:button.create') : t('common:button.update'),\n    disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating,\n    onClick: onSubmitData\n  }, {\n    label: t('common:button.close'),\n    onClick: handleClose\n  }];\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: /*#__PURE__*/_jsxDEV(TabGeneral, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 12\n    }, this),\n    errorKey: ['drawing_id', 'customer_id', 'revision', 'drawing_format', 'drawing_purpose']\n  };\n  const detailTab = {\n    label: t('form.tab.detail'),\n    panel: /*#__PURE__*/_jsxDEV(TabDetail, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 12\n    }, this)\n  };\n  const partsTab = {\n    label: t('form.tab.parts'),\n    panel: /*#__PURE__*/_jsxDEV(TabParts, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 12\n    }, this),\n    hide: isCreating\n  };\n  const tagsTab = {\n    label: t('form.tab.tags'),\n    panel: /*#__PURE__*/_jsxDEV(TabTags, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 12\n    }, this),\n    hide: isCreating\n  };\n  const syncTab = {\n    label: t('form.tab.synchronization'),\n    panel: /*#__PURE__*/_jsxDEV(TabSynchronization, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 12\n    }, this),\n    hide: isCreating,\n    disabled: true\n  };\n  const jobNoticeTab = {\n    label: t('form.tab.job_notices'),\n    panel: /*#__PURE__*/_jsxDEV(TabJobNotice, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 12\n    }, this),\n    hide: isCreating,\n    disabled: true\n  };\n  const parentTab = {\n    label: t('form.tab.parents'),\n    panel: /*#__PURE__*/_jsxDEV(TabParent, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 12\n    }, this),\n    hide: isCreating,\n    disabled: true\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: /*#__PURE__*/_jsxDEV(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: drawingDetail.id,\n      mode: \"horizonatal\",\n      tableHeight: 430,\n      descriptionRows: 26,\n      entity: \"drawing\",\n      extraColumns: [_objectSpread(_objectSpread({}, defaultProperties), {}, {\n        field: 'revision',\n        headerName: 'Revision',\n        width: 100\n      })]\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }, this),\n    hide: isCreating\n  };\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: /*#__PURE__*/_jsxDEV(TableExtendedProperties, {\n      control: drawingForm.control,\n      name: \"additional_attributes\",\n      editMode: !isCreating,\n      propertiesList: parameters.PLAT,\n      tableHeight: 435,\n      parameterName: \"PLAT\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this)\n  };\n  const tabs = [generalTab, detailTab, partsTab, tagsTab, syncTab, jobNoticeTab, parentTab, historyTab, extendedPropertyTab];\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(DialogMain, {\n      open: dialogState.open,\n      loading: dialogState.loading,\n      title: /*#__PURE__*/_jsxDEV(BtnHelp, {\n        title: isCreating ? t('form.title.create_drawing') : t('form.title.update_drawing'),\n        href: wiki_page\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 11\n      }, this),\n      fullWidth: true,\n      maxWidth: \"lg\",\n      extraButtons: extraButtons,\n      height: 510,\n      onClose: handleClose,\n      children: /*#__PURE__*/_jsxDEV(FormControllerTabs, {\n        value: dialogState.tab,\n        onChange: onChangeTab,\n        form: drawingForm,\n        tabs: tabs\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogRevision, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\nexport default DialogDrawingCreateEdit;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/components/Dialog/Module/Drawing/CreateEdit.tsx"],"names":["useMemo","useEffect","useDispatch","useSelector","useForm","useTranslation","DialogMain","TableExtendedProperties","AppTabHistoryLog","FormControllerTabs","BtnHelp","TabGeneral","TabDetail","TabParts","TabTags","TabSynchronization","TabJobNotice","TabParent","DialogRevision","_","yupResolver","drawingStore","commonStore","getValidationSchema","defaultProperties","DialogDrawingCreateEdit","t","validationSchema","dispatch","dialogState","selectDialogState","drawingDetail","selectDetail","userJob","selectUserValueJob","parameters","wiki_page","selectInitDataForCE","permissions","selectPermissions","isCreating","isNil","id","drawingForm","shouldUnregister","resolver","reset","onChangeTab","event","nextTab","actions","setDialogStateTab","onSubmitData","handleSubmit","data","job_id","value","associated_documents","map","parseInt","drawing","pick","sagaCreate","payloadUpdate","omit","sagaUpdate","handleClose","sagaCloseDialog","handleOpenRevisionDialog","sagaOpenRevDialog","revision","handleChangeHistoryLogs","setHistoryLogs","extraButtons","label","hide","disabled","loading","edit","onClick","generalTab","panel","errorKey","detailTab","partsTab","tagsTab","syncTab","jobNoticeTab","parentTab","historyTab","open","historyLogs","field","headerName","width","extendedPropertyTab","control","PLAT","tabs","tab"],"mappings":"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","sourcesContent":["import { useMemo, useEffect } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { useForm } from 'react-hook-form'\nimport { useTranslation } from 'next-i18next'\n\nimport { DialogMain, TableExtendedProperties, AppTabHistoryLog, FormControllerTabs, BtnHelp } from '@/components'\n\nimport TabGeneral from './TabGeneral'\nimport TabDetail from './TabDetail'\nimport TabParts from './TabParts'\nimport TabTags from './TabTags'\nimport TabSynchronization from './TabSynchronization'\nimport TabJobNotice from './TabJobNotice'\nimport TabParent from './TabParent'\nimport DialogRevision from './DialogRevision'\n\nimport _ from 'lodash'\nimport { yupResolver } from '@hookform/resolvers/yup'\nimport { drawingStore, commonStore } from '@/store/reducers'\nimport getValidationSchema from './validationSchema'\nimport { defaultProperties } from '@/utils/columnProperties'\n\nimport type { DrawingDetail } from '@/types/Drawing'\nimport type { ExtraButton } from '@/components/Dialog/Main/type'\nimport type { HistoryLog } from '@/types/Common'\n\nfunction DialogDrawingCreateEdit() {\n  const { t } = useTranslation('drawing')\n  const validationSchema = useMemo(() => getValidationSchema(t), [])\n\n  const dispatch = useDispatch()\n  const dialogState = useSelector(drawingStore.selectDialogState)\n  const drawingDetail = useSelector(drawingStore.selectDetail)\n  const userJob = useSelector(commonStore.selectUserValueJob)\n  const { parameters, wiki_page } = useSelector(drawingStore.selectInitDataForCE)\n  const permissions = useSelector(drawingStore.selectPermissions)\n\n  const isCreating = _.isNil(drawingDetail.id)\n\n  const drawingForm = useForm<DrawingDetail>({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  })\n\n  useEffect(() => {\n    drawingForm.reset(drawingDetail)\n  }, [drawingDetail])\n\n  const onChangeTab = (event, nextTab: number) => {\n    dispatch(drawingStore.actions.setDialogStateTab(nextTab))\n  }\n\n  const onSubmitData = drawingForm.handleSubmit((data) => {\n    data.job_id = userJob.value\n    data.associated_documents = data.associated_documents.map(({ value }) => parseInt(value))\n    const drawing = _.pick(data, [\n      'additional_attributes',\n      'associated_documents',\n      'customer_id',\n      'descriptions',\n      'drawing_format',\n      'drawing_purpose',\n      'exclude_from_customer',\n      'exclude_from_other',\n      'exclude_from_supplier',\n      'file_prefix',\n      'file_type',\n      'job_id',\n      'revision',\n      'drawing_id',\n      'is_detail_drawing',\n      'is_drawing',\n      'is_other_document',\n      'is_schematic',\n      'is_specification'\n    ])\n    if (isCreating) {\n      dispatch(drawingStore.sagaCreate(drawing))\n    } else {\n      const payloadUpdate = _.omit(drawing, ['drawing_id', 'revison']) as DrawingDetail\n      dispatch(\n        drawingStore.sagaUpdate({\n          id: data.id,\n          drawing: payloadUpdate\n        })\n      )\n    }\n  })\n\n  const handleClose = () => {\n    dispatch(drawingStore.sagaCloseDialog())\n  }\n\n  const handleOpenRevisionDialog = () => {\n    dispatch(drawingStore.sagaOpenRevDialog(drawingDetail.revision))\n  }\n\n  const handleChangeHistoryLogs = (data: HistoryLog[]) => {\n    dispatch(drawingStore.actions.setHistoryLogs(data))\n  }\n\n  const extraButtons: ExtraButton[] = [\n    {\n      label: t('button.save_as_revision'),\n      hide: isCreating,\n\n      disabled: dialogState.loading || (!permissions?.edit && !isCreating),\n      onClick: handleOpenRevisionDialog\n    },\n    {\n      label: isCreating ? t('common:button.create') : t('common:button.update'),\n      disabled: dialogState.loading || (!permissions?.edit && !isCreating),\n      onClick: onSubmitData\n    },\n    {\n      label: t('common:button.close'),\n      onClick: handleClose\n    }\n  ]\n\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: <TabGeneral />,\n    errorKey: ['drawing_id', 'customer_id', 'revision', 'drawing_format', 'drawing_purpose']\n  }\n\n  const detailTab = {\n    label: t('form.tab.detail'),\n    panel: <TabDetail />\n  }\n\n  const partsTab = {\n    label: t('form.tab.parts'),\n    panel: <TabParts />,\n    hide: isCreating\n  }\n\n  const tagsTab = {\n    label: t('form.tab.tags'),\n    panel: <TabTags />,\n    hide: isCreating\n  }\n\n  const syncTab = {\n    label: t('form.tab.synchronization'),\n    panel: <TabSynchronization />,\n    hide: isCreating,\n    disabled: true\n  }\n\n  const jobNoticeTab = {\n    label: t('form.tab.job_notices'),\n    panel: <TabJobNotice />,\n    hide: isCreating,\n    disabled: true\n  }\n\n  const parentTab = {\n    label: t('form.tab.parents'),\n    panel: <TabParent />,\n    hide: isCreating,\n    disabled: true\n  }\n\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: (\n      <AppTabHistoryLog\n        isOpenDialog={dialogState.open}\n        data={dialogState.historyLogs}\n        onChange={handleChangeHistoryLogs}\n        entityId={drawingDetail.id}\n        mode=\"horizonatal\"\n        tableHeight={430}\n        descriptionRows={26}\n        entity=\"drawing\"\n        extraColumns={[\n          {\n            ...defaultProperties,\n            field: 'revision',\n            headerName: 'Revision',\n            width: 100\n          }\n        ]}\n      />\n    ),\n    hide: isCreating\n  }\n\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: (\n      <TableExtendedProperties\n        control={drawingForm.control}\n        name=\"additional_attributes\"\n        editMode={!isCreating}\n        propertiesList={parameters.PLAT}\n        tableHeight={435}\n        parameterName=\"PLAT\"\n      />\n    )\n  }\n\n  const tabs = [\n    generalTab,\n    detailTab,\n    partsTab,\n    tagsTab,\n    syncTab,\n    jobNoticeTab,\n    parentTab,\n    historyTab,\n    extendedPropertyTab\n  ]\n\n  return (\n    <>\n      <DialogMain\n        open={dialogState.open}\n        loading={dialogState.loading}\n        title={\n          <BtnHelp\n            title={isCreating ? t('form.title.create_drawing') : t('form.title.update_drawing')}\n            href={wiki_page}\n          />\n        }\n        fullWidth\n        maxWidth=\"lg\"\n        extraButtons={extraButtons}\n        height={510}\n        onClose={handleClose}\n      >\n        <FormControllerTabs value={dialogState.tab} onChange={onChangeTab} form={drawingForm} tabs={tabs} />\n      </DialogMain>\n      <DialogRevision />\n    </>\n  )\n}\n\nexport default DialogDrawingCreateEdit\n"]},"metadata":{},"sourceType":"module"}