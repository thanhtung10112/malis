{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForList),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(fetchDetail),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(fetchList),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchInitDataForCE),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(getUserList),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(openUserCreateDialog),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(createUser),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(openUserUpdateDialog),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(resetPassword),\n    _marked10 = /*#__PURE__*/_regeneratorRuntime.mark(updateUser),\n    _marked11 = /*#__PURE__*/_regeneratorRuntime.mark(closeUserDialog),\n    _marked12 = /*#__PURE__*/_regeneratorRuntime.mark(userSaga);\n\nimport { takeEvery, put, putResolve } from 'redux-saga/effects';\nimport { select, all, call } from 'typed-redux-saga';\nimport { v1 as uuidv1 } from 'uuid';\nimport { advancedFilterActions, commonStore, userStore, authStore } from '@/store/reducers';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport userApi from '@/apis/user.api';\nimport { getProfile } from './auth.saga';\nimport { getDefaultValues } from '@/utils/getDefaultValues';\n\nfunction fetchInitDataForList() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchInitDataForList$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return call(userApi.getInitDataForList);\n\n        case 2:\n          data = _context.sent;\n          _context.next = 5;\n          return put(userStore.actions.setInitDataForList(data));\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nfunction fetchDetail(id) {\n  var _yield$call, user;\n\n  return _regeneratorRuntime.wrap(function fetchDetail$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return call(userApi.getDetail, id);\n\n        case 2:\n          _yield$call = _context2.sent;\n          user = _yield$call.user;\n          user.job_access = user.job_access.map(function (item) {\n            return _objectSpread(_objectSpread({}, item), {}, {\n              id: uuidv1()\n            });\n          });\n          _context2.next = 7;\n          return put(userStore.actions.setDetail(user));\n\n        case 7:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction fetchList() {\n  var _yield$all, tableState, searchQuery, filterData, page, per_page, data;\n\n  return _regeneratorRuntime.wrap(function fetchList$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          return _context3.delegateYield(all({\n            tableState: select(commonStore.selectTableState),\n            searchQuery: select(commonStore.selectSearchQuery),\n            filterData: select(advancedFilterActions.selectFilterData)\n          }), \"t0\", 1);\n\n        case 1:\n          _yield$all = _context3.t0;\n          tableState = _yield$all.tableState;\n          searchQuery = _yield$all.searchQuery;\n          filterData = _yield$all.filterData;\n          page = tableState.page, per_page = tableState.per_page;\n          _context3.next = 8;\n          return call(userApi.getList, _objectSpread({\n            per_page: per_page,\n            page: page,\n            s: searchQuery\n          }, filterData));\n\n        case 8:\n          data = _context3.sent;\n          _context3.next = 11;\n          return put(commonStore.actions.setTableState({\n            total_items: data.total_items\n          }));\n\n        case 11:\n          _context3.next = 13;\n          return put(userStore.actions.setDataList(data.user_lists));\n\n        case 13:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\n\nfunction fetchInitDataForCE() {\n  var data, defaultValue;\n  return _regeneratorRuntime.wrap(function fetchInitDataForCE$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(userApi.getInitDataForCE);\n\n        case 2:\n          data = _context4.sent;\n          defaultValue = getDefaultValues(data, {\n            default_language: 'parameters.PLLA',\n            puco: 'parameters.PUCO',\n            time_zone: 'timezones'\n          });\n          _context4.next = 6;\n          return all([put(userStore.actions.setInitDataForCE(data)), put(userStore.actions.setDetail(defaultValue))]);\n\n        case 6:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\n\nexport function getUserList() {\n  var permissions;\n  return _regeneratorRuntime.wrap(function getUserList$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context5.prev = 2;\n          _context5.next = 5;\n          return call(fetchInitDataForList);\n\n        case 5:\n          return _context5.delegateYield(select(userStore.selectPermissions), \"t0\", 6);\n\n        case 6:\n          permissions = _context5.t0;\n\n          if (!permissions.view) {\n            _context5.next = 10;\n            break;\n          }\n\n          _context5.next = 10;\n          return call(fetchList);\n\n        case 10:\n          _context5.next = 16;\n          break;\n\n        case 12:\n          _context5.prev = 12;\n          _context5.t1 = _context5[\"catch\"](2);\n          _context5.next = 16;\n          return errorSaga.handleError(_context5.t1);\n\n        case 16:\n          _context5.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5, null, [[2, 12]]);\n}\nexport function openUserCreateDialog() {\n  return _regeneratorRuntime.wrap(function openUserCreateDialog$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchInitDataForCE);\n\n        case 5:\n          _context6.next = 7;\n          return put(userStore.actions.setDialogStateOpen(true));\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return errorSaga.handleError(_context6.t0);\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\nexport function createUser(_ref) {\n  var payload, _yield$call2, message;\n\n  return _regeneratorRuntime.wrap(function createUser$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref.payload;\n          _context7.next = 3;\n          return put(userStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return call(userApi.create, payload);\n\n        case 6:\n          _yield$call2 = _context7.sent;\n          message = _yield$call2.message;\n          _context7.next = 10;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(userStore.actions.resetDetail())]);\n\n        case 10:\n          _context7.next = 16;\n          break;\n\n        case 12:\n          _context7.prev = 12;\n          _context7.t0 = _context7[\"catch\"](3);\n          _context7.next = 16;\n          return errorSaga.handleError(_context7.t0);\n\n        case 16:\n          _context7.next = 18;\n          return put(userStore.actions.setDialogStateLoading(false));\n\n        case 18:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 12]]);\n}\nexport function openUserUpdateDialog(_ref2) {\n  var userId;\n  return _regeneratorRuntime.wrap(function openUserUpdateDialog$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          userId = _ref2.payload;\n          _context8.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context8.prev = 3;\n          _context8.next = 6;\n          return call(fetchInitDataForCE);\n\n        case 6:\n          _context8.next = 8;\n          return call(fetchDetail, userId);\n\n        case 8:\n          _context8.next = 10;\n          return put(userStore.actions.setDialogState({\n            open: true,\n            editMode: true\n          }));\n\n        case 10:\n          _context8.next = 16;\n          break;\n\n        case 12:\n          _context8.prev = 12;\n          _context8.t0 = _context8[\"catch\"](3);\n          _context8.next = 16;\n          return errorSaga.handleError(_context8.t0);\n\n        case 16:\n          _context8.next = 18;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 18:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8, null, [[3, 12]]);\n}\nexport function resetPassword(_ref3) {\n  var payload, _yield$select, id, _yield$call3, message;\n\n  return _regeneratorRuntime.wrap(function resetPassword$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context9.next = 3;\n          return put(userStore.actions.setResetPwdDialogLoading(true));\n\n        case 3:\n          _context9.prev = 3;\n          return _context9.delegateYield(select(userStore.selectDetail), \"t0\", 5);\n\n        case 5:\n          _yield$select = _context9.t0;\n          id = _yield$select.id;\n          _context9.next = 9;\n          return call(userApi.update, id, payload);\n\n        case 9:\n          _yield$call3 = _context9.sent;\n          message = _yield$call3.message;\n          _context9.next = 13;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(userStore.actions.setResetPwdDialogOpen(false))]);\n\n        case 13:\n          _context9.next = 19;\n          break;\n\n        case 15:\n          _context9.prev = 15;\n          _context9.t1 = _context9[\"catch\"](3);\n          _context9.next = 19;\n          return errorSaga.handleError(_context9.t1);\n\n        case 19:\n          _context9.next = 21;\n          return put(userStore.actions.setResetPwdDialogLoading(false));\n\n        case 21:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9, null, [[3, 15]]);\n}\nexport function updateUser(_ref4) {\n  var payload, id, formData, profile, _yield$call4, message;\n\n  return _regeneratorRuntime.wrap(function updateUser$(_context10) {\n    while (1) {\n      switch (_context10.prev = _context10.next) {\n        case 0:\n          payload = _ref4.payload;\n          _context10.next = 3;\n          return put(userStore.actions.setDialogStateLoading(true));\n\n        case 3:\n          _context10.prev = 3;\n          id = payload.id, formData = payload.formData;\n          return _context10.delegateYield(select(authStore.selectProfile), \"t0\", 6);\n\n        case 6:\n          profile = _context10.t0;\n          _context10.next = 9;\n          return call(userApi.update, id, formData);\n\n        case 9:\n          _yield$call4 = _context10.sent;\n          message = _yield$call4.message;\n          _context10.next = 13;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 13:\n          _context10.next = 15;\n          return call(closeUserDialog);\n\n        case 15:\n          if (!(formData.user_id === profile.user_name)) {\n            _context10.next = 18;\n            break;\n          }\n\n          _context10.next = 18;\n          return call(getProfile);\n\n        case 18:\n          _context10.next = 24;\n          break;\n\n        case 20:\n          _context10.prev = 20;\n          _context10.t1 = _context10[\"catch\"](3);\n          _context10.next = 24;\n          return errorSaga.handleError(_context10.t1);\n\n        case 24:\n          _context10.next = 26;\n          return put(userStore.actions.setDialogStateLoading(false));\n\n        case 26:\n        case \"end\":\n          return _context10.stop();\n      }\n    }\n  }, _marked10, null, [[3, 20]]);\n}\nexport function closeUserDialog() {\n  return _regeneratorRuntime.wrap(function closeUserDialog$(_context11) {\n    while (1) {\n      switch (_context11.prev = _context11.next) {\n        case 0:\n          _context11.prev = 0;\n          _context11.next = 3;\n          return putResolve(userStore.actions.setDialogStateOpen(false));\n\n        case 3:\n          _context11.next = 5;\n          return call(getUserList);\n\n        case 5:\n          _context11.next = 7;\n          return put(userStore.actions.resetDetail());\n\n        case 7:\n          _context11.next = 13;\n          break;\n\n        case 9:\n          _context11.prev = 9;\n          _context11.t0 = _context11[\"catch\"](0);\n          _context11.next = 13;\n          return errorSaga.handleError(_context11.t0);\n\n        case 13:\n        case \"end\":\n          return _context11.stop();\n      }\n    }\n  }, _marked11, null, [[0, 9]]);\n}\n\nfunction userSaga() {\n  return _regeneratorRuntime.wrap(function userSaga$(_context12) {\n    while (1) {\n      switch (_context12.prev = _context12.next) {\n        case 0:\n          _context12.next = 2;\n          return takeEvery(userStore.sagaGetList, getUserList);\n\n        case 2:\n          _context12.next = 4;\n          return takeEvery(userStore.sagaOpenCreateDialog, openUserCreateDialog);\n\n        case 4:\n          _context12.next = 6;\n          return takeEvery(userStore.sagaCreate, createUser);\n\n        case 6:\n          _context12.next = 8;\n          return takeEvery(userStore.sagaOpenUpdateDialog, openUserUpdateDialog);\n\n        case 8:\n          _context12.next = 10;\n          return takeEvery(userStore.sagaUpdate, updateUser);\n\n        case 10:\n          _context12.next = 12;\n          return takeEvery(userStore.sagaResetPassword, resetPassword);\n\n        case 12:\n          _context12.next = 14;\n          return takeEvery(userStore.sagaCloseDialog, closeUserDialog);\n\n        case 14:\n        case \"end\":\n          return _context12.stop();\n      }\n    }\n  }, _marked12);\n}\n\nexport default userSaga;","map":null,"metadata":{},"sourceType":"module"}