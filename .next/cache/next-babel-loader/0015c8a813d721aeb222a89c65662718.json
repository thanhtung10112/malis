{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useMemo, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport { DialogMain, AppTabHistoryLog, FormControllerTabs, BtnHelp } from '@/components';\nimport TabGeneral from '../TabGeneral';\nimport TabAdditionalInfo from '../TabAdditionalInfo';\nimport TabOthers from '../TabOthers';\nimport Context from '../Context';\nimport _ from 'lodash';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { jobStore } from '@/store/reducers';\nimport * as constant from '@/utils/constant';\nimport getValidationSchema from '../validationSchema';\n\nfunction DialogJobCreateEdit() {\n  var _useTranslation = useTranslation('job'),\n      t = _useTranslation.t;\n\n  var validationSchema = useMemo(function () {\n    return getValidationSchema(t);\n  }, []);\n\n  var _useState = useState(0),\n      tab = _useState[0],\n      setTab = _useState[1];\n\n  var jobForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  });\n  var dispatch = useDispatch();\n  var dialogState = useSelector(jobStore.selectDialogState);\n  var jobDetail = useSelector(jobStore.selectDetail);\n  var permissions = useSelector(jobStore.selectPermissions);\n\n  var _useSelector = useSelector(jobStore.selectInitDataForCE),\n      wiki_page = _useSelector.wiki_page;\n\n  var isCreating = _.isNil(jobDetail.id);\n\n  useEffect(function () {\n    jobForm.reset(_objectSpread({}, jobDetail));\n    setTab(0);\n    dispatch(jobStore.actions.setTransferListUserGroup([]));\n  }, [jobDetail]);\n\n  var onCloseCreateEditDialog = function onCloseCreateEditDialog() {\n    jobForm.clearErrors();\n    dispatch(jobStore.sagaCloseDialog());\n  };\n\n  var onSubmitJobData = jobForm.handleSubmit(function (data) {\n    var payload = _.omit(data, [].concat(_toConsumableArray(constant.removalProperties), ['category', 'malis_version']));\n\n    payload.job_expediting_dates = payload.job_expediting_dates.map(function (exDate) {\n      if (_.isString(exDate.id)) {\n        return _.omit(exDate, 'id');\n      }\n\n      return exDate;\n    });\n    payload.job_currencies = payload.job_currencies.map(function (currency) {\n      return {\n        currency_id: currency.id,\n        rate: Number(currency.rate)\n      };\n    });\n    payload.job_standard = payload.job_standard.map(function (job) {\n      return _.omit(job, 'status');\n    });\n    var formData = new FormData();\n    formData.append('job_info', JSON.stringify(_.omit(payload, 'logo')));\n\n    if (payload.logo) {\n      formData.append('logo', payload.logo);\n    }\n\n    if (isCreating) {\n      dispatch(jobStore.sagaCreate(formData));\n    } else {\n      dispatch(jobStore.sagaUpdate({\n        id: data.id,\n        formData: formData\n      }));\n    }\n  });\n\n  var onChangeTab = function onChangeTab(_, nextTab) {\n    setTab(nextTab);\n  };\n\n  var handleChangeHistoryLogs = function handleChangeHistoryLogs(data) {\n    dispatch(jobStore.actions.setHistoryLogs(data));\n  };\n\n  var generalTab = {\n    label: t('common:tab.general'),\n    panel: /*#__PURE__*/_jsx(TabGeneral, {}),\n    errorKey: ['job_id', 'language', 'equipment_type', 'erection_site', 'people_responsible', 'squad_leader', 'job_users']\n  };\n  var additionalInfoTab = {\n    label: t('form.tab.additional_info'),\n    panel: /*#__PURE__*/_jsx(TabAdditionalInfo, {})\n  };\n  var otherTab = {\n    label: t('common:tab.others'),\n    panel: /*#__PURE__*/_jsx(TabOthers, {}),\n    errorKey: ['contract_no', 'contract_desc', 'credit_letter', 'logo']\n  };\n  var historyTab = {\n    label: t('common:tab.history'),\n    disabled: isCreating,\n    panel: /*#__PURE__*/_jsx(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: jobDetail.id,\n      mode: \"horizonatal\",\n      tableHeight: 390,\n      descriptionRows: 25,\n      entity: \"job\"\n    })\n  };\n  var tabs = [generalTab, additionalInfoTab, otherTab, historyTab];\n  return /*#__PURE__*/_jsx(DialogMain, {\n    open: dialogState.open,\n    loading: dialogState.loading,\n    fullWidth: true,\n    maxWidth: \"md\",\n    title: /*#__PURE__*/_jsx(BtnHelp, {\n      title: isCreating ? t('form.title.create_job') : t('form.title.update_job'),\n      href: wiki_page\n    }),\n    onOk: onSubmitJobData,\n    onClose: onCloseCreateEditDialog,\n    height: 470,\n    okButtonProps: {\n      disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating\n    },\n    okText: isCreating ? t('common:button.create') : t('common:button.update'),\n    children: /*#__PURE__*/_jsx(Context.Provider, {\n      value: {\n        isCreating: isCreating\n      },\n      children: /*#__PURE__*/_jsx(FormControllerTabs, {\n        value: tab,\n        onChange: onChangeTab,\n        form: jobForm,\n        tabs: tabs\n      })\n    })\n  });\n}\n\nexport default DialogJobCreateEdit;","map":null,"metadata":{},"sourceType":"module"}