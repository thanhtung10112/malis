{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport useStyles from '@/styles/page/layout';\nimport { Link } from '@material-ui/core';\nimport { AppLayout, MakeAListIcon, EditIcon, DeleteIcon, CreateIcon, SaveIcon, AppAutocompleteStyled, useConfirm, AppAutocompleteStyledAsync, DataTableCellExpand, DataTableNumberField, DialogPart } from '@/components';\nimport { itemStore, commonStore, partStore } from '@/store/reducers';\nimport * as columnProperties from '@/utils/columnProperties';\nimport AppNumber from '@/helper/AppNumber';\nimport { itemMassFormat } from '@/utils/constant';\nimport * as yup from 'yup';\nimport clsx from 'clsx';\nimport immer from 'immer';\nimport _ from 'lodash';\nimport { unsaveDialogOptions } from '@/utils/constant';\nimport getMessageConfirm from '@/utils/getMessageConfirm';\nimport { isAssemblyByDpn } from '@/utils/isAssembly';\n\nfunction ItemsPage() {\n  var classes = useStyles();\n\n  var _useConfirm = useConfirm(),\n      confirm = _useConfirm.confirm;\n\n  var _useTranslation = useTranslation('item'),\n      t = _useTranslation.t;\n\n  var breadcrumbData = [{\n    label: 'Home',\n    href: '/'\n  }, {\n    label: 'Drawings',\n    href: '/drawings'\n  }, {\n    label: 'Items Management',\n    href: '/items'\n  }];\n  var dispatch = useDispatch();\n  var permissions = useSelector(itemStore.selectPermissions);\n  var userDrawing = useSelector(commonStore.selectUserValueDrawing);\n  var userJob = useSelector(commonStore.selectUserValueJob);\n  var editRows = useSelector(commonStore.selectEditRows);\n  var selectedRows = useSelector(commonStore.selectSelectedRows);\n  var currentLang = useSelector(commonStore.selectCurrentLanguage);\n  var dataList = useSelector(itemStore.selectDataList);\n\n  var _useSelector = useSelector(itemStore.selectInitDataForList),\n      jobOptions = _useSelector.jobs,\n      column_tooltips = _useSelector.column_tooltips,\n      wiki_page = _useSelector.wiki_page;\n\n  useEffect(function () {\n    return function () {\n      return dispatch(commonStore.actions.resetUserValue());\n    };\n  }, []);\n  /**\n   * @param {DataForDropdown} option\n   */\n\n  var handleChangeUserDrawing = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event, optionValue) {\n      var result;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              result = '';\n\n              if (!(editRows.length > 0)) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 4;\n              return confirm(unsaveDialogOptions);\n\n            case 4:\n              result = _context.sent;\n\n            case 5:\n              if (result !== 'cancel') {\n                dispatch(itemStore.sagaChangeUserDrawing({\n                  optionValue: optionValue,\n                  confirm: result\n                }));\n              }\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleChangeUserDrawing(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleOpenCreateDialog = function handleOpenCreateDialog() {\n    dispatch(partStore.sagaOpenCreateDialog('item'));\n  };\n\n  var handleChangeUserJob = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event, optionValue) {\n      var result;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              result = '';\n\n              if (!(editRows.length > 0)) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 4;\n              return confirm(unsaveDialogOptions);\n\n            case 4:\n              result = _context2.sent;\n\n            case 5:\n              if (result !== 'cancel') {\n                dispatch(itemStore.sagaChangeUserJob({\n                  optionValue: optionValue,\n                  confirm: result\n                }));\n              }\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleChangeUserJob(_x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleDeleteItems = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var description, result, parts;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              description = getMessageConfirm(t, 'item', selectedRows, 'delete');\n              _context3.next = 3;\n              return confirm({\n                description: description\n              });\n\n            case 3:\n              result = _context3.sent;\n\n              if (result === 'OK') {\n                parts = _.map(selectedRows, function (partId) {\n                  var _$find = _.find(dataList, {\n                    id: partId\n                  }),\n                      dpn = _$find.dpn,\n                      id = _$find.id;\n\n                  return {\n                    entity_id: dpn,\n                    id: id\n                  };\n                });\n                dispatch(itemStore.sagaRemove(parts));\n              }\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleDeleteItems() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleOpenUpdateDialog = function handleOpenUpdateDialog(id) {\n    return function () {\n      dispatch(partStore.sagaOpenUpdateDialog({\n        id: id,\n        entity: 'item'\n      }));\n    };\n  };\n\n  var onChangeMass = function onChangeMass(item_id_pk, value, field) {\n    var newEditRows = immer(editRows, function (draft) {\n      var findIndex = _.findIndex(draft, {\n        item_id_pk: item_id_pk\n      });\n\n      var valueFormat = AppNumber.convertToNumber(value, itemMassFormat);\n\n      if (findIndex > -1) {\n        draft[findIndex][field] = valueFormat;\n      } else {\n        draft.push(_defineProperty({\n          item_id_pk: item_id_pk\n        }, field, valueFormat));\n      }\n    });\n    dispatch(commonStore.actions.setEditRows(newEditRows));\n  };\n\n  var onSaveUpdateData = function onSaveUpdateData() {\n    dispatch(commonStore.sagaUpdateMultiple({\n      entity: 'item'\n    }));\n  };\n\n  var handleOpenPartDialog = function handleOpenPartDialog(id, dpn) {\n    return function (event) {\n      event.preventDefault();\n      var entity = isAssemblyByDpn(dpn) ? 'assembly' : 'item';\n      dispatch(partStore.sagaOpenUpdateDialog({\n        id: id,\n        entity: entity\n      }));\n    };\n  };\n\n  var columns = [_objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.iconColumn), {}, {\n    description: column_tooltips.edit,\n    field: 'id',\n    headerName: 'Edit',\n    renderCell: function renderCell(params) {\n      return /*#__PURE__*/_jsx(EditIcon, {\n        onClick: handleOpenUpdateDialog(params.value)\n      });\n    }\n  }), _objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n    description: column_tooltips.dpn,\n    field: 'dpn',\n    headerName: 'Item #',\n    flex: 0.25\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.descriptionsColumn(currentLang)), {}, {\n    description: column_tooltips.descriptions,\n    flex: 0.3\n  }), _objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n    description: column_tooltips.material_equiv,\n    field: 'material_equiv',\n    headerName: 'Material std',\n    flex: 0.2\n  }), _objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n    description: column_tooltips.manufacturer_equiv,\n    field: 'manufacturer_equiv',\n    headerName: 'Manufacturing std',\n    flex: 0.2\n  }), _objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n    description: column_tooltips.reference_dpn,\n    field: 'reference_dpn',\n    headerName: 'Part number',\n    flex: 0.25,\n    renderCell: function renderCell(params) {\n      var value = params.value,\n          row = params.row;\n      return /*#__PURE__*/_jsx(Link, {\n        href: \"#\",\n        onClick: handleOpenPartDialog(row.id_ref, value),\n        children: value\n      });\n    }\n  }), _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.rightColumn), columnProperties.editCell('Mass (kg)', permissions === null || permissions === void 0 ? void 0 : permissions.edit, column_tooltips.mass)), {}, {\n    field: 'mass',\n    renderCell: function renderCell(params) {\n      var value = AppNumber.format(params.value, itemMassFormat);\n      return /*#__PURE__*/_jsx(DataTableCellExpand, {\n        value: value,\n        width: params.colDef.width\n      });\n    },\n    cellClassName: function cellClassName(params) {\n      return clsx(_defineProperty({}, classes.mark, editRows.some(function (row) {\n        return row.item_id_pk === params.id && typeof row.mass !== 'undefined';\n      })));\n    },\n    renderEditCell: function renderEditCell(params) {\n      return /*#__PURE__*/_jsx(DataTableNumberField, {\n        params: params,\n        onChangeValue: onChangeMass,\n        decimalScale: itemMassFormat.precision,\n        fixedDecimalScale: itemMassFormat.precision,\n        rules: yup.number().nullable().required(t('validation_message.mass_required')).min(itemMassFormat.min, t('validation_message.mass_range')).max(itemMassFormat.max, t('validation_message.mass_range'))\n      });\n    }\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.centerColumn), {}, {\n    description: column_tooltips.raw_unit,\n    field: 'raw_unit',\n    headerName: 'Unit'\n  })];\n  var buttons = [{\n    label: t('common:button.new'),\n    startIcon: /*#__PURE__*/_jsx(CreateIcon, {}),\n    onClick: handleOpenCreateDialog,\n    disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.create) || userJob.value < 0 || !(userJob === null || userJob === void 0 ? void 0 : userJob.value)\n  }, {\n    label: t('common:button.save'),\n    startIcon: /*#__PURE__*/_jsx(SaveIcon, {}),\n    onClick: onSaveUpdateData,\n    disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) || editRows.length === 0\n  }, {\n    label: t('common:button.delete'),\n    startIcon: /*#__PURE__*/_jsx(DeleteIcon, {}),\n    onClick: handleDeleteItems,\n    disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions[\"delete\"]) || selectedRows.length === 0 || userJob.value < 0\n  }, {\n    label: t('common:button.make_a_list'),\n    startIcon: /*#__PURE__*/_jsx(MakeAListIcon, {}),\n    disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.make_a_list)\n  }];\n\n  var Dialogs = /*#__PURE__*/_jsx(DialogPart, {});\n\n  var Options = /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(AppAutocompleteStyled, {\n      className: classes.controlAutocomplete,\n      width: 200,\n      label: \"Jobs\",\n      options: jobOptions,\n      value: userJob,\n      renderOption: function renderOption(option) {\n        return option.description;\n      },\n      primaryKeyOption: \"value\",\n      onChange: handleChangeUserJob\n    }), /*#__PURE__*/_jsx(AppAutocompleteStyledAsync, {\n      disabled: !(userJob === null || userJob === void 0 ? void 0 : userJob.value),\n      width: 250,\n      label: \"Drawings\",\n      className: classes.controlAutocomplete,\n      compName: \"drawing_list\",\n      additionalData: {\n        limit_to_job: userJob.value,\n        include_all_drawings_option: true\n      },\n      onChange: handleChangeUserDrawing,\n      value: userDrawing,\n      defaultOptions: [commonStore.initialState.userValue.drawing]\n    })]\n  });\n\n  return /*#__PURE__*/_jsx(AppLayout, {\n    entity: \"item\",\n    breadcrumbs: breadcrumbData,\n    wikiPage: wiki_page,\n    searchProps: {\n      width: 300\n    },\n    buttons: buttons,\n    Options: Options,\n    permissions: permissions,\n    Dialogs: Dialogs,\n    tableProps: {\n      columns: columns,\n      isCellEditable: function isCellEditable(params) {\n        return !params.row.reference_dpn;\n      }\n    }\n  });\n}\n\nexport var __N_SSP = true;\nexport default ItemsPage;","map":null,"metadata":{},"sourceType":"module"}