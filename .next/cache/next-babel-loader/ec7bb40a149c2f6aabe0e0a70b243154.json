{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useMemo, useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useForm } from 'react-hook-form';\nimport { useTranslation } from 'next-i18next';\nimport { DialogMain, TableExtendedProperties, AppTabHistoryLog, FormControllerTabs, BtnHelp } from '@/components';\nimport TabGeneral from './TabGeneral';\nimport TabDetail from './TabDetail';\nimport TabParts from './TabParts';\nimport TabTags from './TabTags';\nimport TabSynchronization from './TabSynchronization';\nimport TabJobNotice from './TabJobNotice';\nimport TabParent from './TabParent';\nimport DialogRevision from './DialogRevision';\nimport _ from 'lodash';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport { drawingStore, commonStore } from '@/store/reducers';\nimport getValidationSchema from './validationSchema';\nimport { defaultProperties } from '@/utils/columnProperties';\n\nfunction DialogDrawingCreateEdit() {\n  const {\n    t\n  } = useTranslation('drawing');\n  const validationSchema = useMemo(() => getValidationSchema(t), []);\n  const dispatch = useDispatch();\n  const dialogState = useSelector(drawingStore.selectDialogState);\n  const drawingDetail = useSelector(drawingStore.selectDetail);\n  const userJob = useSelector(commonStore.selectUserValueJob);\n  const {\n    parameters,\n    wiki_page\n  } = useSelector(drawingStore.selectInitDataForCE);\n  const permissions = useSelector(drawingStore.selectPermissions);\n\n  const isCreating = _.isNil(drawingDetail.id);\n\n  const drawingForm = useForm({\n    shouldUnregister: false,\n    resolver: yupResolver(validationSchema)\n  });\n  useEffect(() => {\n    drawingForm.reset(drawingDetail);\n  }, [drawingDetail]);\n\n  const onChangeTab = (event, nextTab) => {\n    dispatch(drawingStore.actions.setDialogStateTab(nextTab));\n  };\n\n  const onSubmitData = drawingForm.handleSubmit(data => {\n    data.job_id = userJob.value;\n    data.associated_documents = data.associated_documents.map(({\n      value\n    }) => parseInt(value));\n\n    const drawing = _.pick(data, ['additional_attributes', 'associated_documents', 'customer_id', 'descriptions', 'drawing_format', 'drawing_purpose', 'exclude_from_customer', 'exclude_from_other', 'exclude_from_supplier', 'file_prefix', 'file_type', 'job_id', 'revision', 'drawing_id', 'is_detail_drawing', 'is_drawing', 'is_other_document', 'is_schematic', 'is_specification']);\n\n    if (isCreating) {\n      dispatch(drawingStore.sagaCreate(drawing));\n    } else {\n      const payloadUpdate = _.omit(drawing, ['drawing_id', 'revison']);\n\n      dispatch(drawingStore.sagaUpdate({\n        id: data.id,\n        drawing: payloadUpdate\n      }));\n    }\n  });\n\n  const handleClose = () => {\n    dispatch(drawingStore.sagaCloseDialog());\n  };\n\n  const handleOpenRevisionDialog = () => {\n    dispatch(drawingStore.sagaOpenRevDialog(drawingDetail.revision));\n  };\n\n  const handleChangeHistoryLogs = data => {\n    dispatch(drawingStore.actions.setHistoryLogs(data));\n  };\n\n  const extraButtons = [{\n    label: t('button.save_as_revision'),\n    hide: isCreating,\n    disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating,\n    onClick: handleOpenRevisionDialog\n  }, {\n    label: isCreating ? t('common:button.create') : t('common:button.update'),\n    disabled: dialogState.loading || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit) && !isCreating,\n    onClick: onSubmitData\n  }, {\n    label: t('common:button.close'),\n    onClick: handleClose\n  }];\n  const generalTab = {\n    label: t('common:tab.general'),\n    panel: /*#__PURE__*/_jsx(TabGeneral, {}),\n    errorKey: ['drawing_id', 'customer_id', 'revision', 'drawing_format', 'drawing_purpose']\n  };\n  const detailTab = {\n    label: t('form.tab.detail'),\n    panel: /*#__PURE__*/_jsx(TabDetail, {})\n  };\n  const partsTab = {\n    label: t('form.tab.parts'),\n    panel: /*#__PURE__*/_jsx(TabParts, {}),\n    hide: isCreating\n  };\n  const tagsTab = {\n    label: t('form.tab.tags'),\n    panel: /*#__PURE__*/_jsx(TabTags, {}),\n    hide: isCreating\n  };\n  const syncTab = {\n    label: t('form.tab.synchronization'),\n    panel: /*#__PURE__*/_jsx(TabSynchronization, {}),\n    hide: isCreating,\n    disabled: true\n  };\n  const jobNoticeTab = {\n    label: t('form.tab.job_notices'),\n    panel: /*#__PURE__*/_jsx(TabJobNotice, {}),\n    hide: isCreating,\n    disabled: true\n  };\n  const parentTab = {\n    label: t('form.tab.parents'),\n    panel: /*#__PURE__*/_jsx(TabParent, {}),\n    hide: isCreating,\n    disabled: true\n  };\n  const historyTab = {\n    label: t('common:tab.history'),\n    panel: /*#__PURE__*/_jsx(AppTabHistoryLog, {\n      isOpenDialog: dialogState.open,\n      data: dialogState.historyLogs,\n      onChange: handleChangeHistoryLogs,\n      entityId: drawingDetail.id,\n      mode: \"horizonatal\",\n      tableHeight: 430,\n      descriptionRows: 26,\n      entity: \"drawing\",\n      extraColumns: [_objectSpread(_objectSpread({}, defaultProperties), {}, {\n        field: 'revision',\n        headerName: 'Revision',\n        width: 100\n      })]\n    }),\n    hide: isCreating\n  };\n  const extendedPropertyTab = {\n    label: t('common:tab.extended_properties'),\n    panel: /*#__PURE__*/_jsx(TableExtendedProperties, {\n      control: drawingForm.control,\n      name: \"additional_attributes\",\n      editMode: !isCreating,\n      propertiesList: parameters.PLAT,\n      tableHeight: 435,\n      parameterName: \"PLAT\"\n    })\n  };\n  const tabs = [generalTab, detailTab, partsTab, tagsTab, syncTab, jobNoticeTab, parentTab, historyTab, extendedPropertyTab];\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(DialogMain, {\n      open: dialogState.open,\n      loading: dialogState.loading,\n      title: /*#__PURE__*/_jsx(BtnHelp, {\n        title: isCreating ? t('form.title.create_drawing') : t('form.title.update_drawing'),\n        href: wiki_page\n      }),\n      fullWidth: true,\n      maxWidth: \"lg\",\n      extraButtons: extraButtons,\n      height: 510,\n      onClose: handleClose,\n      children: /*#__PURE__*/_jsx(FormControllerTabs, {\n        value: dialogState.tab,\n        onChange: onChangeTab,\n        form: drawingForm,\n        tabs: tabs\n      })\n    }), /*#__PURE__*/_jsx(DialogRevision, {})]\n  });\n}\n\nexport default DialogDrawingCreateEdit;","map":null,"metadata":{},"sourceType":"module"}