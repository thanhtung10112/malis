{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(login),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(getProfile),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(changePassword),\n    _marked4 = /*#__PURE__*/_regeneratorRuntime.mark(fetchSettingInitData),\n    _marked5 = /*#__PURE__*/_regeneratorRuntime.mark(fetchSettings),\n    _marked6 = /*#__PURE__*/_regeneratorRuntime.mark(getSettings),\n    _marked7 = /*#__PURE__*/_regeneratorRuntime.mark(saveSettingsSaga),\n    _marked8 = /*#__PURE__*/_regeneratorRuntime.mark(logout),\n    _marked9 = /*#__PURE__*/_regeneratorRuntime.mark(authSaga);\n\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { call, all, select } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { setCookie } from 'nookies';\nimport { authStore, commonStore } from '@/store/reducers';\nimport authApi from '@/apis/auth.api';\nexport function login(_ref) {\n  var payload, remember, loginData, data, message;\n  return _regeneratorRuntime.wrap(function login$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          payload = _ref.payload;\n          _context.next = 3;\n          return put(authStore.actions.setLoading(true));\n\n        case 3:\n          _context.prev = 3;\n          remember = payload.remember, loginData = _objectWithoutProperties(payload, [\"remember\"]);\n          _context.next = 7;\n          return call(authApi.login, loginData);\n\n        case 7:\n          data = _context.sent;\n          _context.next = 10;\n          return put(authStore.actions.saveTokenLogin({\n            access_token: data.access_token,\n            redirect_to: data.redirect_to,\n            remember: remember\n          }));\n\n        case 10:\n          _context.next = 17;\n          break;\n\n        case 12:\n          _context.prev = 12;\n          _context.t0 = _context[\"catch\"](3);\n          message = _context.t0.message;\n          _context.next = 17;\n          return put(commonStore.actions.setErrorMessage(message));\n\n        case 17:\n          _context.next = 19;\n          return put(authStore.actions.setLoading(false));\n\n        case 19:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[3, 12]]);\n}\nexport function getProfile() {\n  var data;\n  return _regeneratorRuntime.wrap(function getProfile$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return put(authStore.actions.setLoadingAuth(true));\n\n        case 2:\n          _context2.prev = 2;\n          _context2.next = 5;\n          return call(authApi.getProfile);\n\n        case 5:\n          data = _context2.sent;\n          _context2.next = 8;\n          return put(authStore.actions.setProfile(data));\n\n        case 8:\n          _context2.next = 14;\n          break;\n\n        case 10:\n          _context2.prev = 10;\n          _context2.t0 = _context2[\"catch\"](2);\n          _context2.next = 14;\n          return put(commonStore.actions.setError(_context2.t0));\n\n        case 14:\n          _context2.next = 16;\n          return put(authStore.actions.setLoadingAuth(false));\n\n        case 16:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[2, 10]]);\n}\nexport function changePassword(_ref2) {\n  var payload, _yield$call, message;\n\n  return _regeneratorRuntime.wrap(function changePassword$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          payload = _ref2.payload;\n          _context3.next = 3;\n          return put(authStore.actions.setPwDialogState({\n            loading: true\n          }));\n\n        case 3:\n          _context3.prev = 3;\n          _context3.next = 6;\n          return call(authApi.changePassword, payload);\n\n        case 6:\n          _yield$call = _context3.sent;\n          message = _yield$call.message;\n          _context3.next = 10;\n          return all([put(commonStore.actions.setSuccessMessage(message)), put(authStore.actions.setPwDialogState({\n            open: false\n          }))]);\n\n        case 10:\n          _context3.next = 16;\n          break;\n\n        case 12:\n          _context3.prev = 12;\n          _context3.t0 = _context3[\"catch\"](3);\n          _context3.next = 16;\n          return put(commonStore.actions.setError(_context3.t0));\n\n        case 16:\n          _context3.next = 18;\n          return put(authStore.actions.setPwDialogState({\n            loading: false\n          }));\n\n        case 18:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[3, 12]]);\n}\nexport function fetchSettingInitData() {\n  var data;\n  return _regeneratorRuntime.wrap(function fetchSettingInitData$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return call(authApi.getInitDataForSetting);\n\n        case 2:\n          data = _context4.sent;\n          _context4.next = 5;\n          return put(authStore.actions.setSettingInitData(data));\n\n        case 5:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}\nexport function fetchSettings() {\n  var _yield$call2, message, success, detail;\n\n  return _regeneratorRuntime.wrap(function fetchSettings$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.next = 2;\n          return call(authApi.getSettings);\n\n        case 2:\n          _yield$call2 = _context5.sent;\n          message = _yield$call2.message;\n          success = _yield$call2.success;\n          detail = _objectWithoutProperties(_yield$call2, [\"message\", \"success\"]);\n          _context5.next = 8;\n          return put(authStore.actions.setSettingDetail(detail));\n\n        case 8:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _marked5);\n}\nexport function getSettings() {\n  return _regeneratorRuntime.wrap(function getSettings$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.next = 2;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 2:\n          _context6.prev = 2;\n          _context6.next = 5;\n          return call(fetchSettingInitData);\n\n        case 5:\n          _context6.next = 7;\n          return call(fetchSettings);\n\n        case 7:\n          _context6.next = 13;\n          break;\n\n        case 9:\n          _context6.prev = 9;\n          _context6.t0 = _context6[\"catch\"](2);\n          _context6.next = 13;\n          return put(commonStore.actions.setError(_context6.t0));\n\n        case 13:\n          _context6.next = 15;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 15:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _marked6, null, [[2, 9]]);\n}\n\nfunction getPathHomePage(options, homePageId) {\n  var _homePage$properties;\n\n  var homePage = _.find(options, {\n    value: homePageId\n  });\n\n  return (homePage === null || homePage === void 0 ? void 0 : (_homePage$properties = homePage.properties) === null || _homePage$properties === void 0 ? void 0 : _homePage$properties.path) || '';\n}\n\nexport function saveSettingsSaga(_ref3) {\n  var payload, _yield$call3, message, parameters, homePagePath;\n\n  return _regeneratorRuntime.wrap(function saveSettingsSaga$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          payload = _ref3.payload;\n          _context7.next = 3;\n          return put(commonStore.actions.setLoadingPage(true));\n\n        case 3:\n          _context7.prev = 3;\n          _context7.next = 6;\n          return call(authApi.saveSettings, payload);\n\n        case 6:\n          _yield$call3 = _context7.sent;\n          message = _yield$call3.message;\n          return _context7.delegateYield(select(authStore.selectSettingsParameters), \"t0\", 9);\n\n        case 9:\n          parameters = _context7.t0;\n          homePagePath = getPathHomePage(parameters.PAGES, payload.home_page);\n\n          if (homePagePath) {\n            setCookie(null, 'redirect_to', homePagePath, {\n              maxAge: 60 * 60 * 24 * 365 // 1 day\n\n            });\n          }\n\n          _context7.next = 14;\n          return put(authStore.actions.setDefaultLanguage(payload.default_language));\n\n        case 14:\n          _context7.next = 16;\n          return put(commonStore.actions.setSuccessMessage(message));\n\n        case 16:\n          _context7.next = 22;\n          break;\n\n        case 18:\n          _context7.prev = 18;\n          _context7.t1 = _context7[\"catch\"](3);\n          _context7.next = 22;\n          return put(commonStore.actions.setError(_context7.t1));\n\n        case 22:\n          _context7.next = 24;\n          return put(commonStore.actions.setLoadingPage(false));\n\n        case 24:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _marked7, null, [[3, 18]]);\n}\nexport function logout(_ref4) {\n  var payload, entity;\n  return _regeneratorRuntime.wrap(function logout$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          payload = _ref4.payload;\n          return _context8.delegateYield(select(commonStore.selectEntity), \"t0\", 2);\n\n        case 2:\n          entity = _context8.t0;\n\n          if (!((payload === null || payload === void 0 ? void 0 : payload.confirm) === 'save')) {\n            _context8.next = 8;\n            break;\n          }\n\n          _context8.next = 6;\n          return put(commonStore.sagaUpdateMultiple({\n            entity: entity,\n            action: authStore.actions.logout\n          }));\n\n        case 6:\n          _context8.next = 10;\n          break;\n\n        case 8:\n          _context8.next = 10;\n          return put(authStore.actions.logout());\n\n        case 10:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _marked8);\n}\n\nfunction authSaga() {\n  return _regeneratorRuntime.wrap(function authSaga$(_context9) {\n    while (1) {\n      switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 2;\n          return takeEvery(authStore.sagaLogin, login);\n\n        case 2:\n          _context9.next = 4;\n          return takeEvery(authStore.sagaGetProfile, getProfile);\n\n        case 4:\n          _context9.next = 6;\n          return takeEvery(authStore.sagaChangePassword, changePassword);\n\n        case 6:\n          _context9.next = 8;\n          return takeEvery(authStore.sagaGetSettings, getSettings);\n\n        case 8:\n          _context9.next = 10;\n          return takeEvery(authStore.sagaSaveSettings, saveSettingsSaga);\n\n        case 10:\n          _context9.next = 12;\n          return takeEvery(authStore.sagaLogout, logout);\n\n        case 12:\n        case \"end\":\n          return _context9.stop();\n      }\n    }\n  }, _marked9);\n}\n\nexport default authSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/auth.saga.ts"],"names":["login","getProfile","changePassword","fetchSettingInitData","fetchSettings","getSettings","saveSettingsSaga","logout","authSaga","put","takeEvery","call","all","select","_","setCookie","authStore","commonStore","authApi","payload","actions","setLoading","remember","loginData","data","saveTokenLogin","access_token","redirect_to","message","setErrorMessage","setLoadingAuth","setProfile","setError","setPwDialogState","loading","setSuccessMessage","open","getInitDataForSetting","setSettingInitData","success","detail","setSettingDetail","setLoadingPage","getPathHomePage","options","homePageId","homePage","find","value","properties","path","saveSettings","selectSettingsParameters","parameters","homePagePath","PAGES","home_page","maxAge","setDefaultLanguage","default_language","selectEntity","entity","confirm","sagaUpdateMultiple","action","sagaLogin","sagaGetProfile","sagaChangePassword","sagaGetSettings","sagaSaveSettings","sagaLogout"],"mappings":"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","sourcesContent":["import { put, takeEvery } from 'redux-saga/effects'\nimport { call, all, select } from 'typed-redux-saga'\n\nimport _ from 'lodash'\nimport { setCookie } from 'nookies'\nimport { authStore, commonStore } from '@/store/reducers'\n\nimport authApi from '@/apis/auth.api'\n\nimport type { ParameterOption } from '@/types/Common'\n\nexport function* login({ payload }: ReturnType<typeof authStore.sagaLogin>) {\n  yield put(authStore.actions.setLoading(true))\n  try {\n    const { remember, ...loginData } = payload\n    const data = yield call(authApi.login, loginData)\n    yield put(\n      authStore.actions.saveTokenLogin({\n        access_token: data.access_token,\n        redirect_to: data.redirect_to,\n        remember\n      })\n    )\n  } catch (error) {\n    const { message } = error\n    yield put(commonStore.actions.setErrorMessage(message))\n  }\n  yield put(authStore.actions.setLoading(false))\n}\n\nexport function* getProfile() {\n  yield put(authStore.actions.setLoadingAuth(true))\n  try {\n    const data = yield call(authApi.getProfile)\n    yield put(authStore.actions.setProfile(data))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(authStore.actions.setLoadingAuth(false))\n}\n\nexport function* changePassword({ payload }: ReturnType<typeof authStore.sagaChangePassword>) {\n  yield put(authStore.actions.setPwDialogState({ loading: true }))\n\n  try {\n    const { message } = yield call(authApi.changePassword, payload)\n    yield all([\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(authStore.actions.setPwDialogState({ open: false }))\n    ])\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n\n  yield put(authStore.actions.setPwDialogState({ loading: false }))\n}\n\nexport function* fetchSettingInitData() {\n  const data = yield call(authApi.getInitDataForSetting)\n  yield put(authStore.actions.setSettingInitData(data))\n}\n\nexport function* fetchSettings() {\n  const { message, success, ...detail } = yield call(authApi.getSettings)\n  yield put(authStore.actions.setSettingDetail(detail))\n}\n\nexport function* getSettings() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchSettingInitData)\n    yield call(fetchSettings)\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction getPathHomePage(options: ParameterOption[], homePageId: number) {\n  const homePage = _.find(options, { value: homePageId })\n  return homePage?.properties?.path || ''\n}\n\nexport function* saveSettingsSaga({ payload }: ReturnType<typeof authStore.sagaSaveSettings>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { message } = yield call(authApi.saveSettings, payload)\n    const parameters = yield* select(authStore.selectSettingsParameters)\n    const homePagePath = getPathHomePage(parameters.PAGES, payload.home_page)\n    if (homePagePath) {\n      setCookie(null, 'redirect_to', homePagePath, {\n        maxAge: 60 * 60 * 24 * 365 // 1 day\n      })\n    }\n    yield put(authStore.actions.setDefaultLanguage(payload.default_language))\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* logout({ payload }: ReturnType<typeof authStore.sagaLogout>) {\n  const entity = yield* select(commonStore.selectEntity)\n  if (payload?.confirm === 'save') {\n    yield put(\n      commonStore.sagaUpdateMultiple({\n        entity: entity,\n        action: authStore.actions.logout\n      })\n    )\n  } else {\n    yield put(authStore.actions.logout())\n  }\n}\n\nfunction* authSaga() {\n  yield takeEvery(authStore.sagaLogin, login)\n  yield takeEvery(authStore.sagaGetProfile, getProfile)\n  yield takeEvery(authStore.sagaChangePassword, changePassword)\n  yield takeEvery(authStore.sagaGetSettings, getSettings)\n  yield takeEvery(authStore.sagaSaveSettings, saveSettingsSaga)\n  yield takeEvery(authStore.sagaLogout, logout)\n}\n\nexport default authSaga\n"]},"metadata":{},"sourceType":"module"}