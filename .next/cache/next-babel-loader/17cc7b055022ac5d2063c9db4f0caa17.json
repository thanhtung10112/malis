{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { put, takeEvery } from 'redux-saga/effects';\nimport { call, all, select } from 'typed-redux-saga';\nimport _ from 'lodash';\nimport { setCookie } from 'nookies';\nimport { authStore, commonStore } from '@/store/reducers';\nimport authApi from '@/apis/auth.api';\nexport function* login({\n  payload\n}) {\n  yield put(authStore.actions.setLoading(true));\n\n  try {\n    const {\n      remember\n    } = payload,\n          loginData = _objectWithoutProperties(payload, [\"remember\"]);\n\n    const data = yield call(authApi.login, loginData);\n    yield put(authStore.actions.saveTokenLogin({\n      access_token: data.access_token,\n      redirect_to: data.redirect_to,\n      remember\n    }));\n  } catch (error) {\n    const {\n      message\n    } = error;\n    yield put(commonStore.actions.setErrorMessage(message));\n  }\n\n  yield put(authStore.actions.setLoading(false));\n}\nexport function* getProfile() {\n  yield put(authStore.actions.setLoadingAuth(true));\n\n  try {\n    const data = yield call(authApi.getProfile);\n    yield put(authStore.actions.setProfile(data));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(authStore.actions.setLoadingAuth(false));\n}\nexport function* changePassword({\n  payload\n}) {\n  yield put(authStore.actions.setPwDialogState({\n    loading: true\n  }));\n\n  try {\n    const {\n      message\n    } = yield call(authApi.changePassword, payload);\n    yield all([put(commonStore.actions.setSuccessMessage(message)), put(authStore.actions.setPwDialogState({\n      open: false\n    }))]);\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(authStore.actions.setPwDialogState({\n    loading: false\n  }));\n}\nexport function* fetchSettingInitData() {\n  const data = yield call(authApi.getInitDataForSetting);\n  yield put(authStore.actions.setSettingInitData(data));\n}\nexport function* fetchSettings() {\n  const _yield$call = yield call(authApi.getSettings),\n        {\n    message,\n    success\n  } = _yield$call,\n        detail = _objectWithoutProperties(_yield$call, [\"message\", \"success\"]);\n\n  yield put(authStore.actions.setSettingDetail(detail));\n}\nexport function* getSettings() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchSettingInitData);\n    yield call(fetchSettings);\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction getPathHomePage(options, homePageId) {\n  var _homePage$properties;\n\n  const homePage = _.find(options, {\n    value: homePageId\n  });\n\n  return (homePage === null || homePage === void 0 ? void 0 : (_homePage$properties = homePage.properties) === null || _homePage$properties === void 0 ? void 0 : _homePage$properties.path) || '';\n}\n\nexport function* saveSettingsSaga({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const {\n      message\n    } = yield call(authApi.saveSettings, payload);\n    const parameters = yield* select(authStore.selectSettingsParameters);\n    const homePagePath = getPathHomePage(parameters.PAGES, payload.home_page);\n\n    if (homePagePath) {\n      setCookie(null, 'redirect_to', homePagePath, {\n        maxAge: 60 * 60 * 24 * 365 // 1 day\n\n      });\n    }\n\n    yield put(authStore.actions.setDefaultLanguage(payload.default_language));\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\nexport function* logout({\n  payload\n}) {\n  const entity = yield* select(commonStore.selectEntity);\n\n  if ((payload === null || payload === void 0 ? void 0 : payload.confirm) === 'save') {\n    yield put(commonStore.sagaUpdateMultiple({\n      entity: entity,\n      action: authStore.actions.logout\n    }));\n  } else {\n    yield put(authStore.actions.logout());\n  }\n}\n\nfunction* authSaga() {\n  yield takeEvery(authStore.sagaLogin, login);\n  yield takeEvery(authStore.sagaGetProfile, getProfile);\n  yield takeEvery(authStore.sagaChangePassword, changePassword);\n  yield takeEvery(authStore.sagaGetSettings, getSettings);\n  yield takeEvery(authStore.sagaSaveSettings, saveSettingsSaga);\n  yield takeEvery(authStore.sagaLogout, logout);\n}\n\nexport default authSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/auth.saga.ts"],"names":["put","takeEvery","call","all","select","_","setCookie","authStore","commonStore","authApi","login","payload","actions","setLoading","remember","loginData","data","saveTokenLogin","access_token","redirect_to","error","message","setErrorMessage","getProfile","setLoadingAuth","setProfile","setError","changePassword","setPwDialogState","loading","setSuccessMessage","open","fetchSettingInitData","getInitDataForSetting","setSettingInitData","fetchSettings","getSettings","success","detail","setSettingDetail","setLoadingPage","getPathHomePage","options","homePageId","homePage","find","value","properties","path","saveSettingsSaga","saveSettings","parameters","selectSettingsParameters","homePagePath","PAGES","home_page","maxAge","setDefaultLanguage","default_language","logout","entity","selectEntity","confirm","sagaUpdateMultiple","action","authSaga","sagaLogin","sagaGetProfile","sagaChangePassword","sagaGetSettings","sagaSaveSettings","sagaLogout"],"mappings":"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","sourcesContent":["import { put, takeEvery } from 'redux-saga/effects'\nimport { call, all, select } from 'typed-redux-saga'\n\nimport _ from 'lodash'\nimport { setCookie } from 'nookies'\nimport { authStore, commonStore } from '@/store/reducers'\n\nimport authApi from '@/apis/auth.api'\n\nimport type { ParameterOption } from '@/types/Common'\n\nexport function* login({ payload }: ReturnType<typeof authStore.sagaLogin>) {\n  yield put(authStore.actions.setLoading(true))\n  try {\n    const { remember, ...loginData } = payload\n    const data = yield call(authApi.login, loginData)\n    yield put(\n      authStore.actions.saveTokenLogin({\n        access_token: data.access_token,\n        redirect_to: data.redirect_to,\n        remember\n      })\n    )\n  } catch (error) {\n    const { message } = error\n    yield put(commonStore.actions.setErrorMessage(message))\n  }\n  yield put(authStore.actions.setLoading(false))\n}\n\nexport function* getProfile() {\n  yield put(authStore.actions.setLoadingAuth(true))\n  try {\n    const data = yield call(authApi.getProfile)\n    yield put(authStore.actions.setProfile(data))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(authStore.actions.setLoadingAuth(false))\n}\n\nexport function* changePassword({ payload }: ReturnType<typeof authStore.sagaChangePassword>) {\n  yield put(authStore.actions.setPwDialogState({ loading: true }))\n\n  try {\n    const { message } = yield call(authApi.changePassword, payload)\n    yield all([\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(authStore.actions.setPwDialogState({ open: false }))\n    ])\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n\n  yield put(authStore.actions.setPwDialogState({ loading: false }))\n}\n\nexport function* fetchSettingInitData() {\n  const data = yield call(authApi.getInitDataForSetting)\n  yield put(authStore.actions.setSettingInitData(data))\n}\n\nexport function* fetchSettings() {\n  const { message, success, ...detail } = yield call(authApi.getSettings)\n  yield put(authStore.actions.setSettingDetail(detail))\n}\n\nexport function* getSettings() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchSettingInitData)\n    yield call(fetchSettings)\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction getPathHomePage(options: ParameterOption[], homePageId: number) {\n  const homePage = _.find(options, { value: homePageId })\n  return homePage?.properties?.path || ''\n}\n\nexport function* saveSettingsSaga({ payload }: ReturnType<typeof authStore.sagaSaveSettings>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { message } = yield call(authApi.saveSettings, payload)\n    const parameters = yield* select(authStore.selectSettingsParameters)\n    const homePagePath = getPathHomePage(parameters.PAGES, payload.home_page)\n    if (homePagePath) {\n      setCookie(null, 'redirect_to', homePagePath, {\n        maxAge: 60 * 60 * 24 * 365 // 1 day\n      })\n    }\n    yield put(authStore.actions.setDefaultLanguage(payload.default_language))\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* logout({ payload }: ReturnType<typeof authStore.sagaLogout>) {\n  const entity = yield* select(commonStore.selectEntity)\n  if (payload?.confirm === 'save') {\n    yield put(\n      commonStore.sagaUpdateMultiple({\n        entity: entity,\n        action: authStore.actions.logout\n      })\n    )\n  } else {\n    yield put(authStore.actions.logout())\n  }\n}\n\nfunction* authSaga() {\n  yield takeEvery(authStore.sagaLogin, login)\n  yield takeEvery(authStore.sagaGetProfile, getProfile)\n  yield takeEvery(authStore.sagaChangePassword, changePassword)\n  yield takeEvery(authStore.sagaGetSettings, getSettings)\n  yield takeEvery(authStore.sagaSaveSettings, saveSettingsSaga)\n  yield takeEvery(authStore.sagaLogout, logout)\n}\n\nexport default authSaga\n"]},"metadata":{},"sourceType":"module"}