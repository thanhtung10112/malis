{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useMemo, useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { useTranslation } from 'next-i18next';\nimport { useForm } from 'react-hook-form';\nimport _ from 'lodash';\nimport { Button, Tab, Tabs, Checkbox, TextField, FormControlLabel, Typography, Grid, Tooltip } from '@material-ui/core';\nimport { FileCopy as FileCopyIcon, Edit as EditIcon, Save as SaveIcon, Delete as DeleteIcon, FilterList as FilterIcon, Close as CloseIcon } from '@material-ui/icons';\nimport { MalisPanel, DialogMain, useConfirm, confirmConstant, FormControllerTextField } from '@/components/index';\nimport { When, Unless } from 'react-if';\nimport ConditionTree from './ConditionTree';\nimport SortConditionList from './SortConditionList';\nimport useStyles from './styles';\nimport { authStore, advancedFilterActions, commonStore } from '@/store/reducers';\nexport const conjunctions = [{\n  description: 'AND',\n  value: 'AND'\n}, {\n  description: 'OR',\n  value: 'OR'\n}];\n\nfunction FilterDetails({\n  activeTab,\n  onChangeActiveTab\n}) {\n  var _saveAsForm$errors$sa;\n\n  // props.entity is the thing that you will pass to the backend to get the corresponding data for each module\n  const classes = useStyles();\n  const {\n    confirm\n  } = useConfirm();\n  const {\n    t\n  } = useTranslation(['common', 'advanced_filter']);\n  const dispatch = useDispatch();\n  const columnOptions = useSelector(advancedFilterActions.selectColumn);\n  const comparatorOptions = useSelector(advancedFilterActions.selectComparator);\n  const sortOptions = useSelector(advancedFilterActions.selectSortOptions);\n  const conditionTreeData = useSelector(advancedFilterActions.selectConditionTree);\n  const sortConditions = useSelector(advancedFilterActions.selectSortConditions);\n  const isUserDefault = useSelector(advancedFilterActions.selectUserDefault);\n  const filterName = useSelector(advancedFilterActions.selectFilterDetailName);\n  const isEditMode = useSelector(advancedFilterActions.selectEditMode);\n  const filterDetail = useSelector(advancedFilterActions.selectFilterDetail);\n  const permissions = useSelector(advancedFilterActions.selectPermissions);\n  const loading = useSelector(advancedFilterActions.selectLoading);\n  const afFormSelector = useSelector(advancedFilterActions.selectAfForm);\n  const saveAsFormSelector = useSelector(advancedFilterActions.selectSaveAsForm);\n  const userInfo = useSelector(authStore.selectProfile);\n  const isSharedMode = filterDetail.created_by && filterDetail.created_by !== userInfo.user_name;\n  const conjunctionOptions = conjunctions;\n  const treeData = useMemo(() => _.cloneDeep(conditionTreeData), [conditionTreeData]);\n  const sortData = useMemo(() => _.cloneDeep(sortConditions), [sortConditions]);\n  const saveAsForm = useForm({\n    defaultValues: {\n      save_as_name: ''\n    },\n    shouldUnregister: false\n  });\n  const afForm = useForm({\n    defaultValues: {\n      name: ''\n    },\n    shouldUnregister: false\n  });\n  const formValidation = {\n    name: {\n      required: {\n        value: true,\n        message: t('advanced_filter:validations.name_required')\n      },\n      maxLength: {\n        value: 80,\n        message: t('advanced_filter:validations.name_max_length')\n      }\n    }\n  };\n  useEffect(() => {\n    afForm.setValue('name', filterDetail.name);\n    afForm.clearErrors();\n  }, [filterDetail]);\n  useEffect(() => {\n    if (afFormSelector.error) {\n      afForm.setError('name', {\n        message: afFormSelector.error\n      });\n    }\n  }, [afFormSelector.error]);\n  useEffect(() => {\n    if (saveAsFormSelector.error) {\n      saveAsForm.setError('save_as_name', {\n        message: saveAsFormSelector.error\n      });\n    }\n  }, [saveAsFormSelector.error]);\n  useEffect(() => {\n    if (saveAsFormSelector.clearError) {\n      saveAsForm.clearErrors();\n    }\n  }, [saveAsFormSelector.clearError]);\n  useEffect(() => {\n    if (afFormSelector.clearError) {\n      afForm.clearErrors();\n    }\n  }, [afFormSelector.clearError]);\n  const onSubmitTreeData = afForm.handleSubmit(data => {\n    dispatch(advancedFilterActions.setFilterDetail(_objectSpread(_objectSpread({}, data), {}, {\n      where_conditions: treeData,\n      sort_conditions: sortData\n    })));\n\n    if (isEditMode) {\n      dispatch(advancedFilterActions.update());\n    } else {\n      dispatch(advancedFilterActions.create());\n    }\n\n    afForm.clearErrors();\n  });\n\n  const onSetDefaultFilter = (_, checked) => {\n    const nameTextBoxValue = afForm.getValues('name');\n    dispatch(advancedFilterActions.setFilterDetail({\n      name: nameTextBoxValue,\n      is_user_default: checked\n    }));\n  };\n\n  const onCloseAdvanceSearch = () => {\n    dispatch(advancedFilterActions.resetState());\n    dispatch(commonStore.actions.setTableState({\n      page: 1\n    }));\n    dispatch(advancedFilterActions.close());\n  };\n\n  const onDeleteFilter = async () => {\n    const title = t('advanced_filter:confirmation.title');\n    const description = t('advanced_filter:confirmation.message_delete');\n    const result = await confirm({\n      title,\n      description\n    });\n\n    if (result === confirmConstant.actionTypes.OK) {\n      dispatch(advancedFilterActions.remove());\n    }\n  };\n\n  const onSaveAsSharedFilter = () => {\n    dispatch(advancedFilterActions.setFilterDetail({\n      is_shared: false,\n      where_conditions: treeData,\n      sort_conditions: sortData\n    }));\n    dispatch(advancedFilterActions.setSaveAsForm({\n      open: true\n    }));\n    const copyName = `Copy of ${filterName}`;\n    saveAsForm.setValue('save_as_name', copyName);\n\n    if (copyName.length > formValidation.name.maxLength.value) {\n      saveAsForm.setError('save_as_name', {\n        type: 'manual',\n        message: formValidation.name.maxLength.message\n      });\n    }\n  };\n\n  const onSubmitToSaveAs = saveAsForm.handleSubmit(data => {\n    dispatch(advancedFilterActions.saveAs(data.save_as_name));\n  });\n\n  const onCloseSaveAsForm = () => {\n    saveAsForm.clearErrors();\n    saveAsForm.reset();\n    dispatch(advancedFilterActions.setSaveAsForm({\n      open: false\n    }));\n  };\n\n  const onApplyAdvanceSearch = () => {\n    const where_conditions = _.cloneDeep(treeData);\n\n    const sort_conditions = _.cloneDeep(sortData);\n\n    dispatch(advancedFilterActions.setDefaultFilter({\n      where_conditions,\n      sort_conditions\n    }));\n    dispatch(advancedFilterActions.apply());\n  };\n\n  const onUpdateSystemFilter = async () => {\n    const title = t('advanced_filter:confirmation.title_warning');\n    const description = t('advanced_filter:confirmation.description_warning');\n    const result = await confirm({\n      title,\n      description\n    });\n\n    if (result === confirmConstant.actionTypes.OK) {\n      dispatch(advancedFilterActions.setFilterDetail({\n        where_conditions: treeData,\n        sort_conditions: sortData\n      }));\n      dispatch(advancedFilterActions.update());\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      alignItems: \"center\",\n      spacing: 2,\n      component: \"form\",\n      id: \"af-form\",\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 7,\n        children: /*#__PURE__*/_jsx(FormControllerTextField, {\n          label: t('advanced_filter:filter_details.name_input'),\n          variant: \"outlined\",\n          name: \"name\",\n          required: true,\n          disabled: isSharedMode,\n          autoFocus: !isSharedMode,\n          control: afForm.control,\n          rules: formValidation.name\n        })\n      }), /*#__PURE__*/_jsx(Unless, {\n        condition: filterDetail.is_system_default,\n        children: /*#__PURE__*/_jsx(Grid, {\n          item: true,\n          xs: 5,\n          style: {\n            padding: 0\n          },\n          children: /*#__PURE__*/_jsx(FormControlLabel, {\n            disabled: false,\n            control: /*#__PURE__*/_jsx(Checkbox, {\n              name: \"setAsDefault\",\n              color: \"primary\",\n              checked: isUserDefault,\n              onChange: onSetDefaultFilter,\n              className: classes.checkboxSetDefault\n            }),\n            label: /*#__PURE__*/_jsx(Typography, {\n              component: \"span\",\n              variant: \"body2\",\n              children: t('advanced_filter:filter_details.set_as_default')\n            })\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsxs(Tabs, {\n      value: activeTab,\n      onChange: onChangeActiveTab,\n      children: [/*#__PURE__*/_jsx(Tab, {\n        label: t('advanced_filter:filter_details.filter_tab')\n      }), /*#__PURE__*/_jsx(Tab, {\n        label: t('advanced_filter:filter_details.sort_tab')\n      })]\n    }), /*#__PURE__*/_jsx(MalisPanel, {\n      value: activeTab,\n      index: 0,\n      className: classes.tabPanel,\n      children: /*#__PURE__*/_jsx(ConditionTree, {\n        columnOptions: columnOptions,\n        comparatorOptions: comparatorOptions,\n        conjunctionOptions: conjunctionOptions,\n        data: treeData,\n        maxLevel: 2,\n        disabled: false\n      })\n    }), /*#__PURE__*/_jsx(MalisPanel, {\n      value: activeTab,\n      index: 1,\n      className: classes.tabPanel,\n      children: /*#__PURE__*/_jsx(SortConditionList, {\n        columnOptions: columnOptions,\n        sortOptions: sortOptions,\n        sortData: sortData,\n        disabled: false\n      })\n    }), /*#__PURE__*/_jsxs(\"section\", {\n      className: classes.wrapButtonGroup,\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: classes.wrapButtonLeft,\n        children: [/*#__PURE__*/_jsx(When, {\n          condition: isSharedMode,\n          children: /*#__PURE__*/_jsx(Button, {\n            variant: \"contained\",\n            onClick: onSaveAsSharedFilter,\n            startIcon: /*#__PURE__*/_jsx(FileCopyIcon, {}),\n            children: t('common:button.save_as')\n          })\n        }), /*#__PURE__*/_jsx(When, {\n          condition: filterDetail.is_system_default && permissions.update_system_default_presets,\n          children: /*#__PURE__*/_jsx(Tooltip, {\n            title: t('advanced_filter:tooltip.update'),\n            children: /*#__PURE__*/_jsx(Button, {\n              variant: \"contained\",\n              onClick: onUpdateSystemFilter,\n              style: {\n                marginLeft: '5px'\n              },\n              children: t('common:button.update')\n            })\n          })\n        }), /*#__PURE__*/_jsx(Unless, {\n          condition: isSharedMode,\n          children: /*#__PURE__*/_jsx(Tooltip, {\n            title: isEditMode ? t('advanced_filter:tooltip.update') : t('advanced_filter:tooltip.create'),\n            children: /*#__PURE__*/_jsx(Button, {\n              variant: \"contained\",\n              type: \"submit\",\n              form: \"af-form\",\n              onClick: onSubmitTreeData,\n              startIcon: isEditMode ? /*#__PURE__*/_jsx(EditIcon, {}) : /*#__PURE__*/_jsx(SaveIcon, {}),\n              children: isEditMode ? t('common:button.update') : t('common:button.create')\n            })\n          })\n        }), /*#__PURE__*/_jsx(When, {\n          condition: !isSharedMode && isEditMode,\n          children: /*#__PURE__*/_jsx(Button, {\n            variant: \"contained\",\n            color: \"default\",\n            style: {\n              marginLeft: '5px'\n            },\n            onClick: onDeleteFilter,\n            startIcon: /*#__PURE__*/_jsx(DeleteIcon, {}),\n            children: t('common:button.delete')\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: classes.wrapButtonRight,\n        children: [/*#__PURE__*/_jsx(Tooltip, {\n          title: t('advanced_filter:tooltip.apply'),\n          children: /*#__PURE__*/_jsx(Button, {\n            variant: \"contained\",\n            onClick: onApplyAdvanceSearch,\n            startIcon: /*#__PURE__*/_jsx(FilterIcon, {}),\n            children: t('common:button.apply')\n          })\n        }), /*#__PURE__*/_jsx(Tooltip, {\n          title: t('advanced_filter:tooltip.close'),\n          children: /*#__PURE__*/_jsx(Button, {\n            onClick: onCloseAdvanceSearch,\n            startIcon: /*#__PURE__*/_jsx(CloseIcon, {}),\n            variant: \"contained\",\n            style: {\n              marginLeft: 5\n            },\n            children: t('common:button.close')\n          })\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(DialogMain, {\n      open: saveAsFormSelector.open,\n      title: t('advanced_filter:confirmation.save_as_title'),\n      maxWidth: \"sm\",\n      loading: loading.dialog,\n      onOk: onSubmitToSaveAs,\n      okText: t('common:button.save'),\n      onClose: onCloseSaveAsForm,\n      closeText: t('common:button.cancel'),\n      children: /*#__PURE__*/_jsx(TextField, {\n        style: {\n          marginTop: 8\n        },\n        name: \"save_as_name\",\n        label: t('advanced_filter:filter_details.name_input'),\n        autoFocus: true,\n        required: true,\n        error: Boolean(saveAsForm.errors.save_as_name),\n        helperText: (_saveAsForm$errors$sa = saveAsForm.errors.save_as_name) === null || _saveAsForm$errors$sa === void 0 ? void 0 : _saveAsForm$errors$sa.message,\n        inputRef: saveAsForm.register(formValidation.name)\n      })\n    })]\n  });\n}\n\nexport default FilterDetails;","map":null,"metadata":{},"sourceType":"module"}