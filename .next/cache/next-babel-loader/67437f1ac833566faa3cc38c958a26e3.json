{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useMemo, useEffect } from 'react';\nimport { DataGrid } from '@material-ui/data-grid';\nimport { AppAutocompleteStyled, DialogBudgetCreateEdit, DataTableTextField, DialogBudgetImport, EditIcon, CreateIcon, DeleteIcon, MakeAListIcon, SaveIcon, AppLayout, DataTableNumberField } from '@/components';\nimport { useTranslation } from 'next-i18next';\nimport useStyles from '@/styles/page/layout';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useConfirm, confirmConstant } from '@/components/Dialog/Common/Confirmation';\nimport clsx from 'clsx';\nimport _ from 'lodash';\nimport immer from 'immer';\nimport * as yup from 'yup';\nimport { budgetAmountFormat, unsaveDialogOptions } from '@/utils/constant';\nimport * as columnProperties from '@/utils/columnProperties';\nimport { budgetActions, commonStore, makeAListActions } from '@/store/reducers';\nimport { TABLE_HEIGHT_BUDGET } from '@/styles/vars/size';\nimport DialogRemindData from '@/components/Dialog/Module/Budget/RemindData';\nimport getMessageConfirm from '@/utils/getMessageConfirm';\n\nfunction BudgetPage() {\n  var classes = useStyles();\n\n  var _useTranslation = useTranslation('budget'),\n      t = _useTranslation.t;\n\n  var _useConfirm = useConfirm(),\n      confirm = _useConfirm.confirm;\n\n  var dispatch = useDispatch();\n  var dataList = useSelector(budgetActions.selectDataList);\n  var userJob = useSelector(budgetActions.selectUserJob);\n  var userPuco = useSelector(budgetActions.selectUserPuco);\n  var pucoList = useSelector(budgetActions.selectPucoList);\n  var jobList = useSelector(budgetActions.selectJobList);\n  var budgetSum = useSelector(budgetActions.selectBudgetSum);\n  var permissions = useSelector(budgetActions.selectPermissions);\n  var selectedRows = useSelector(commonStore.selectSelectedRows);\n\n  var _useSelector = useSelector(budgetActions.selectInitDataForList),\n      column_tooltips = _useSelector.column_tooltips,\n      initDataForList = _objectWithoutProperties(_useSelector, [\"column_tooltips\"]);\n\n  var editRows = useSelector(commonStore.selectEditRows);\n  var breadcrumbData = useMemo(function () {\n    return [{\n      label: 'Home',\n      href: '/'\n    }, {\n      label: 'Basic Options',\n      href: '/jobs'\n    }, {\n      label: 'Budget Management',\n      href: '/budget'\n    }];\n  }, []);\n  useEffect(function () {\n    dispatch(commonStore.actions.setEditRows([]));\n  }, [dataList]); // handle change value\n\n  var onChangeUserValue = function onChangeUserValue(value) {\n    return /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event, option) {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                result = '';\n\n                if (!(editRows.length > 0)) {\n                  _context.next = 5;\n                  break;\n                }\n\n                _context.next = 4;\n                return confirm(unsaveDialogOptions);\n\n              case 4:\n                result = _context.sent;\n\n              case 5:\n                if (result !== 'cancel') {\n                  dispatch(budgetActions.changeUserValue({\n                    value: value,\n                    option: option,\n                    confirm: result\n                  }));\n                }\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  };\n\n  var onOpenUpdateDialog = function onOpenUpdateDialog(id) {\n    return function () {\n      dispatch(budgetActions.openUpdateDialog(id));\n    };\n  };\n\n  var onOpenCreateDialog = function onOpenCreateDialog() {\n    dispatch(budgetActions.openCreateDialog());\n  };\n\n  var onOpenImportDialog = function onOpenImportDialog() {\n    dispatch(budgetActions.setImportOpen(true));\n  };\n\n  var onSaveUpdateData = function onSaveUpdateData() {\n    dispatch(commonStore.sagaUpdateMultiple({\n      entity: 'budget'\n    }));\n  };\n\n  var onDeleteBudgets = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var description, result;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              description = getMessageConfirm(t, 'budget', selectedRows, 'delete');\n              _context2.next = 3;\n              return confirm({\n                description: description\n              });\n\n            case 3:\n              result = _context2.sent;\n\n              if (result === confirmConstant.actionTypes.OK) {\n                dispatch(budgetActions.remove(selectedRows));\n              }\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onDeleteBudgets() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onOpenMakeAList = function onOpenMakeAList() {\n    dispatch(makeAListActions.open());\n  };\n\n  var onChangeEditRows = function onChangeEditRows(budget_id_pk, value, field) {\n    var newEditRows = immer(editRows, function (draft) {\n      var findIndex = _.findIndex(draft, {\n        budget_id_pk: budget_id_pk\n      });\n\n      var valueFormat = field === 'amount' ? Number(value) : value;\n\n      if (findIndex > -1) {\n        draft[findIndex][field] = valueFormat;\n      } else {\n        draft.push(_defineProperty({\n          budget_id_pk: budget_id_pk\n        }, field, valueFormat));\n      }\n    });\n    dispatch(commonStore.actions.setEditRows(newEditRows));\n  };\n\n  var columns = [_objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.iconColumn), {}, {\n    description: column_tooltips.edit,\n    field: 'id',\n    headerName: 'Edit',\n    renderCell: function renderCell(params) {\n      return /*#__PURE__*/_jsx(EditIcon, {\n        onClick: onOpenUpdateDialog(params.value)\n      });\n    }\n  }), _objectSpread(_objectSpread({}, columnProperties.defaultProperties), {}, {\n    description: column_tooltips.budget_id,\n    field: 'budget_id',\n    headerName: 'Cost Code',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.editCell('Description', permissions === null || permissions === void 0 ? void 0 : permissions.edit, column_tooltips.description)), {}, {\n    field: 'description',\n    flex: 0.3,\n    cellClassName: function cellClassName(params) {\n      return clsx(_defineProperty({}, classes.mark, editRows.some(function (row) {\n        return row.budget_id_pk === params.id && typeof row.description !== 'undefined';\n      })));\n    },\n    renderEditCell: function renderEditCell(params) {\n      return /*#__PURE__*/_jsx(DataTableTextField, {\n        params: params,\n        rules: yup.string().max(513, 'Description must be less than 513 characters!'),\n        onChangeValue: onChangeEditRows\n      });\n    }\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.centerColumn), {}, {\n    description: column_tooltips.currency_id,\n    field: 'currency_id',\n    headerName: 'Currency',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.centerColumn), {}, {\n    description: column_tooltips.puco,\n    field: 'puco',\n    headerName: 'Puco',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.numberColumn), columnProperties.editCell('Amount', permissions === null || permissions === void 0 ? void 0 : permissions.edit, column_tooltips.amount)), {}, {\n    field: 'amount',\n    flex: 0.1,\n    cellClassName: function cellClassName(params) {\n      return clsx(_defineProperty({}, classes.mark, editRows.some(function (row) {\n        return row.budget_id_pk === params.id && typeof row.amount !== 'undefined';\n      })));\n    },\n    renderEditCell: function renderEditCell(params) {\n      return /*#__PURE__*/_jsx(DataTableNumberField, {\n        params: params,\n        onChangeValue: onChangeEditRows,\n        rules: yup.number().nullable().required(t('validation_message.amount_required')).min(budgetAmountFormat.min, t('validation_message.amount_range')).max(budgetAmountFormat.max, t('validation_message.amount_range'))\n      });\n    }\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.numberColumn), {}, {\n    description: column_tooltips.used_in_rfq,\n    field: 'used_in_rfq',\n    headerName: 'Used In RFQ',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.numberColumn), {}, {\n    description: column_tooltips.left_in_rfq,\n    field: 'left_in_rfq',\n    headerName: 'Left In RFQ',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.numberColumn), {}, {\n    description: column_tooltips.used_in_order,\n    field: 'used_in_order',\n    headerName: 'Used In Order',\n    flex: 0.1\n  }), _objectSpread(_objectSpread(_objectSpread({}, columnProperties.defaultProperties), columnProperties.numberColumn), {}, {\n    description: column_tooltips.left_in_order,\n    field: 'left_in_order',\n    headerName: 'Left In Order',\n    flex: 0.1\n  })];\n\n  var Dialogs = /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(DialogBudgetCreateEdit, {}), /*#__PURE__*/_jsx(DialogBudgetImport, {}), /*#__PURE__*/_jsx(DialogRemindData, {})]\n  });\n\n  var Options = /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(AppAutocompleteStyled, {\n      width: 250,\n      label: \"Jobs\",\n      className: classes.controlAutocomplete,\n      options: jobList,\n      value: userJob,\n      renderOption: function renderOption(option) {\n        return option.description;\n      },\n      primaryKeyOption: \"value\",\n      onChange: onChangeUserValue('job')\n    }), /*#__PURE__*/_jsx(AppAutocompleteStyled, {\n      disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.view),\n      width: 250,\n      label: \"Puco\",\n      className: classes.controlAutocomplete,\n      options: pucoList,\n      value: userPuco,\n      renderOption: function renderOption(option) {\n        return option.description;\n      },\n      primaryKeyOption: \"value\",\n      onChange: onChangeUserValue('puco')\n    })]\n  });\n\n  var renderButtons = [{\n    label: t('common:button.new'),\n    disabled: Boolean(userJob.value) === false || !(permissions === null || permissions === void 0 ? void 0 : permissions.create) && !(permissions === null || permissions === void 0 ? void 0 : permissions[\"import\"]),\n    startIcon: /*#__PURE__*/_jsx(CreateIcon, {}),\n    item: [{\n      label: t('button.create'),\n      onClick: onOpenCreateDialog,\n      disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.create)\n    }, {\n      label: t('form.title.import'),\n      onClick: onOpenImportDialog,\n      disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions[\"import\"])\n    }]\n  }, {\n    label: t('common:button.delete'),\n    disabled: selectedRows.length <= 0 || !(permissions === null || permissions === void 0 ? void 0 : permissions[\"delete\"]),\n    startIcon: /*#__PURE__*/_jsx(DeleteIcon, {}),\n    onClick: onDeleteBudgets\n  }, {\n    label: t('common:button.save'),\n    disabled: editRows.length <= 0 || !(permissions === null || permissions === void 0 ? void 0 : permissions.edit),\n    startIcon: /*#__PURE__*/_jsx(SaveIcon, {}),\n    onClick: onSaveUpdateData\n  }, {\n    label: t('common:button.make_a_list'),\n    disabled: !(permissions === null || permissions === void 0 ? void 0 : permissions.make_a_list),\n    startIcon: /*#__PURE__*/_jsx(MakeAListIcon, {}),\n    onClick: onOpenMakeAList\n  }];\n\n  var bottomSection = /*#__PURE__*/_jsx(\"div\", {\n    style: {\n      height: 35,\n      width: '100%'\n    },\n    children: /*#__PURE__*/_jsx(DataGrid, {\n      disableSelectionOnClick: true,\n      disableColumnMenu: true,\n      checkboxSelection: true,\n      hideFooter: true,\n      columns: columns,\n      headerHeight: 0,\n      rowHeight: 35,\n      getRowClassName: function getRowClassName() {\n        return classes.totalBudgetRow;\n      },\n      rows: [budgetSum],\n      onCellDoubleClick: function onCellDoubleClick(_, event) {\n        event.stopPropagation();\n      }\n    })\n  });\n\n  return /*#__PURE__*/_jsx(AppLayout, {\n    entity: \"budget\",\n    breadcrumbs: breadcrumbData,\n    wikiPage: initDataForList.wiki_page,\n    permissions: permissions,\n    searchProps: {\n      width: 300\n    },\n    buttons: renderButtons,\n    Dialogs: Dialogs,\n    Options: Options,\n    tableProps: {\n      columns: columns\n    },\n    bottomSection: bottomSection,\n    tableHeight: TABLE_HEIGHT_BUDGET\n  });\n}\n\nexport var __N_SSP = true;\nexport default BudgetPage;","map":null,"metadata":{},"sourceType":"module"}