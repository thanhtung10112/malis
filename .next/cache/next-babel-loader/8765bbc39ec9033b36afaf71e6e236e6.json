{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { takeEvery, put, putResolve } from 'redux-saga/effects';\nimport { call, select, all, takeLatest } from 'typed-redux-saga';\nimport immer from 'immer';\nimport { advancedFilterActions, commonStore, locationStore } from '@/store/reducers';\nimport locationApi from '@/apis/location.api';\nexport function* fetchInitDataForList() {\n  const data = yield call(locationApi.getInitDataForList);\n  yield put(locationStore.actions.setInitDataForList(data));\n}\nexport function* fetchInitDataForCE() {\n  const _yield$call = yield call(locationApi.getInitDataForCE),\n        {\n    permissions\n  } = _yield$call,\n        data = _objectWithoutProperties(_yield$call, [\"permissions\"]);\n\n  yield put(locationStore.actions.setInitDataForCE(data));\n  yield put(locationStore.actions.setDetail({\n    location_id: data.next_code\n  }));\n}\nexport function* fetchList() {\n  const {\n    tableState,\n    searchQuery,\n    filterData\n  } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData)\n  });\n  const {\n    page,\n    per_page\n  } = tableState;\n  const data = yield call(locationApi.getList, _objectSpread({\n    per_page,\n    page,\n    s: searchQuery\n  }, filterData));\n  yield put(commonStore.actions.setTableState({\n    total_items: data.total_items\n  }));\n  yield put(locationStore.actions.setDataList(data.locations));\n}\nexport function* fetchDetail(id) {\n  const {\n    location\n  } = yield call(locationApi.getDetail, id);\n  yield put(locationStore.actions.setDetail(location));\n}\nexport function* getLocationList() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchInitDataForList);\n    const permissions = yield* select(locationStore.selectPermissions);\n\n    if (permissions === null || permissions === void 0 ? void 0 : permissions.view) {\n      yield call(fetchList);\n    }\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\nexport function* openLocationCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchInitDataForCE);\n    yield put(locationStore.actions.setDialogStateOpen(true));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\nexport function* createLocation({\n  payload\n}) {\n  yield put(locationStore.actions.setDialogStateLoading(true));\n\n  try {\n    const {\n      message\n    } = yield call(locationApi.create, payload);\n    yield put(commonStore.actions.setSuccessMessage(message));\n    const {\n      generated_code\n    } = yield call(locationApi.getNextCode, null);\n    yield put(locationStore.actions.setDetail(_objectSpread(_objectSpread({}, locationStore.initialState.detail), {}, {\n      location_id: generated_code\n    })));\n    yield put(locationStore.actions.setNextCode(generated_code));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(locationStore.actions.setDialogStateLoading(false));\n}\nexport function* updateLocation({\n  payload\n}) {\n  yield put(locationStore.actions.setDialogStateLoading(true));\n\n  try {\n    const permissions = yield* select(locationStore.selectPermissions);\n    const {\n      id\n    } = payload; // delete location_type if user not have change_type permission\n\n    const location = immer(payload.location, draft => {\n      if (!permissions.change_type) {\n        delete draft.location_type;\n      }\n    });\n    const {\n      message\n    } = yield call(locationApi.update, id, location);\n    yield call(closeLocationDialog);\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(locationStore.actions.setDialogStateLoading(false));\n}\nexport function* openLocationUpdateDialog({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield put(locationStore.actions.setDialogStateEditMode(true));\n    yield call(fetchInitDataForCE);\n    yield call(fetchDetail, payload);\n    yield put(locationStore.actions.setDialogStateOpen(true));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\nexport function* getLocationNextCode({\n  payload\n}) {\n  yield put(locationStore.actions.setDialogStateLoading(true));\n\n  try {\n    const {\n      generated_code\n    } = yield call(locationApi.getNextCode, payload.location_id);\n    const newDetail = immer(payload, draft => {\n      draft.location_id = generated_code;\n    });\n    yield put(locationStore.actions.setDetail(newDetail));\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n\n  yield put(locationStore.actions.setDialogStateLoading(false));\n}\nexport function* closeLocationDialog() {\n  try {\n    yield putResolve(locationStore.actions.setDialogStateOpen(false));\n    yield call(getLocationList);\n    yield all([put(locationStore.actions.setDialogStateEditMode(false)), put(locationStore.actions.resetDetail())]);\n  } catch (error) {\n    yield put(commonStore.actions.setError(error));\n  }\n}\n\nfunction* locationSaga() {\n  yield takeEvery(locationStore.sagaGetList, getLocationList);\n  yield takeEvery(locationStore.sagaOpenCreateDialog, openLocationCreateDialog);\n  yield takeEvery(locationStore.sagaCreate, createLocation);\n  yield takeEvery(locationStore.sagaOpenUpdateDialog, openLocationUpdateDialog);\n  yield takeEvery(locationStore.sagaUpdate, updateLocation);\n  yield takeEvery(locationStore.sagaCloseDialog, closeLocationDialog);\n  yield takeLatest(locationStore.sagaGetNextCode, getLocationNextCode);\n}\n\nexport default locationSaga;","map":{"version":3,"sources":["D:/Fersher/TTS_Reactjs/malis-3-frontend/src/store/saga/location.saga.ts"],"names":["takeEvery","put","putResolve","call","select","all","takeLatest","immer","advancedFilterActions","commonStore","locationStore","locationApi","fetchInitDataForList","data","getInitDataForList","actions","setInitDataForList","fetchInitDataForCE","getInitDataForCE","permissions","setInitDataForCE","setDetail","location_id","next_code","fetchList","tableState","searchQuery","filterData","selectTableState","selectSearchQuery","selectFilterData","page","per_page","getList","s","setTableState","total_items","setDataList","locations","fetchDetail","id","location","getDetail","getLocationList","setLoadingPage","selectPermissions","view","error","setError","openLocationCreateDialog","setDialogStateOpen","createLocation","payload","setDialogStateLoading","message","create","setSuccessMessage","generated_code","getNextCode","initialState","detail","setNextCode","updateLocation","draft","change_type","location_type","update","closeLocationDialog","openLocationUpdateDialog","setDialogStateEditMode","getLocationNextCode","newDetail","resetDetail","locationSaga","sagaGetList","sagaOpenCreateDialog","sagaCreate","sagaOpenUpdateDialog","sagaUpdate","sagaCloseDialog","sagaGetNextCode"],"mappings":"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","sourcesContent":["import { takeEvery, put, putResolve } from 'redux-saga/effects'\n\nimport { call, select, all, takeLatest } from 'typed-redux-saga'\nimport immer from 'immer'\n\nimport { advancedFilterActions, commonStore, locationStore } from '@/store/reducers'\n\nimport locationApi from '@/apis/location.api'\n\nexport function* fetchInitDataForList() {\n  const data = yield call(locationApi.getInitDataForList)\n  yield put(locationStore.actions.setInitDataForList(data))\n}\n\nexport function* fetchInitDataForCE() {\n  const { permissions, ...data } = yield call(locationApi.getInitDataForCE)\n  yield put(locationStore.actions.setInitDataForCE(data))\n  yield put(locationStore.actions.setDetail({ location_id: data.next_code }))\n}\n\nexport function* fetchList() {\n  const { tableState, searchQuery, filterData } = yield* all({\n    tableState: select(commonStore.selectTableState),\n    searchQuery: select(commonStore.selectSearchQuery),\n    filterData: select(advancedFilterActions.selectFilterData)\n  })\n  const { page, per_page } = tableState\n  const data = yield call(locationApi.getList, {\n    per_page,\n    page,\n    s: searchQuery,\n    ...filterData\n  })\n  yield put(commonStore.actions.setTableState({ total_items: data.total_items }))\n  yield put(locationStore.actions.setDataList(data.locations))\n}\n\nexport function* fetchDetail(id: number) {\n  const { location } = yield call(locationApi.getDetail, id)\n  yield put(locationStore.actions.setDetail(location))\n}\n\nexport function* getLocationList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForList)\n    const permissions = yield* select(locationStore.selectPermissions)\n    if (permissions?.view) {\n      yield call(fetchList)\n    }\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* openLocationCreateDialog() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield call(fetchInitDataForCE)\n    yield put(locationStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* createLocation({ payload }: ReturnType<typeof locationStore.sagaCreate>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const { message } = yield call(locationApi.create, payload)\n    yield put(commonStore.actions.setSuccessMessage(message))\n    const { generated_code } = yield call(locationApi.getNextCode, null)\n    yield put(\n      locationStore.actions.setDetail({\n        ...locationStore.initialState.detail,\n        location_id: generated_code\n      })\n    )\n    yield put(locationStore.actions.setNextCode(generated_code))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* updateLocation({ payload }: ReturnType<typeof locationStore.sagaUpdate>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const permissions = yield* select(locationStore.selectPermissions)\n    const { id } = payload\n    // delete location_type if user not have change_type permission\n    const location = immer(payload.location, (draft) => {\n      if (!permissions.change_type) {\n        delete draft.location_type\n      }\n    })\n    const { message } = yield call(locationApi.update, id, location)\n    yield call(closeLocationDialog)\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* openLocationUpdateDialog({ payload }: ReturnType<typeof locationStore.sagaOpenUpdateDialog>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    yield put(locationStore.actions.setDialogStateEditMode(true))\n    yield call(fetchInitDataForCE)\n    yield call(fetchDetail, payload)\n    yield put(locationStore.actions.setDialogStateOpen(true))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nexport function* getLocationNextCode({ payload }: ReturnType<typeof locationStore.sagaGetNextCode>) {\n  yield put(locationStore.actions.setDialogStateLoading(true))\n  try {\n    const { generated_code } = yield call(locationApi.getNextCode, payload.location_id)\n    const newDetail = immer(payload, (draft) => {\n      draft.location_id = generated_code\n    })\n    yield put(locationStore.actions.setDetail(newDetail))\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n  yield put(locationStore.actions.setDialogStateLoading(false))\n}\n\nexport function* closeLocationDialog() {\n  try {\n    yield putResolve(locationStore.actions.setDialogStateOpen(false))\n    yield call(getLocationList)\n    yield all([put(locationStore.actions.setDialogStateEditMode(false)), put(locationStore.actions.resetDetail())])\n  } catch (error) {\n    yield put(commonStore.actions.setError(error))\n  }\n}\n\nfunction* locationSaga() {\n  yield takeEvery(locationStore.sagaGetList, getLocationList)\n  yield takeEvery(locationStore.sagaOpenCreateDialog, openLocationCreateDialog)\n  yield takeEvery(locationStore.sagaCreate, createLocation)\n  yield takeEvery(locationStore.sagaOpenUpdateDialog, openLocationUpdateDialog)\n  yield takeEvery(locationStore.sagaUpdate, updateLocation)\n  yield takeEvery(locationStore.sagaCloseDialog, closeLocationDialog)\n  yield takeLatest(locationStore.sagaGetNextCode, getLocationNextCode)\n}\n\nexport default locationSaga\n"]},"metadata":{},"sourceType":"module"}