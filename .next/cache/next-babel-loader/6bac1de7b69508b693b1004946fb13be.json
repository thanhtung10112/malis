{"ast":null,"code":"function _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { call, put, takeEvery, select, takeLatest, all } from 'redux-saga/effects';\nimport _ from 'lodash';\nimport * as errorSaga from '@/store/saga/errorSaga';\nimport { makeAListActions, exportProcessDialogActions, commonStore } from '@/store/reducers';\nimport { removalProperties } from '@/utils/constant';\nimport malApi from '@/apis/makeAList.api';\nimport { StatusCode } from '@/utils/StatusCode';\n\nfunction* getEntityFromStore() {\n  const entity = yield select(commonStore.selectEntity);\n  return entity;\n}\n\nfunction* fetchPresetList(filterType = '') {\n  let type = filterType;\n\n  if (!type) {\n    type = yield select(state => state.makeAList.filterType);\n  }\n\n  const entity = yield getEntityFromStore();\n  const {\n    make_a_list_preset_list\n  } = yield call(malApi.getList, {\n    entity,\n    type\n  });\n  yield put(makeAListActions.setPresetList(make_a_list_preset_list));\n}\n\nfunction* fetchPresetDetail(id) {\n  const {\n    make_a_list_preset\n  } = yield call(malApi.getDetail, id);\n  const filterType = yield select(makeAListActions.selectFilterType);\n\n  if (filterType === 'shared') {\n    make_a_list_preset.is_user_default = false;\n  }\n\n  yield put(makeAListActions.setPresetDetail(make_a_list_preset));\n}\n\nfunction* fetchInitDataForCreateUpdate() {\n  const entity = yield getEntityFromStore();\n  const data = yield call(malApi.getInitDataForCE, entity);\n  yield put(makeAListActions.setInitData(data));\n}\n\nfunction* fetchInitDataForList(isSetPresetDetail) {\n  const entity = yield getEntityFromStore();\n  const {\n    current_default_preset,\n    system_default_preset,\n    permissions: {\n      make_a_list\n    }\n  } = yield call(malApi.getInitDataForList, entity);\n  yield all([put(makeAListActions.setPresetDefault(current_default_preset)), put(makeAListActions.setSystemPreset(system_default_preset)), put(makeAListActions.setPermissions(make_a_list))]);\n  isSetPresetDetail && (yield put(makeAListActions.setPresetDetail(current_default_preset)));\n}\n\nfunction* changeFilterType({\n  payload: filterType\n}) {\n  yield put(makeAListActions.setLoadingTable(true));\n\n  try {\n    yield call(fetchPresetList, filterType);\n    yield put(makeAListActions.setFilterType(filterType));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(makeAListActions.setLoadingTable(false));\n}\n\nfunction* open() {\n  yield put(commonStore.actions.setLoadingPage(true));\n  const entity = yield getEntityFromStore();\n\n  try {\n    const {\n      success\n    } = yield call(malApi.checkPermissions, entity);\n\n    if (success) {\n      yield all([call(fetchPresetList), call(fetchInitDataForList, true), call(fetchInitDataForCreateUpdate)]);\n      yield put(makeAListActions.setOpen(true));\n    }\n  } catch (error) {\n    const {\n      data\n    } = error.response;\n    const {\n      message,\n      success\n    } = data;\n\n    if (!success) {\n      yield put(commonStore.actions.setErrorMessage(message));\n      yield put({\n        type: `${entity}/setPermissions`,\n        payload: {\n          make_a_list: false\n        }\n      });\n    }\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* create({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const {\n      id,\n      created_at,\n      created_by,\n      updated_at,\n      updated_by,\n      is_system_default\n    } = payload,\n          presetDetail = _objectWithoutProperties(payload, [\"id\", \"created_at\", \"created_by\", \"updated_at\", \"updated_by\", \"is_system_default\"]);\n\n    const data = yield call(malApi.create, presetDetail);\n    yield all([call(fetchPresetDetail, data.id), call(fetchPresetList), call(fetchInitDataForList, false), put(commonStore.actions.setSuccessMessage(data.message)), put(makeAListActions.setIsEditMode(true)), put(makeAListActions.setMalForm({\n      clearError: true,\n      error: ''\n    }))]);\n  } catch (error) {\n    const {\n      response: {\n        data,\n        status\n      }\n    } = error;\n\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message;\n      yield put(makeAListActions.setMalForm({\n        error\n      }));\n    } else {\n      yield errorSaga.handleError(error);\n    }\n  }\n\n  yield put(makeAListActions.setMalForm({\n    clearError: false,\n    error: ''\n  }));\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* update({\n  payload\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const presetDetail = _.omit(payload, [...removalProperties, 'is_system_default', 'is_shared']);\n\n    const {\n      message\n    } = yield call(malApi.update, payload.id, presetDetail);\n    yield all([call(fetchPresetList), call(fetchInitDataForList, false), put(commonStore.actions.setSuccessMessage(message)), put(makeAListActions.setMalForm({\n      clearError: true,\n      error: ''\n    }))]);\n  } catch (error) {\n    const {\n      response: {\n        data,\n        status\n      }\n    } = error;\n\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message;\n      yield put(makeAListActions.setMalForm({\n        error\n      }));\n    } else {\n      yield errorSaga.handleError(error);\n    }\n  }\n\n  yield put(makeAListActions.setMalForm({\n    clearError: false,\n    error: ''\n  }));\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* getList() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchPresetList);\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* getDetail({\n  payload: id\n}) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    yield call(fetchPresetDetail, id);\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* share({\n  payload\n}) {\n  yield put(makeAListActions.setLoadingTable(true));\n\n  try {\n    const {\n      id,\n      shared\n    } = payload;\n    const {\n      message\n    } = yield call(malApi.share, id, shared);\n    yield call(fetchPresetList);\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(makeAListActions.setLoadingTable(false));\n}\n\nfunction* remove() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const {\n      id\n    } = yield select(makeAListActions.selectPresetDetail);\n    const {\n      message\n    } = yield call(malApi.remove, id);\n    yield all([call(fetchPresetList), call(fetchInitDataForList, true)]);\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* clearDefault() {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const entity = yield getEntityFromStore();\n    const {\n      message\n    } = yield call(malApi.clearDefault, entity);\n    yield call(fetchInitDataForList, true);\n    yield put(commonStore.actions.setSuccessMessage(message));\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* startMakeAListExport(exportEvent) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const exportDetails = exportEvent.payload;\n    const entity = yield getEntityFromStore();\n    const requestData = {\n      entity: entity,\n      destination: exportDetails.destination,\n      columns_displayed: exportDetails.displayedColumns,\n      where_conditions: exportDetails.whereCondtions,\n      sort_conditions: exportDetails.sortConditions,\n      distinct: exportDetails.distinct,\n      ignore_case: exportDetails.ignoreCase\n    };\n    const data = yield call(malApi.startMakeAListExport, requestData);\n\n    if (data.success) {\n      if (data.result_path) {\n        const domain = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:5000/';\n        const redirectUrl = `${domain}${data.result_path}`;\n        window.open(redirectUrl);\n      } else {\n        yield put(exportProcessDialogActions.setOperationId(data.operation_id));\n        yield put(exportProcessDialogActions.setCeleryId(data.celery_id));\n        yield put(exportProcessDialogActions.setOpen(true));\n      }\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* stopMakeAListExport(operationData) {\n  yield put(commonStore.actions.setLoadingPage(true));\n\n  try {\n    const requestData = operationData.payload;\n    const data = yield call(malApi.stopMakeAListExport, requestData);\n\n    if (data.success) {\n      put(commonStore.actions.setSuccessMessage(data.message));\n      put(exportProcessDialogActions.setOpen(false));\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error);\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false));\n}\n\nfunction* saveAs({\n  payload\n}) {\n  yield put(makeAListActions.setLoadingDialog(true));\n\n  try {\n    const {\n      id,\n      created_at,\n      created_by,\n      updated_at,\n      updated_by,\n      is_system_default\n    } = payload,\n          presetDetail = _objectWithoutProperties(payload, [\"id\", \"created_at\", \"created_by\", \"updated_at\", \"updated_by\", \"is_system_default\"]);\n\n    const data = yield call(malApi.create, presetDetail);\n    yield all([call(fetchPresetDetail, data.id), call(fetchPresetList), call(fetchInitDataForList, false), put(commonStore.actions.setSuccessMessage(data.message)), put(makeAListActions.setIsEditMode(true)), put(makeAListActions.setSaveAsForm({\n      open: false,\n      clearError: true,\n      error: ''\n    }))]);\n  } catch (error) {\n    const {\n      response: {\n        data,\n        status\n      }\n    } = error;\n\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message;\n      yield put(makeAListActions.setSaveAsForm({\n        error\n      }));\n    } else {\n      yield errorSaga.handleError(error);\n    }\n  }\n\n  yield put(makeAListActions.setSaveAsForm({\n    clearError: false,\n    error: ''\n  }));\n  yield put(makeAListActions.setLoadingDialog(false));\n}\n\nfunction* makeAListSaga() {\n  yield takeEvery(makeAListActions.create, create);\n  yield takeEvery(makeAListActions.getList, getList);\n  yield takeEvery(makeAListActions.getDetail, getDetail);\n  yield takeEvery(makeAListActions.share, share);\n  yield takeEvery(makeAListActions.update, update);\n  yield takeLatest(makeAListActions.remove, remove);\n  yield takeLatest(makeAListActions.open, open);\n  yield takeLatest(makeAListActions.clearDefault, clearDefault);\n  yield takeLatest(makeAListActions.exportMakeAList, startMakeAListExport);\n  yield takeLatest(makeAListActions.changeFilterType, changeFilterType);\n  yield takeLatest(makeAListActions.saveAs, saveAs);\n  yield takeLatest(makeAListActions.stopMakeAList, stopMakeAListExport);\n}\n\nexport default makeAListSaga;","map":{"version":3,"sources":["D:/TTS_Reactjs/malis-3-frontend/src/store/saga/makeAListSaga.ts"],"names":["call","put","takeEvery","select","takeLatest","all","_","errorSaga","makeAListActions","exportProcessDialogActions","commonStore","removalProperties","malApi","StatusCode","getEntityFromStore","entity","selectEntity","fetchPresetList","filterType","type","state","makeAList","make_a_list_preset_list","getList","setPresetList","fetchPresetDetail","id","make_a_list_preset","getDetail","selectFilterType","is_user_default","setPresetDetail","fetchInitDataForCreateUpdate","data","getInitDataForCE","setInitData","fetchInitDataForList","isSetPresetDetail","current_default_preset","system_default_preset","permissions","make_a_list","getInitDataForList","setPresetDefault","setSystemPreset","setPermissions","changeFilterType","payload","setLoadingTable","setFilterType","error","handleError","open","actions","setLoadingPage","success","checkPermissions","setOpen","response","message","setErrorMessage","create","created_at","created_by","updated_at","updated_by","is_system_default","presetDetail","setSuccessMessage","setIsEditMode","setMalForm","clearError","status","BAD_REQUEST","update","omit","share","shared","remove","selectPresetDetail","clearDefault","startMakeAListExport","exportEvent","exportDetails","requestData","destination","columns_displayed","displayedColumns","where_conditions","whereCondtions","sort_conditions","sortConditions","distinct","ignore_case","ignoreCase","result_path","domain","process","env","NEXT_PUBLIC_BACKEND_URL","redirectUrl","window","setOperationId","operation_id","setCeleryId","celery_id","stopMakeAListExport","operationData","saveAs","setLoadingDialog","setSaveAsForm","makeAListSaga","exportMakeAList","stopMakeAList"],"mappings":"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","sourcesContent":["import { call, put, takeEvery, select, takeLatest, all } from 'redux-saga/effects'\nimport _ from 'lodash'\n\nimport * as errorSaga from '@/store/saga/errorSaga'\n\nimport { makeAListActions, exportProcessDialogActions, commonStore } from '@/store/reducers'\n\nimport { removalProperties } from '@/utils/constant'\nimport malApi from '@/apis/makeAList.api'\nimport { StatusCode } from '@/utils/StatusCode'\n\nfunction* getEntityFromStore() {\n  const entity = yield select(commonStore.selectEntity)\n  return entity\n}\n\nfunction* fetchPresetList(filterType = '') {\n  let type = filterType\n  if (!type) {\n    type = yield select((state) => state.makeAList.filterType)\n  }\n  const entity = yield getEntityFromStore()\n  const { make_a_list_preset_list } = yield call(malApi.getList, {\n    entity,\n    type\n  })\n  yield put(makeAListActions.setPresetList(make_a_list_preset_list))\n}\n\nfunction* fetchPresetDetail(id) {\n  const { make_a_list_preset } = yield call(malApi.getDetail, id)\n  const filterType = yield select(makeAListActions.selectFilterType)\n  if (filterType === 'shared') {\n    make_a_list_preset.is_user_default = false\n  }\n  yield put(makeAListActions.setPresetDetail(make_a_list_preset))\n}\n\nfunction* fetchInitDataForCreateUpdate() {\n  const entity = yield getEntityFromStore()\n  const data = yield call(malApi.getInitDataForCE, entity)\n  yield put(makeAListActions.setInitData(data))\n}\n\nfunction* fetchInitDataForList(isSetPresetDetail) {\n  const entity = yield getEntityFromStore()\n  const {\n    current_default_preset,\n    system_default_preset,\n    permissions: { make_a_list }\n  } = yield call(malApi.getInitDataForList, entity)\n  yield all([\n    put(makeAListActions.setPresetDefault(current_default_preset)),\n    put(makeAListActions.setSystemPreset(system_default_preset)),\n    put(makeAListActions.setPermissions(make_a_list))\n  ])\n  isSetPresetDetail && (yield put(makeAListActions.setPresetDetail(current_default_preset)))\n}\n\nfunction* changeFilterType({ payload: filterType }) {\n  yield put(makeAListActions.setLoadingTable(true))\n  try {\n    yield call(fetchPresetList, filterType)\n    yield put(makeAListActions.setFilterType(filterType))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(makeAListActions.setLoadingTable(false))\n}\n\nfunction* open() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  const entity = yield getEntityFromStore()\n\n  try {\n    const { success } = yield call(malApi.checkPermissions, entity)\n    if (success) {\n      yield all([call(fetchPresetList), call(fetchInitDataForList, true), call(fetchInitDataForCreateUpdate)])\n\n      yield put(makeAListActions.setOpen(true))\n    }\n  } catch (error) {\n    const { data } = error.response\n    const { message, success } = data\n    if (!success) {\n      yield put(commonStore.actions.setErrorMessage(message))\n      yield put({\n        type: `${entity}/setPermissions`,\n        payload: { make_a_list: false }\n      })\n    }\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* create({ payload }: ReturnType<typeof makeAListActions.create>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { id, created_at, created_by, updated_at, updated_by, is_system_default, ...presetDetail } = payload\n    const data = yield call(malApi.create, presetDetail)\n    yield all([\n      call(fetchPresetDetail, data.id),\n      call(fetchPresetList),\n      call(fetchInitDataForList, false),\n      put(commonStore.actions.setSuccessMessage(data.message)),\n      put(makeAListActions.setIsEditMode(true)),\n      put(\n        makeAListActions.setMalForm({\n          clearError: true,\n          error: ''\n        })\n      )\n    ])\n  } catch (error) {\n    const {\n      response: { data, status }\n    } = error\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message\n      yield put(makeAListActions.setMalForm({ error }))\n    } else {\n      yield errorSaga.handleError(error)\n    }\n  }\n  yield put(makeAListActions.setMalForm({ clearError: false, error: '' }))\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* update({ payload }: ReturnType<typeof makeAListActions.update>) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const presetDetail = _.omit(payload, [...removalProperties, 'is_system_default', 'is_shared'])\n    const { message } = yield call(malApi.update, payload.id, presetDetail)\n    yield all([\n      call(fetchPresetList),\n      call(fetchInitDataForList, false),\n      put(commonStore.actions.setSuccessMessage(message)),\n      put(\n        makeAListActions.setMalForm({\n          clearError: true,\n          error: ''\n        })\n      )\n    ])\n  } catch (error) {\n    const {\n      response: { data, status }\n    } = error\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message\n      yield put(makeAListActions.setMalForm({ error }))\n    } else {\n      yield errorSaga.handleError(error)\n    }\n  }\n  yield put(makeAListActions.setMalForm({ clearError: false, error: '' }))\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* getList() {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchPresetList)\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* getDetail({ payload: id }) {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    yield call(fetchPresetDetail, id)\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* share({ payload }: ReturnType<typeof makeAListActions.share>) {\n  yield put(makeAListActions.setLoadingTable(true))\n  try {\n    const { id, shared } = payload\n    const { message } = yield call(malApi.share, id, shared)\n    yield call(fetchPresetList)\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(makeAListActions.setLoadingTable(false))\n}\n\nfunction* remove() {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const { id } = yield select(makeAListActions.selectPresetDetail)\n    const { message } = yield call(malApi.remove, id)\n    yield all([call(fetchPresetList), call(fetchInitDataForList, true)])\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* clearDefault() {\n  yield put(commonStore.actions.setLoadingPage(true))\n\n  try {\n    const entity = yield getEntityFromStore()\n    const { message } = yield call(malApi.clearDefault, entity)\n    yield call(fetchInitDataForList, true)\n    yield put(commonStore.actions.setSuccessMessage(message))\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* startMakeAListExport(exportEvent) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const exportDetails = exportEvent.payload\n    const entity = yield getEntityFromStore()\n    const requestData = {\n      entity: entity,\n      destination: exportDetails.destination,\n      columns_displayed: exportDetails.displayedColumns,\n      where_conditions: exportDetails.whereCondtions,\n      sort_conditions: exportDetails.sortConditions,\n      distinct: exportDetails.distinct,\n      ignore_case: exportDetails.ignoreCase\n    }\n    const data = yield call(malApi.startMakeAListExport, requestData)\n    if (data.success) {\n      if (data.result_path) {\n        const domain = process.env.NEXT_PUBLIC_BACKEND_URL || 'http://localhost:5000/'\n        const redirectUrl = `${domain}${data.result_path}`\n        window.open(redirectUrl)\n      } else {\n        yield put(exportProcessDialogActions.setOperationId(data.operation_id))\n        yield put(exportProcessDialogActions.setCeleryId(data.celery_id))\n        yield put(exportProcessDialogActions.setOpen(true))\n      }\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* stopMakeAListExport(operationData) {\n  yield put(commonStore.actions.setLoadingPage(true))\n  try {\n    const requestData = operationData.payload\n    const data = yield call(malApi.stopMakeAListExport, requestData)\n    if (data.success) {\n      put(commonStore.actions.setSuccessMessage(data.message))\n      put(exportProcessDialogActions.setOpen(false))\n    }\n  } catch (error) {\n    yield errorSaga.handleError(error)\n  }\n  yield put(commonStore.actions.setLoadingPage(false))\n}\n\nfunction* saveAs({ payload }: ReturnType<typeof makeAListActions.saveAs>) {\n  yield put(makeAListActions.setLoadingDialog(true))\n  try {\n    const { id, created_at, created_by, updated_at, updated_by, is_system_default, ...presetDetail } = payload\n    const data = yield call(malApi.create, presetDetail)\n    yield all([\n      call(fetchPresetDetail, data.id),\n      call(fetchPresetList),\n      call(fetchInitDataForList, false),\n      put(commonStore.actions.setSuccessMessage(data.message)),\n      put(makeAListActions.setIsEditMode(true)),\n      put(\n        makeAListActions.setSaveAsForm({\n          open: false,\n          clearError: true,\n          error: ''\n        })\n      )\n    ])\n  } catch (error) {\n    const {\n      response: { data, status }\n    } = error\n    if (status === StatusCode.BAD_REQUEST) {\n      const error = data.message\n      yield put(makeAListActions.setSaveAsForm({ error }))\n    } else {\n      yield errorSaga.handleError(error)\n    }\n  }\n  yield put(makeAListActions.setSaveAsForm({ clearError: false, error: '' }))\n  yield put(makeAListActions.setLoadingDialog(false))\n}\n\nfunction* makeAListSaga() {\n  yield takeEvery(makeAListActions.create, create)\n  yield takeEvery(makeAListActions.getList, getList)\n  yield takeEvery(makeAListActions.getDetail, getDetail)\n  yield takeEvery(makeAListActions.share, share)\n  yield takeEvery(makeAListActions.update, update)\n  yield takeLatest(makeAListActions.remove, remove)\n  yield takeLatest(makeAListActions.open, open)\n  yield takeLatest(makeAListActions.clearDefault, clearDefault)\n  yield takeLatest(makeAListActions.exportMakeAList, startMakeAListExport)\n  yield takeLatest(makeAListActions.changeFilterType, changeFilterType)\n  yield takeLatest(makeAListActions.saveAs, saveAs)\n  yield takeLatest(makeAListActions.stopMakeAList, stopMakeAListExport)\n}\n\nexport default makeAListSaga\n"]},"metadata":{},"sourceType":"module"}